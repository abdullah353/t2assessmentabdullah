var allResult,exchk,gotDir,gotFS,gotFile,gotFileWriter,onConfirm,onDeviceReady,onOnline;onDeviceReady=function(){return document.addEventListener("online",onOnline,!1)};onOnline=function(){return $.couch.replicate(Tangerine.config.address.local.dbName,Tangerine.config.address.cloud.host+"/"+Tangerine.config.address.cloud.dbName,{success:function(){return!0},error:function(b,a){return!1}})};allResult="";gotFS=function(b){return b.root.getDirectory("data",{create:!0},gotDir)};
gotDir=function(b){var a;a=new Date;a=a.getFullYear()+"-"+a.getMonth()+1+"-"+a.getDate()+"-"+Math.floor(1E3*Math.random()+1);return b.getFile("result"+a+".json",{create:!0,exclusive:!1},gotFile)};gotFile=function(b){return b.createWriter(gotFileWriter)};gotFileWriter=function(b){b.onwriteend=function(a){};return b.write(JSON.stringify(allResult))};exchk=function(){return navigator.notification.confirm("Exit application ?",onConfirm,"Warning!","Exit,Back")};onConfirm=function(b){if(1===b)return navigator.app.exitApp()};var Assessment,_ref,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Assessment=function(b){function a(){this.updateFromServer=__bind(this.updateFromServer,this);this.fetch=__bind(this.fetch,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="assessment";a.prototype.initialize=function(e){return this.subtests=new Subtests};a.prototype.fetch=function(e){var c,h=this;c=e.success;e.success=function(e){return(new Subtests).fetch({key:h.id,success:function(e){h.subtests=e;h.subtests.maintainOrder();return"function"===typeof c?
c(h):void 0}})};return a.__super__.fetch.call(this,e)};a.prototype.updateFromServer=function(e){var a=this;null==e&&(e=this.id.substr(-5,5));this.trigger("status","import lookup");e=JSON.stringify(e.replace(/[^a-f0-9]/g," ").split(/\s+/));$.ajax(""+Tangerine.config.address.cloud.host+":"+Tangerine.config.address.port+"/"+Tangerine.db_name+"/_design/"+Tangerine.design_doc+"/_view/byDKey",{type:"POST",dataType:"jsonp",data:{keys:e},success:function(e){var b,f,g,k,l;f=[];l=e.rows;g=0;for(k=l.length;g<
k;g++)b=l[g],f.push(b.id);0===e.rows.length&&a.trigger("status","import empty");if(0!==e.rows.length)return $.couch.replicate(Tangerine.config.address.cloud.host+"/"+Tangerine.config.address.cloud.dbName,Tangerine.config.address.local.dbName,{success:function(){return a.trigger("status","import success")},error:function(e,h){return a.trigger("status","import error",""+e+" "+h)}},{doc_ids:f})}});return!1};a.prototype.duplicate=function(e,a,h,b){var f,g;g=this.id;f=this.clone();f.set(e);e=Utils.guid();
f.set({_id:e,assessmentId:e});f.save(null,{wait:!0});return(new Questions).fetch({key:this.id,success:function(e){return(new Subtests).fetch({key:g,success:function(a){var c,h,g,p,r,s;c=a.models;a={};p=[];g=s=0;for(h=c.length;s<h;g=++s)g=c[g],g=g.clone(),g.set("assessmentId",f.id),r=Utils.guid(),a[g.id]=r,g.set("_id",r),p.push(g);g=c=0;for(s=p.length;c<s;g=++c)g=p[g],h=g.get("gridLinkId"),""!==(h||"")&&g.set("gridLinkId",a[h]),g.save();p=[];s=e.models;c=0;for(g=s.length;c<g;c++)h=s[c],h=h.clone(),
r=h.get("subtestId"),h.set("assessmentId",f.id),h.set("_id",Utils.guid()),h.set("subtestId",a[r]),p.push(h),h.save();return b()}})}})};a.prototype.destroy=function(){var e;e=this.id;(new Subtests).fetch({key:e,success:function(e){var a;for(a=[];0!==e.length;)a.push(e.pop().destroy());return a}});(new Questions).fetch({key:this.id,success:function(e){var a;for(a=[];0!==e.length;)a.push(e.pop().destroy());return a}});return a.__super__.destroy.call(this)};return a}(Backbone.Model);var Assessments,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Assessments=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.model=Assessment;a.prototype.url="assessment";a.prototype.comparator=function(e){return e.get("name")};a.prototype.initialize=function(e){if(null!=e&&e.group)return this.group=e.group};return a}(Backbone.Collection);var AssessmentListElementView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
AssessmentListElementView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="li";a.prototype.events={"click .edit":"gotoEdit","click .results":"gotoResults","click .run":"gotoRun","click .chart":"gotoChart","click .print":"gotoPrint","click .assessment_menu_toggle":"assessmentMenuToggle","click .admin_name":"assessmentMenuToggle","click .assessment_delete":"assessmentDeleteToggle","click .assessment_delete_cancel":"assessmentDeleteToggle",
"click .assessment_delete_confirm":"assessmentDelete","click .copy":"copyToGroup","click .duplicate":"duplicate","click .archive":"archive","click .update":"update"};a.prototype.initialize=function(e){this.parent=e.parent;this.isAdmin=Tangerine.user.isAdmin();this.isPublic=e.isPublic;return this.model=e.model};a.prototype.gotoEdit=function(){return Tangerine.router.navigate("edit/"+this.model.id,!0)};a.prototype.gotoResults=function(){return Tangerine.router.navigate("results/"+this.model.id,!0)};
a.prototype.gotoRun=function(){return Tangerine.router.navigate("run/"+this.model.id,!0)};a.prototype.gotoPrint=function(){return Tangerine.router.navigate("print/"+this.model.id,!0)};a.prototype.gotoChart=function(){return Tangerine.router.navigate("chart/"+this.model.id,!0)};a.prototype.duplicate=function(){var e,a=this;e="Copy of "+this.model.get("name");return this.model.duplicate({name:e},null,null,function(){a.render();return a.parent.refresh()})};a.prototype.update=function(){var e=this;this.model.updateFromServer();
return this.model.on("status",function(a){if("import success"===a)return Utils.midAlert("Updated"),e.parent.refresh();if("import error"===a)return Utils.midAlert("Update failed"),e.parent.refresh()})};a.prototype.archive=function(){var e;e="true"===this.$el.find(".archive :selected").val();!0===e?this.$el.find(".admin_name").addClass("archived_assessment"):this.$el.find(".admin_name").removeClass("archived_assessment");this.model.save({archived:e});return!0};a.prototype.copyToGroup=function(){var e=
this;return this.model.duplicate({group:this.parent.group},null,null,function(){e.render();return e.parent.refresh()})};a.prototype.assessmentMenuToggle=function(){this.$el.find(".assessment_menu_toggle").toggleClass("icon_down");return this.$el.find(".assessment_menu").fadeToggle(250)};a.prototype.assessmentDeleteToggle=function(){this.$el.find(".assessment_delete_confirm").fadeToggle(250);return!1};a.prototype.assessmentDelete=function(){var e=this;return this.$el.fadeOut(250,function(){e.parent.collection.remove(e.model);
return e.model.destroy()})};a.prototype.render=function(){var e,a,h;e=!0===this.model.get("archived")||"true"===this.model.get("archived")?" archived_assessment":"";a="<span class='small_grey'>Download key <b>"+this.model.id.substr(-5,5)+"</b></span>";h="<span class='name clickable '>"+this.model.get("name")+"</span>";e="<span class='admin_name clickable "+e+"'>"+this.model.get("name")+"</span>";this.model.get("resultCount");this.model.get("archived");this.model.get("archived");this.isAdmin?(h="        <div>          <span class='assessment_menu_toggle icon_ryte'> </span>          "+
e+"         </div>      ",h="mobile"===Tangerine.settings.context?h+"          <div class='assessment_menu'>            <img class='link_icon run' title='Run' src='images/icon_run.png'>            <img class='link_icon chart' title='Results' src='images/chart.png'>            <img class='link_icon results' title='Results' src='images/icon_results.png'>            <img class='link_icon update' title='Update' src='images/icon_sync.png'>          </div>        ":this.isPublic?h+"            <div class='assessment_menu'>              <button class='copy command'>Copy to group</button>            </div>          ":
h+("            <div class='assessment_menu'>              <img class='link_icon run' title='Run' src='images/icon_run.png'>              <img class='link_icon results' title='Results' src='images/icon_results.png'>              <img class='link_icon edit' title='Edit' src='images/icon_edit.png'>              <img class='link_icon duplicate' title='Duplicate' src='images/icon_duplicate.png'>              <img class='assessment_delete link_icon' title='Delete' src='images/icon_delete.png'>              "+
a+"              <span class='assessment_delete_confirm'><div class='menu_box'>Confirm <button class='assessment_delete_yes command_red'>Delete</button> <button class='assessment_delete_cancel command'>Cancel</button></div></span>              <button class='print'>Print</button>            </div>          ")):h="<div><img class='link_icon run' title='Run' src='images/icon_run.png'>"+h+" <img class='link_icon results' title='Results' src='images/icon_results.png'> <img class='link_icon chart' title='Results' src='images/chart.png'></div>";
return this.$el.html(h)};return a}(Backbone.View);var AssessmentListView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
AssessmentListView=function(b){function a(){this.newAssessmentSave=__bind(this.newAssessmentSave,this);this.render=__bind(this.render,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"keypress .new_assessment_name":"newAssessmentSave","click .new_assessment_save":"newAssessmentSave","click .new_assessment_cancel":"newAssessmentToggle","click .new_assessment":"newAssessmentToggle","click .import":"import","click .groups":"gotoGroups"};a.prototype.gotoGroups=
function(){return Tangerine.router.navigate("groups",!0)};a.prototype["import"]=function(){return Tangerine.router.navigate("import",!0)};a.prototype.initialize=function(e){this.group=e.group;this.curriculaListView=new CurriculaListView({curricula:e.curricula});this.isAdmin=Tangerine.user.isAdmin();this.views=[];this.publicViews=[];return this.refresh()};a.prototype.refresh=function(){var e=this;return(new Assessments).fetch({success:function(a){var h;h=[];a.each(function(a){if("server"===Tangerine.settings.context){if(a.get("group")===
e.group)return h.push(a)}else return h.push(a)});e.collection=new Assessments(h);e.collection.on("add remove",e.render);e["public"]="server"===Tangerine.settings.context?new Assessments(a.where({group:"public"})):null;return e.render()}})};a.prototype.render=function(){var e,a,h,b,f,g,k,l,m;this.closeViews();this.views=[];a="      "+("server"===Tangerine.settings.context?"<button class='navigation groups'>Groups</button>":"")+"      <h1>Assessments</h1>      ";this.isAdmin&&(a+="        "+("server"===
Tangerine.settings.context?"<button class='new_assessment command'>New</button>":"")+"        "+("mobile"===Tangerine.settings.context?"<button class='import command'>Import</button>":"")+"        <div class='new_assessment_form confirmation'>          <div class='menu_box_wide'>            <input type='text' class='new_assessment_name' placeholder='Assessment Name'>            <button class='new_assessment_save command'>Save</button> <button class='new_assessment_cancel command'>Cancel</button>          </div>        </div>        <h2>Group assessments</h2>      ");
this.$el.html(a);if(0<(null!=(l=this.collection)?null!=(b=l.models)?b.length:void 0:void 0)){a=$("<ul>").addClass("assessment_list");l=null!=(e=this.collection)?e.models:void 0;b=0;for(g=l.length;b<g;b++)e=l[b],e=new AssessmentListElementView({model:e,parent:this}),this.views.push(e),e.render(),a.append(e.el);this.$el.append(a)}else this.$el.append("<p class='grey'>No assessments yet. Click <b>new</b> to start making one.</p>");if(this.isAdmin&&"server"===Tangerine.settings.context){this.$el.append("<h2>Public assessments</h2>");
if(0<(null!=(m=this["public"])?null!=(k=m.models)?k.length:void 0:void 0))for(h=$("<ul>").addClass("public_list assessment_list"),m=null!=(f=this["public"])?f.models:void 0,f=0,k=m.length;f<k;f++)e=m[f],e=new AssessmentListElementView({model:e,parent:this,isPublic:!0}),this.publicViews.push(e),e.render(),h.append(e.el);else this.$el.append("<p>No assessments available.</p>");this.$el.append(h);0!==this.options.curricula.length&&(this.curriculaListView.render(),this.$el.append("<h2>Curricula</h2>"),
this.$el.append(this.curriculaListView.el))}return this.trigger("rendered")};a.prototype.newAssessmentToggle=function(){this.$el.find(".new_assessment_form, .new_assessment").fadeToggle(250);return!1};a.prototype.newAssessmentSave=function(e){var a;if("click"!==e.type&&13!==e.which)return!0;e=this.$el.find(".new_assessment_name").val();0!==e.length?(a=Utils.guid(),a=new Assessment({name:e,group:this.group,_id:a,assessmentId:a}),a.save(),this.collection.add(a),Utils.midAlert(""+e+" saved")):Utils.midAlert("<span class='error'>Could not save <img src='images/icon_close.png' class='clear_message'></span>");
return!1};a.prototype.closeViews=function(){var e,a,h,b,f;"function"===typeof(e=this.curriculaListView).close&&e.close();b=this.views;f=[];a=0;for(h=b.length;a<h;a++)e=b[a],f.push(e.close());return f};a.prototype.onClose=function(){navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)&&document.removeEventListener("backbutton",exchk,!1);return this.closeViews()};return a}(Backbone.View);var AssessmentRunView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
AssessmentRunView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(e){var a,h,b,f=this;this.abortAssessment=!1;this.index=0;this.model=e.model;this.handler=this.model.get("handler");this.orderMap=[];this.cary=[];Tangerine.activity="assessment run";this.subtestViews=[];this.model.subtests.sort();this.model.subtests.each(function(e){return f.subtestViews.push(new SubtestRunView({model:e,parent:f}))});if(e=this.model.has("sequences")&&
!_.isEmpty(_.compact(_.flatten(this.model.get("sequences")))))a=this.model.get("sequences"),this.orderMap=a[Math.floor(Math.random()*a.length)],this.orderMap[this.orderMap.length]=this.orderMap.length;else{if(this.handler){this.orderMap[0]=0;this.orderMap[1]=1;a=h=2;for(b=this.subtestViews.length-1;2<=b?h<=b:h>=b;a=2<=b?++h:--h)this.cary.push(a);this.cary=_.shuffle(this.cary);this.orderMap=this.orderMap.concat(this.cary);this.orderMap[this.subtestViews.length]=this.subtestViews.length}else for(a=
h=0,b=this.subtestViews.length;0<=b?h<=b:h>=b;a=0<=b?++h:--h)this.orderMap[a]=a;this.result=new Result({assessmentId:this.model.id,assessmentName:this.model.get("name"),ref:this.orderMap,blank:!0})}e&&this.result.set({order_map:this.orderMap});e=new ResultView({model:this.result,assessment:this.model,assessmentView:this});return this.subtestViews.push(e)};a.prototype.render=function(){var e,a=this;e=this.subtestViews[this.orderMap[this.index]];0===this.model.subtests.length?this.$el.append("<h1>Oops...</h1><p>This assessment is blank. Perhaps you meant to add some subtests.</p>"):
(this.$el.html("        <h1>"+this.model.get("name")+"</h1>        <div id='progress' style='float:left;width:90%;margin-top:7px;'></div><div id='progressCount' style='float:right;color:#8cc63f;font-weight:bold;'></div><div class='clear' style='clear:both;'></div>      "),2<this.index+1&&this.$el.find("#progress").progressbar({value:(this.index-1)/(this.model.subtests.length-1)*100}),2<this.index+1&&this.$el.find("#progressCount").html(""+(this.index-1)+"/"+(this.model.subtests.length-1)),e.on("rendered",
function(){return a.trigger("rendered")}),e.on("subRendered",function(){return a.trigger("subRendered")}),e.render(),this.$el.append(e.el),console.log("AssessmentRunView Renderred triggering"),MathJax.Hub.Queue(["Typeset",MathJax.Hub]));return this.trigger("rendered")};a.prototype.onClose=function(){var e,a,b,d;d=this.subtestViews;a=0;for(b=d.length;a<b;a++)e=d[a],e.close();this.result.clear();$("#current_student_id").fadeOut(250,function(){return $(this).html("").show()});return $("#current_student").fadeOut(250)};
a.prototype.abort=function(){this.abortAssessment=!0;return this.next()};a.prototype.skip=function(){var e;e=this.subtestViews[this.orderMap[this.index]];this.result.add({name:e.model.get("name"),data:e.getSkipped(),subtestId:e.model.id,skipped:!0,prototype:e.model.get("prototype"),sum:e.getSum()});e.close();!0!==this.abortAssessment&&this.index++;!0===this.abortAssessment&&(this.index=this.subtestViews.length-1);this.render();return window.scrollTo(0,0)};a.prototype.next=function(){var e;e=this.subtestViews[this.orderMap[this.index]];
return e.isValid()?(this.result.add({name:e.model.get("name"),data:e.getResult(),subtestId:e.model.id,prototype:e.model.get("prototype"),sum:e.getSum()}),e.close(),!0!==this.abortAssessment&&this.index++,!0===this.abortAssessment&&(this.index=this.subtestViews.length-1),this.render(),window.scrollTo(0,0)):e.showErrors()};return a}(Backbone.View);var AssessmentImportView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
AssessmentImportView=function(b){function a(){this.updateProgress=__bind(this.updateProgress,this);this.updateActivity=__bind(this.updateActivity,this);this.updateFromActiveTasks=__bind(this.updateFromActiveTasks,this);this["import"]=__bind(this["import"],this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .import":"import","click .back":"back"};a.prototype.initialize=function(){var e=this;this.docsRemaining=0;this.serverStatus="checking...";return $.ajax({dataType:"jsonp",
url:Tangerine.config.address.cloud.host+":"+Tangerine.config.address.port+"/",success:function(a,b){e.serverStatus="Ok";return e.updateServerStatus()},error:function(a,b){e.serverStatus="Not available";return e.updateServerStatus()}})};a.prototype.updateServerStatus=function(){return this.$el.find("#server_connection").html(this.serverStatus)};a.prototype.back=function(){Tangerine.router.navigate("",!0);return!1};a.prototype["import"]=function(){var e;this.updateActivity();e=this.$el.find("#d_key").val();
this.newAssessment=new Assessment;this.newAssessment.on("status",this.updateActivity);this.newAssessment.updateFromServer(e);return this.activeTaskInterval=setInterval(this.updateFromActiveTasks,3E3)};a.prototype.updateFromActiveTasks=function(){var e=this;return $.couch.activeTasks({success:function(a){var b,d,f,g;g=[];d=0;for(f=a.length;d<f;d++)b=a[d],"replication"===b.type.toLowerCase()?(_.isEmpty(b.status)||(e.activity=b.status),g.push(e.updateProgress())):g.push(void 0);return g}})};a.prototype.updateActivity=
function(e,a){this.$el.find(".status").fadeIn(250);this.activity="";"import lookup"===e?this.activity="Finding assessment":"import success"===e?(clearInterval(this.activeTaskInterval),this.activity="Import successful"):"import error"===e?(clearInterval(this.activeTaskInterval),this.activity="Import error: "+a):"import empty"===e&&(clearInterval(this.activeTaskInterval),this.activity="Nothing Found: Please Check your Key");return this.updateProgress()};a.prototype.updateProgress=function(e){var a,
b,d;null!=e&&(null!=this.importList[e]?this.importList[e]++:this.importList[e]=1);a="<table>";d=this.importList;for(e in d)b=d[e],a+="<tr><td>"+e.titleize().pluralize()+"</td><td>"+b+"</td></tr>";null!=this.activity&&(a+="<tr><td colspan='2'>"+this.activity+"</td></tr>");a+="</table>";return this.$el.find("#progress").html(a)};a.prototype.render=function(){this.$el.html("    <button class='back navigation'>Back</button>    <h1>Tangerine Central Import</h1>    <div class='question'>      <label for='d_key'>Download keys</label>      <input id='d_key' value=''>      <button class='import command'>Import</button><br>      <small>Server connection: <span id='server_connection'>"+
this.serverStatus+"</span></small>    </div>    <div class='confirmation status'>      <h2>Status<h2>      <div class='info_box' id='progress'></div>    </div>    ");return this.trigger("rendered")};return a}(Backbone.View);var Subtest,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Subtest=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="subtest";a.prototype.initialize=function(e){this.templates=Tangerine.templates.prototypeTemplates;if(this.has("surveyAttributes")&&this.get("assessmentId")!==this.get("surveyAttributes").assessmentId)return this.save("surveyAttributes",{_id:this.id,assessmentId:this.get("assessmentId")})};a.prototype.loadPrototypeTemplate=function(e){var a,b;b=this.templates[e];for(a in b)e=b[a],
this.set(a,e);return this.save()};a.prototype.copyTo=function(a){var c,b,d=this;b=this.clone();c=Utils.guid();b.has("surveyAttributes")&&b.set("surveyAttributes",{_id:c,assessmentId:a});b.save({_id:c,assessmentId:a,order:0,gridLinkId:""});return(new Questions).fetch({key:this.get("assessmentId"),success:function(b){var h,k,l;b=b.where({subtestId:d.id});k=0;for(l=b.length;k<l;k++)h=b[k],h=h.clone(),h.save({assessmentId:a,_id:Utils.guid(),subtestId:c});Tangerine.router.navigate("edit/"+a,!0);return Utils.midAlert("Subtest copied")}})};
return a}(Backbone.Model);var Subtests,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Subtests=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="subtest";a.prototype.model=Subtest;a.prototype.db={view:"subtestsByAssessmentId"};a.prototype.comparator=function(a){return a.get("order")};a.prototype.initialize=function(a){};a.prototype.fetch=function(e){return a.__super__.fetch.call(this,e)};a.prototype.maintainOrder=function(){var a,c,b,d,f,g,k;d=function(){var a,e,b,h;b=this.models;h=[];a=0;for(e=b.length;a<e;a++)c=b[a],
h.push(c.get("order"));return h}.call(this).join("");b=function(){var b,h,d,f;d=this.models;f=[];a=b=0;for(h=d.length;b<h;a=++b)c=d[a],f.push(a);return f}.call(this).join("");if(d!==b){g=this.models;k=[];a=d=0;for(f=g.length;d<f;a=++d)b=g[a],b.set("order",a),k.push(b.save());return k}};return a}(Backbone.Collection);var SubtestListEditView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SubtestListEditView=function(b){function a(){this.deleteSubtest=__bind(this.deleteSubtest,this);this.render=__bind(this.render,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="ul";a.prototype.initialize=function(a){this.assessment=a.assessment;return this.views=[]};a.prototype.render=function(){var a=this;this.closeViews();this.assessment.subtests.sort();return this.assessment.subtests.each(function(c){c=new SubtestListElementView({subtest:c,group:a.assessment.get("group")});
a.views.push(c);c.render();c.on("subtest:delete",a.deleteSubtest);return a.$el.append(c.el)})};a.prototype.deleteSubtest=function(a){this.assessment.subtests.remove(a);return a.destroy()};a.prototype.closeViews=function(){var a,c,b,d;d=this.views;c=0;for(b=d.length;c<b;c++)a=d[c],a.close();return this.views=[]};return a}(Backbone.View);var SubtestListElementView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SubtestListElementView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="li";a.prototype.className="subtest_element";a.prototype.events={"click .icon_edit":"edit","click .icon_delete":"toggleDeleteConfirm","click .delete_cancel":"toggleDeleteConfirm","click .delete_delete":"delete","click .icon_copy":"openCopyMenu","click .do_copy":"doCopy","click .cancel_copy":"cancelCopy"};a.prototype.toggleDeleteConfirm=function(){this.$el.find(".delete_confirm").fadeToggle(250);
return!1};a.prototype["delete"]=function(){this.trigger("subtest:delete",this.model);return!1};a.prototype.edit=function(){return Tangerine.router.navigate("subtest/"+this.model.id,!0)};a.prototype.initialize=function(a){this.model=a.subtest;this.group=a.group;return this.$el.attr("data-id",this.model.id)};a.prototype.openCopyMenu=function(){this.$el.find(".copy_menu").removeClass("confirmation");this.$el.find(".copy_select").append("<option disabled='disabled' selected='selected'>Loading assessments...</option>");
return this.fetchAssessments()};a.prototype.fetchAssessments=function(){var a=this;this.groupAssessments=[];return(new Assessments).fetch({success:function(c){a.groupAssessments=c.where({group:a.group});return a.populateAssessmentSelector()}})};a.prototype.populateAssessmentSelector=function(){var a,c,b,d,f;c="";f=this.groupAssessments;b=0;for(d=f.length;b<d;b++)a=f[b],c+="<option data-assessmentId='"+a.id+"'>"+a.get("name")+"</option>";return this.$el.find(".copy_select").html(c)};a.prototype.doCopy=
function(a){this.model.copyTo(this.$el.find(".copy_select :selected").attr("data-assessmentId"));return this.$el.find(".copy_menu").addClass("confirmation")};a.prototype.cancelCopy=function(){return this.$el.find(".copy_menu").addClass("confirmation")};a.prototype.render=function(){var a,c;c=this.model.get("name");a="<span class='small_grey'>"+this.model.get("prototype")+"</span>";this.$el.html("      <table><tr>      <td><img src='images/icon_drag.png' title='Drag to reorder' class='icon sortable_handle'></td>      <td>        "+
c+"        "+a+"        <img src='images/icon_edit.png' title='Edit' class='icon icon_edit'>        <img src='images/icon_copy_to.png' title='Copy to...' class='icon icon_copy'>        <img src='images/icon_delete.png' title='Delete' class='icon icon_delete'>        <br><span class='delete_confirm'><div class='menu_box'>Confirm <button class='delete_delete command_red'>Delete</button> <button class='delete_cancel command'>Cancel</button></div></span>        <div class='confirmation copy_menu'><select class='copy_select'></select><br><button class='do_copy command'>Copy</button> <button class='cancel_copy command'>Cancel</button></div>      </td>      </tr></table>    ");
return this.trigger("rendered")};return a}(Backbone.View);var SubtestEditView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SubtestEditView=function(b){function a(){this.goBack=__bind(this.goBack,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="subtest_edit";a.prototype.events={"click .back_button":"goBack","click .save_subtest":"save","click .edit_enumerator":"editEnumerator","click .enumerator_done":"doneEnumerator","click .enumerator_cancel":"cancelEnumerator","click .edit_student":"editStudent","click .student_done":"doneStudent","click .student_cancel":"cancelStudent"};
a.prototype.editEnumerator=function(){this.$el.find(".enumerator_help_preview, .edit_enumerator, .enumerator_save_buttons").fadeToggle(250);return this.$el.find("textarea#enumerator_help").html(this.model.escape("enumeratorHelp")||"").cleditor()};a.prototype.doneEnumerator=function(){if(this.model.save({enumeratorHelp:this.$el.find("textarea#enumerator_help").val(),wait:!0}))return this.cancelEnumerator()};a.prototype.cancelEnumerator=function(){var a;a=$("div.enumerator_help_preview");a.html(this.model.get("enumeratorHelp")||
"");a.fadeIn(250);this.$el.find("button.edit_enumerator, .enumerator_save_buttons").fadeToggle(250);a=this.$el.find("#enumerator_help").cleditor()[0];a.$area.insertBefore(a.$main);a.$area.removeData("cleditor");return a.$main.remove()};a.prototype.editStudent=function(){this.$el.find(".student_dialog_preview, .edit_student, .student_save_buttons").fadeToggle(250);return this.$el.find("textarea#student_dialog").html(this.model.escape("studentDialog")||"").cleditor()};a.prototype.doneStudent=function(){if(this.model.save({studentDialog:this.$el.find("textarea#student_dialog").val(),
wait:!0}))return this.cancelStudent()};a.prototype.cancelStudent=function(){var a;a=$("div.student_dialog_preview");a.html(this.model.get("studentDialog")||"");a.fadeIn(250);this.$el.find("button.edit_student, .student_save_buttons").fadeToggle(250);a=this.$el.find("#student_dialog").cleditor()[0];a.$area.insertBefore(a.$main);a.$area.removeData("cleditor");return a.$main.remove()};a.prototype.onClose=function(){var a;return"function"===typeof(a=this.prototypeEditor).close?a.close():void 0};a.prototype.initialize=
function(a){this.model=a.model;this.assessment=a.assessment;this.config=Tangerine.config.subtest;this.prototypeViews=Tangerine.config.prototypeViews;return this.prototypeEditor=new (window[this.prototypeViews[this.model.get("prototype")].edit])({model:this.model,parent:this})};a.prototype.goBack=function(){return Tangerine.router.navigate("edit/"+this.model.get("assessmentId"),!0)};a.prototype.save=function(a){var c,b;this.model.get("prototype");this.model.set({name:this.$el.find("#subtest_name").val(),
enumeratorHelp:this.$el.find("#enumerator_help").val(),studentDialog:this.$el.find("#student_dialog").val(),skippable:"true"===this.$el.find("#skip_radio input:radio[name=skippable]:checked").val()});"function"===typeof(c=this.prototypeEditor).save&&c.save();return null!=this.prototypeEditor.isValid&&!1===this.prototypeEditor.isValid()?(Utils.midAlert("There are errors on this page"),"function"===typeof(b=this.prototypeEditor).showErrors?b.showErrors():void 0):this.model.save(null,{wait:!0})?(Utils.midAlert("Subtest Saved"),
setTimeout(this.goBack,1E3)):Utils.midAlert("Save error")};a.prototype.render=function(){var a,c,b,d,f,g,k;a=this.assessment.escape("name");d=this.model.escape("name");f=this.model.get("prototype");b=this.model.get("enumeratorHelp")||"";c=this.model.get("studentDialog")||"";g=!0===this.model.get("skippable")||"true"===this.model.get("skippable");this.$el.html("      <button class='back_button navigation'>Back</button><br>      <h1>Subtest Editor</h1>      <table class='basic_info'>        <tr>          <th>Assessment</th>          <td>"+
a+"</td>        </tr>      </table>      <button class='save_subtest command'>Done</button>      <div id='subtest_edit_form' class='edit_form'>        <div class='label_value'>          <label for='subtest_name'>Name</label>          <input id='subtest_name' value='"+d+"'>        </div>        <div class='label_value'>          <label for='subtest_prototype' title='This is a basic type of subtest. (e.g. Survey, Grid, Location, Id, Consent). This property is set in assessment builder when you add a subtest. It is unchangeable.'>Prototype</label><br>          <div class='info_box'>"+
f+"</div>        </div>        <div class='label_value'>          <label>Skippable</label><br>          <div class='menu_box'>            <div id='skip_radio' class='buttonset'>              <label for='skip_true'>Yes</label><input name='skippable' type='radio' value='true' id='skip_true' "+(g?"checked":void 0)+">              <label for='skip_false'>No</label><input name='skippable' type='radio' value='false' id='skip_false' "+(g?void 0:"checked")+">            </div>          </div>        </div>        <div class='label_value'>          <label for='enumerator_help' title='If text is supplied, a help button will appear at the top of the subtest as a reference for the enumerator. If you are pasting from word it is recommended to paste into a plain text editor first, and then into this box.'>Enumerator help <button class='edit_enumerator command'>Edit</button></label>          <div class='info_box_wide enumerator_help_preview'>"+
b+"</div>          <textarea id='enumerator_help' class='confirmation'>"+b+"</textarea>          <div class='enumerator_save_buttons confirmation'>            <button class='enumerator_done command'>Save</button> <button class='enumerator_cancel command'>Cancel</button>          </div>        </div>        <div class='label_value'>          <label for='student_dialog' title='Generally this is a script that will be read to the student. If you are pasting from word it is recommended to paste into a plain text editor first, and then into this box.'>Student Dialog <button class='edit_student command'>Edit</button></label>          <div class='info_box_wide student_dialog_preview'>"+
c+"</div>          <textarea id='student_dialog' class='confirmation'>"+c+"</textarea>          <div class='student_save_buttons confirmation'>            <button class='student_done command'>Save</button> <button class='student_cancel command'>Cancel</button>          </div>        </div>      </div>      <div id='prototype_attributes'></div>      <button class='save_subtest command'>Done</button>      ");this.prototypeEditor.setElement(this.$el.find("#prototype_attributes"));"function"===typeof(k=
this.prototypeEditor).render&&k.render();return this.trigger("rendered")};return a}(Backbone.View);var SubtestRunView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SubtestRunView=function(b){function a(){this.hideNext=__bind(this.hideNext,this);this.showNext=__bind(this.showNext,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .next":"next","click .subtest_help":"toggleHelp","click .skip":"skip"};a.prototype.toggleHelp=function(){return this.$el.find(".enumerator_help").fadeToggle(250)};a.prototype.initialize=function(a){this.protoViews=Tangerine.config.prototypeViews;this.model=a.model;this.parent=a.parent;
return this.prototypeRendered=!1};a.prototype.render=function(){var a,c,b,d=this;a=""!==(this.model.get("enumeratorHelp")||"")?"<button class='subtest_help command'>help</button><div class='enumerator_help'>"+this.model.get("enumeratorHelp")+"</div>":"";b=""!==(this.model.get("studentDialog")||"")?"<div class='student_dialog'>"+this.model.get("studentDialog")+"</div>":"";c=!0===this.model.get("skippable")||"true"===this.model.get("skippable");this.$el.html("    <div class='controlls'>        <button class='next navigation'>Next</button>"+
(c?"<button class='skip navigation'>Skip</button>":"")+"      </div>      <h2>"+this.model.get("name")+"</h2>      "+a+"      "+b+"      <div id='prototype_wrapper'></div>      <div class='controlls'>        <button class='next navigation'>Next</button>"+(c?"<button class='skip navigation'>Skip</button>":"")+"      </div>    ");this.prototypeView=new (window[this.protoViews[this.model.get("prototype")].run])({model:this.model,parent:this});this.prototypeView.on("rendered",function(){return d.trigger("rendered")});
this.prototypeView.on("subRendered",function(){return d.trigger("subRendered")});this.prototypeView.on("showNext",function(){return d.showNext()});this.prototypeView.on("hideNext",function(){return d.hideNext()});this.prototypeView.setElement(this.$el.find("#prototype_wrapper"));this.prototypeView.render();this.prototypeRendered=!0;console.log("Triggering Subtest Runder");this.trigger("rendered");if("datetime"===this.model.get("prototype"))return setTimeout(function(){return $(".next").trigger("click")},
500)};a.prototype.showNext=function(){return this.$el.find(".controlls").show()};a.prototype.hideNext=function(){return this.$el.find(".controlls").hide()};a.prototype.getGridScore=function(){var a;if(""!==(this.model.get("gridLinkId")||""))return a=this.parent.model.subtests.get(this.model.get("gridLinkId")),a=this.parent.result.getGridScore(a.id)};a.prototype.gridWasAutostopped=function(){var a;if(""!==(this.model.get("gridLinkId")||""))return a=this.parent.model.subtests.get(this.model.get("gridLinkId")),
this.parent.result.gridWasAutostopped(a.id)};a.prototype.onClose=function(){var a;return null!=(a=this.prototypeView)?"function"===typeof a.close?a.close():void 0:void 0};a.prototype.isValid=function(){return this.prototypeRendered?null!=this.prototypeView.isValid?this.prototypeView.isValid():!1:!1};a.prototype.showErrors=function(){return this.prototypeView.showErrors()};a.prototype.getSum=function(){return null!=this.prototypeView.getSum?this.prototypeView.getSum():{correct:0,incorrect:0,missing:0,
total:0}};a.prototype.abort=function(){return this.parent.abort()};a.prototype.getResult=function(){return this.prototypeView.getResult()};a.prototype.getSkipped=function(){if(null!=this.prototypeView.getSkipped)return this.prototypeView.getSkipped();throw"Prototype skipping not implemented";};a.prototype.next=function(){return this.parent.next()};a.prototype.skip=function(){return this.parent.skip()};return a}(Backbone.View);var ConsentRunView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ConsentRunView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click #non_consent_confirm":"noConsent","click #consent_yes":"clearMessages","click #consent_no":"showNonConsent"};a.prototype.initialize=function(a){this.confirmedNonConsent=!1;this.model=this.options.model;return this.parent=this.options.parent};a.prototype.render=function(){this.$el.html("    <form>      <div class='question'>        <label>"+(this.model.get("prompt")||
"Does the child consent?")+"</label>        <div class='messages'></div>        <div class='non_consent_form confirmation'>          <div>Click to confirm consent not obtained.</div>          <button id='non_consent_confirm'>Confirm</button>        </div>        <div id='consent_options' class='buttonset'>          <label for='consent_yes'>Yes, continue</label>          <input id='consent_yes' type='radio' name='participant_consents' value='yes'>          <label for='consent_no'>No, stop</label>          <input id='consent_no' type='radio' name='participant_consents' value='no'>        </div>      </div>    </form>    ");
return this.trigger("rendered")};a.prototype.isValid=function(){return!1===this.confirmedNonConsent?"yes"===this.$el.find("input[name=participant_consents]:checked").val()?!0:!1:!0};a.prototype.showNonConsent=function(){return this.$el.find(".non_consent_form").show(250)};a.prototype.clearMessages=function(){this.$el.find(".non_consent_form").hide(250);return this.$el.find(".messages").html("")};a.prototype.noConsent=function(){this.confirmedNonConsent=!0;this.parent.abort();return!1};a.prototype.getSkipped=
function(){return{consent:"skipped"}};a.prototype.showErrors=function(){var a;a=this.$el.find("input[name=participant_consents]:checked").val();if("no"===a)return Utils.midAlert("Please confirm"),this.showNonConsent;if(void 0===a)return $(".messages").html("Please select one")};a.prototype.getResult=function(){return{consent:this.$el.find("input[name=participant_consents]:checked").val()}};a.prototype.getSum=function(){return{correct:1,incorrect:0,missing:0,total:1}};return a}(Backbone.View);var ConsentEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ConsentEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.model=a.model;return this.parent=a.parent};a.prototype.save=function(){return this.model.set({prompt:this.$el.find("#consent_prompt").val()})};a.prototype.render=function(){var a;a=this.model.get("prompt")||"";return this.$el.html("      <div class='label_value'>        <label for='consent_prompt'>Consent prompt</label>        <input id='consent_prompt' value='"+
a+"'>      </div>    ")};return a}(Backbone.View);var DatetimeRunView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
DatetimeRunView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="datetime";a.prototype.initialize=function(a){this.model=this.options.model;return this.parent=this.options.parent};a.prototype.render=function(){var a,c,b,d,f;a=new Date;f=a.getFullYear();d="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getMonth()];c=a.getDate();b=a.getMinutes();10>b&&(b="0"+b);a=a.getHours()+":"+b;this.$el.html("      <form>          <table>            <tr>              <td><label for='year'>Year</label><input id='year' name='year' value='"+
f+"'></td>              <td><label for='month'>Month</label><input id='month' type='month' name='month' value='"+d+"'></td>              <td><label for='day'>Day</label><input id='day' type='day' name='day' value='"+c+"'></td>            </tr>          </table>          <label for='time'>Time</label><br><input type='text' id='time' name='time' value='"+a+"'>      </form>      ");return this.trigger("rendered")};a.prototype.getResult=function(){return{year:this.$el.find("#year").val(),month:this.$el.find("#month").val(),
day:this.$el.find("#day").val(),time:this.$el.find("#time").val()}};a.prototype.getSkipped=function(){return{year:"skipped",month:"skipped",day:"skipped",time:"skipped"}};a.prototype.getSum=function(){return{correct:1,incorrect:0,missing:0,total:1}};a.prototype.isValid=function(){return!0};return a}(Backbone.View);var DatetimeEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};DatetimeEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.model=a.model;return this.parent=a.parent};return a}(Backbone.View);var LocationRunView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
LocationRunView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .school_list li":"autofill","click .school_list li.licomp":"licomp","click .school_list li.lipend":"lipend","keyup input.search":"showOptions","click .clear":"clearInputs","click .showall":"showAll"};a.prototype.initialize=function(a){var c,b,d,f,g,k,l,m=this;this.pendResAr=[];this.compResAr=[];this.all=!1;this.penNam=[];this.penkeys=[];this.compNam=[];this.samAssessmentId=
a.parent.model.attributes.assessmentId;this.resultarray=new Results;this.resultarray.fetch({key:this.samAssessmentId,success:function(a){_.each(a.models,function(a){var e,c;if(null!=(null!=(c=_.last(a.attributes.subtestData))?c.data.end_time:void 0))return m.compResAr.push(a.attributes.subtestData);m.pendResAr.push(a.attributes.subtestData);0===m.penkeys.length&&m.penkeys.push(a.id);e=!1;_.each(m.penkeys,function(c){if(c!==a.id)return e=!0});if(e)return m.penkeys.push(a.id)});_.each(m.pendResAr,function(a){return _.each(a,
function(a){var e;if(null!=(null!=a?a.prototype:void 0)&&"location"===a.prototype&&null!=(null!=(e=a.data)?e.location:void 0))return m.penNam.push(a.data.location)})});return _.each(m.compResAr,function(a){return _.each(a,function(a){var e;if(null!=(null!=a?a.prototype:void 0)&&"location"===a.prototype&&null!=(null!=(e=a.data)?e.location:void 0))return m.compNam.push(a.data.location)})})}});this.model=this.options.model;this.parent=this.options.parent;this.levels=this.model.get("levels")||[];this.locations=
this.model.get("locations")||[];1===this.levels.length&&""===this.levels[0]&&(this.levels=[]);1===this.locations.length&&""===this.locations[0]&&(this.locations=[]);this.haystack=[];l=this.locations=this.locations.sort();a=d=0;for(g=l.length;d<g;a=++d)for(c=l[a],this.haystack[a]=[],f=0,k=c.length;f<k;f++)b=c[f],this.haystack[a].push(b.toLowerCase());c="<li class='cont' data-index='{{i}}'>";d=this.levels;a=b=0;for(d=d.length;b<d;a=++b)c+="{{level_"+a+"}}",a!==this.levels.length-1&&(c+=" - ");this.li=
_.template(c+"</li>");this.btnreset=_.template('<button class="restart-btn navigation">Restart</button>');return this.btnresume=_.template('<button class="resume-btn navigation">Resume</button>')};a.prototype.clearInputs=function(){var a,c,b,d;this.clearMessage();this.clearButton();$("#samSearchBox").val("");$(".tohide").hide();b=this.levels;d=[];a=c=0;for(b=b.length;c<b;a=++c)d.push(this.$el.find("#level_"+a).val(""));return d};a.prototype.autofill=function(a){var c,b,d,f;console.log("autofill");
this.clearMessage();this.clearButton();$(".tohide").show();this.$el.find(".autofill").fadeOut(250);a=$(a.target).attr("data-index");c=this.locations[a];d=this.levels;f=[];a=b=0;for(d=d.length;b<d;a=++b)f.push(this.$el.find("#level_"+a).val(c[a]));return f};a.prototype.showOptions=function(a){var c,b,d,f,g,k,l,m,q,n;console.log("showOptions");this.clearMessage();b=$(a.target).val().toLowerCase();if(""!==b||this.all){a=parseInt($(a.target).attr("data-level"));g=c=0;for(d=this.haystack.length;0<=d?c<=
d:c>=d;g=0<=d?++c:--c)this.$el.find("#autofill_"+g).hide();c=!1;g=[];f=this.haystack;d=l=0;for(m=f.length;l<m;d=++l)f=this.all?0:this.haystack[d][a].search(RegExp("^"+b,"i")),0===f&&(g.push(d),c=!0);n=this.haystack;d=l=0;for(q=n.length;l<q;d=++l)for(k=n[d],f=m=0,k=k.length;m<k;f=++m)f!==a&&((f=~this.haystack[d][f].indexOf(b))&&!~g.indexOf(d)&&g.push(d),f&&(c=!0));if(c){b="";f=0;for(d=g.length;f<d;f++)c=g[f],b+=this.getLocationLi(c);this.$el.find("#autofill_"+a).fadeIn(250);this.$el.find("#school_list_"+
a).html(b)}else this.$el.find("#autofill_"+a).fadeOut(250)}else $(".autofill").hide();return this.all=!1};a.prototype.getLocationLi=function(a){var c,b,d,f,g,k,l,m=this;f={i:a};l=this.locations[a];a=g=0;for(k=l.length;g<k;a=++g)d=l[a],f["level_"+a]=d,c=this.li(f),b=!1,_.each(this.penNam,function(a,e){var f;f=[];f.push(d);_.isEqual(f,a)&&(c=c.replace("<li class='cont'","<li class='lipend' style='color:red;' data-key='"+m.penkeys[e]+"' "));if(_.isEqual(f,a))return b=!0}),!0===b&&(c=c.replace("</li>",
" (Incomplete) </li>")),b=!1,_.each(this.compNam,function(a){var e;e=[];e.push(d);if(_.isEqual(e,a))return c=c.replace("<li class='cont'","<li class='licomp' style='color:green;'")});return c};a.prototype.render=function(){var a,c,b,d;d=this.levels;c=b=0;for(d=d.length;b<d;c=++b)a="<input class='search' val='' data-level='"+c+"' id='samSearchBox' placeholder='Search For Student Name'>";a+="      <button class='clear command'>Clear</button> <button class='showall command'>Show all names</button>      ";
d=this.levels;c=b=0;for(d=d.length;b<d;c=++b)a+="        <div class='label_value tohide' style='display:none'>          <label>Selected Student Name: </label>          <input class='name-field' data-level='"+c+"' id='level_"+c+"' value='' disabled style='background:white;border:0px;width: 70%;color:#476F00 !important;font-weight: bold;'>        </div>        <div id='autofill_"+c+"' class='autofill' style='display:none'>          <h2>Select one from autofill list</h2>          <ul class='school_list' id='school_list_"+
c+"'>          </ul>        </div>    ";this.$el.html(a);return this.trigger("rendered")};a.prototype.getResult=function(){var a,c;return{labels:function(){var a,e,b,g;b=this.levels;g=[];a=0;for(e=b.length;a<e;a++)c=b[a],g.push(c.replace(/[\s-]/g,"_"));return g}.call(this),location:function(){var b,d,f,g;f=this.levels;g=[];a=b=0;for(d=f.length;b<d;a=++b)c=f[a],g.push($.trim(this.$el.find("#level_"+a).val()));return g}.call(this)}};a.prototype.getSkipped=function(){var a,c;return{labels:function(){var a,
e,b,g;b=this.levels;g=[];a=0;for(e=b.length;a<e;a++)c=b[a],g.push(c.replace(/[\s-]/g,"_"));return g}.call(this),location:function(){var b,d,f,g;f=this.levels;g=[];a=b=0;for(d=f.length;b<d;a=++b)c=f[a],g.push("skipped");return g}.call(this)}};a.prototype.isValid=function(){var a,c,b,d;this.$el.find(".message").remove();d=this.$el.find("input");c=0;for(b=d.length;c<b;c++)if(a=d[c],""===$(a).val())return!1;return!0};a.prototype.showErrors=function(){var a,c,b,d,f;d=this.$el.find("input.name-field");
f=[];c=0;for(b=d.length;c<b;c++)a=d[c],""===$(a).val()?f.push($(a).parent().after(" <span class='message' style='color:red;clear:both;display:block;'>Please select a student to proceed.</span>")):f.push(void 0);return f};a.prototype.getSum=function(){var a,c,b,d,f;c={correct:0,incorrect:0,missing:0,total:0};f=this.$el.find("input");b=0;for(d=f.length;b<d;b++)a=f[b],a=$(a),""!==(a.val()||"")&&(c.correct+=1),""===(a.val()||"")&&(c.missing+=1),c.total+=1;return{correct:c.correct,incorrect:c.incorrect,
missing:c.missing,total:c.total}};a.prototype.licomp=function(a){$("button.next").hide();0===$("button.restart-btn").length?$("div.controlls").append(this.btnreset):$("button.restart-btn").show();return $("button.restart-btn").unbind("click").click(function(){if(confirm("Are you sure you want to restart this assessment?"))return $("button.next").trigger("click")})};a.prototype.lipend=function(a){var c,b,d,f=this;null!=(null!=a?null!=(b=a.currentTarget)?null!=(d=b.dataset)?d.key:void 0:void 0:void 0)&&
(c=a.currentTarget.dataset.key);this.licomp();$("button.restart-btn").unbind("click").click(function(){if(confirm("Are you sure you want to restart this assessment?"))return Tangerine.$db.openDoc(c,{success:function(a){return Tangerine.$db.removeDoc({_id:""+a._id,_rev:""+a._rev},{success:function(a){return $("button.next").trigger("click")}})}})});0===$("button.resume-btn").length?$("div.controlls").append(this.btnresume):$("button.resume-btn").show();return $("button.resume-btn").unbind("click").click(function(){return Tangerine.router.navigate("resume/"+
f.samAssessmentId+"/"+c,!0)})};a.prototype.clearButton=function(){$("button.restart-btn").hide();$("button.resume-btn").hide();$("button.next").show();return $(".autofill").hide()};a.prototype.clearMessage=function(){return $("span.message").hide()};a.prototype.showAll=function(){this.all=!0;$("input.search").val("  ");return $("input.search").trigger("keyup")};return a}(Backbone.View);var LocationEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b},__indexOf=[].indexOf||function(b){for(var a=0,e=this.length;a<e;a++)if(a in this&&this[a]===b)return a;return-1};
LocationEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"keyup #data":"updateData","keyup #levels":"updateLevels","click #data_format input":"updateData","click #levels_format input":"updateLevels"};a.prototype.updateData=function(a){var c;"click"===(null!=a?a.type:void 0)?"Tabs"===$(a.target).val()?(this.dataCommaToTab(),c=!0):(this.dataTabToComma(),c=!1):(a=this.$el.find("#data").val(),c=null!=a.match(/\t/g),a.match(/,/g));
c?this.$el.find("#data_format :radio[value='Tabs']").attr("checked","checked"):this.$el.find("#data_format :radio[value='Commas']").attr("checked","checked");return this.$el.find("#data_format").buttonset("refresh")};a.prototype.updateLevels=function(a){var c;"click"===(null!=a?a.type:void 0)?"Tabs"===$(a.target).val()?this.levelsCommaToTab():this.levelsTabToComma():(c=this.$el.find("#levels").val(),c.match(/\t/g),c.match(/,/g));c=this.$el.find("#levels").val();a=null!=c.match(/\t/g);c.match(/,/g);
a?this.$el.find("#levels_format :radio[value='Tabs']").attr("checked","checked"):this.$el.find("#levels_format :radio[value='Commas']").attr("checked","checked");return this.$el.find("#levels_format").buttonset("refresh")};a.prototype.dataTabToComma=function(){return this.$el.find("#data").val(String(this.$el.find("#data").val()).replace(/\t/g,", "))};a.prototype.dataCommaToTab=function(){return this.$el.find("#data").val(this.$el.find("#data").val().replace(/, */g,"\t"))};a.prototype.levelsTabToComma=
function(){return this.$el.find("#levels").val(String(this.$el.find("#levels").val()).replace(/\t/g,", "))};a.prototype.levelsCommaToTab=function(){return this.$el.find("#levels").val(this.$el.find("#levels").val().replace(/, */g,"\t"))};a.prototype.save=function(){var a,c,b,d,f,g;null!=this.$el.find("#data").val().match(/\t/g)&&(this.$el.find("#data_format :radio[value='Tabs']").attr("checked","checked"),this.$el.find("#data_format").buttonset("refresh"),this.dataTabToComma());null!=this.$el.find("#levels").val().match(/\t/g)&&
(this.levelsTabToComma(),this.$el.find("#levels_format :radio[value='Tabs']").attr("checked","checked"),this.$el.find("#levels_format").buttonset("refresh"));b=this.$el.find("#levels").val().split(/, */g);a=d=0;for(f=b.length;d<f;a=++d)c=b[a],b[a]=$.trim(c).replace(/[^a-zA-Z0-9']/g,"");d=$.trim(this.$el.find("#data").val()).split("\n");a=f=0;for(g=d.length;f<g;a=++f)c=d[a],d[a]=c.split(/, */g);return this.model.set({levels:b,locations:d})};a.prototype.isValid=function(){var a,c,b,d,f;a=this.model.get("levels");
f=this.model.get("locations");b=0;for(d=f.length;b<d;b++)c=f[b],c.length!==a.length&&0>__indexOf.call(this.errors,"column_match")&&this.errors.push("column_match");return 0===this.errors.length};a.prototype.showErrors=function(){var a,c,b,d,f;a="Please correct the following errors:\n\n";f=this.errors;b=0;for(d=f.length;b<d;b++)c=f[b],a+=this.errorMessages[c];alert(a);return this.errors=[]};a.prototype.initialize=function(a){this.errors=[];this.model=a.model;return this.errorMessages={column_match:"Some columns in the location data do not match the number of columns in the geographic levels."}};
a.prototype.render=function(){var a,c,b,d,f,g;c=this.model.get("levels")||[];d=this.model.get("locations")||[];c=c.join(", ");d=d.join("\n");if(_.isArray(d))for(a=f=0,g=d.length;f<g;a=++f)b=d[a],d[a]=b.join(", ");this.$el.html("      <div class='label_value'>        <div class='menu_box'>          <label for='levels' title='This is a comma separated list of geographic levels. (E.g. Country, Province, District, School Id) These are the levels that you would consider individual fields on the location form.'>Geographic Levels</label>          <input id='levels' value='"+
c+"'>          <label title='Tangerine uses comma separated values. If you copy and paste from another program like Excel, the values will be tab separated. These buttons allow you to switch back and forth, however, Tangerine will always save the comma version.'>Format</label><br>          <div id='levels_format' class='buttonset'>            <label for='levels_tabs'>Tabs</label>            <input id='levels_tabs' name='levels_format' type='radio' value='Tabs'>            <label for='levels_commas'>Commas</label>            <input id='levels_commas' name='levels_format' type='radio' value='Commas'>          </div>        </div>      </div>      <div class='label_value'>        <div class='menu_box'>          <label for='data' title='Comma sperated values, with multiple rows separated by line. This information will be used to autofill the location data.'>Location data</label>          <textarea id='data'>"+
d+"</textarea><br>          <label title='Tangerine uses comma separated values. If you copy and paste from another program like Excel, the values will be tab separated. These buttons allow you to switch back and forth, however, Tangerine will always save the comma version.'>Format</label><br>        <div id='data_format' class='buttonset'>            <label for='data_tabs'>Tabs</label>            <input id='data_tabs' name='data_format' type='radio' value='Tabs'>            <label for='data_commas'>Commas</label>            <input id='data_commas' name='data_format' type='radio' value='Commas'>        </div>              </div>    ");
this.updateLevels();return this.updateData()};return a}(Backbone.View);var ResultOfQuestion,SurveyRunView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};ResultOfQuestion=function(b){return $("#question-"+b).attr("data-result")};
SurveyRunView=function(b){function a(){this.onQuestionRendered=__bind(this.onQuestionRendered,this);this.getResult=__bind(this.getResult,this);this.updateSkipLogic=__bind(this.updateSkipLogic,this);this.onQuestionAnswer=__bind(this.onQuestionAnswer,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"change input":"updateSkipLogic","change textarea":"updateSkipLogic"};a.prototype.initialize=function(a){var c=this;this.model=this.options.model;this.parent=
this.options.parent;this.isObservation=this.options.isObservation;this.questionViews=[];this.answered=[];this.questions=new Questions;return this.questions.fetch({key:this.model.get("assessmentId"),success:function(a){c.questions=new Questions(c.questions.where({subtestId:c.model.id}));c.questions.sort();return c.render()}})};a.prototype.onQuestionAnswer=function(a){var c,b,d,f,g;if(this.isObservation){a=$(a.target).attr("data-cid");f=this.questionViews;g=[];b=0;for(d=f.length;b<d;b++)if(c=f[b],c.cid===
a&&"multiple"!==c.type){for(c=$(c.el).next();0!==c.length&&c.hasClass("disabled_skipped");)c=$(c).next();0!==c.length?g.push(c.scrollTo()):g.push(void 0)}else g.push(void 0);return g}};a.prototype.updateSkipLogic=function(){this.questions.each(function(a){var c;c=a.get("skipLogic");if(null!=c)return(c=CoffeeScript.eval(""+c))?$("#question-"+a.get("name")).addClass("disabled_skipped"):$("#question-"+a.get("name")).removeClass("disabled_skipped")});return _.each(this.questionViews,function(a){return a.updateValidity()})};
a.prototype.isValid=function(){var a,c,b,d;d=this.questionViews;a=c=0;for(b=d.length;c<b;a=++c)if(a=d[a],a.updateValidity(),null!=a.isValid&&"true"!==a.model.get("skippable")&&!0!==a.model.get("skippable")&&!a.isValid)return!1;return!0};a.prototype.getSkipped=function(){var a,c,b,d;c={};d=this.questionViews;a=b=0;for(d=d.length;b<d;a=++b)c[this.questions.models[a].get("name")]="skipped";return c};a.prototype.getResult=function(){var a,c,b,d,f,g;b={};g=this.questionViews;a=d=0;for(f=g.length;d<f;a=
++d)c=g[a],b[this.questions.models[a].get("name")]=c.notAsked?c.notAskedResult:_.isEmpty(c.answer)?c.skipped?c.skippedResult:c.$el.hasClass("disabled_skipped")?c.logicSkippedResult:c.answer:c.answer;return b};a.prototype.getSum=function(){var a,c,b,d,f;a={correct:0,incorrect:0,missing:0,total:0};f=this.questionViews;c=b=0;for(d=f.length;b<d;c=++b)c=f[c],_.isString(c)?a.missing++:(c.isValid&&(a.correct+=1),c.isValid||(a.incorrect+=1),!c.isValid&&c.model.get(c.model.get("skippable"===!0))&&(a.missing+=
1),a.total+=1);return{correct:a.correct,incorrect:a.incorrect,missing:a.missing,total:a.total}};a.prototype.showErrors=function(){var a,c,b,d,f,g,k;this.$el.find(".message").remove();a=!0;g=this.questionViews;k=[];c=d=0;for(f=g.length;d<f;c=++d)b=g[c],_.isString(b)?k.push(void 0):(c="",b.isValid||(c="Please answer this question",!0===a&&(b.$el.scrollTo(),Utils.midAlert("Please correct the errors on this page"),a=!1)),k.push(b.setMessage(c)));return k};a.prototype.render=function(){var a,c,b,d,f,g,
k,l;b=0;this.questions.sort();if(null!=this.questions.models)for(l=this.questions.models,a=g=0,k=l.length;g<k;a=++g)d=l[a],c=parseInt(d.get("linkedGridScore"))||0,(c=0!==c&&this.parent.getGridScore()<c||this.parent.gridWasAutostopped())&&b++,d=new QuestionRunView({model:d,parent:this,notAsked:c,isObservation:this.isObservation}),d.on("rendered",this.onQuestionRendered),d.on("answer scroll",this.onQuestionAnswer),d.render(),this.questionViews[a]=d,this.$el.append(d.el);this.updateSkipLogic();this.questions.length===
b&&"function"===typeof(f=this.parent).next&&f.next();return this.trigger("rendered")};a.prototype.onQuestionRendered=function(){return this.trigger("subRendered")};a.prototype.onClose=function(){var a,c,b,d;d=this.questionViews;c=0;for(b=d.length;c<b;c++)a=d[c],"function"===typeof a.close&&a.close();return this.questionViews=[]};return a}(Backbone.View);var SurveyEditView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SurveyEditView=function(b){function a(){this.renderQuestions=__bind(this.renderQuestions,this);this.toggleAddQuestion=__bind(this.toggleAddQuestion,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .add_question":"toggleAddQuestion","click .add_question_cancel":"toggleAddQuestion","click .add_question_add":"addQuestion","keypress #question_name":"addQuestion"};a.prototype.initialize=function(a){var c=this;this.model=a.model;this.parent=a.parent;
this.model.questions=new Questions;return this.model.questions.fetch({key:this.model.get("assessmentId"),success:function(){c.model.questions=new Questions(c.model.questions.where({subtestId:c.model.id}));c.model.questions.maintainOrder();c.questionsEditView=new QuestionsEditView({questions:c.model.questions});c.model.questions.on("change",c.renderQuestions);return c.renderQuestions()}})};a.prototype.toggleAddQuestion=function(){var a=this;this.$el.find("#add_question_form, .add_question").fadeToggle(250,
function(){if(a.$el.find("#add_question_form").is(":visible"))return a.$el.find("#question_prompt").focus()});return!1};a.prototype.addQuestion=function(a){if("click"!==a.type&&13!==a.which)return!0;a=$.extend(Tangerine.templates.questionTemplate,{subtestId:this.model.id,assessmentId:this.model.get("assessmentId"),id:Utils.guid(),order:this.model.questions.length,prompt:this.$el.find("#question_prompt").val(),name:this.$el.find("#question_name").val().safetyDance()});this.model.questions.create(a);
this.renderQuestions();this.$el.find("#add_question_form input").val("");this.$el.find("#question_prompt").focus();return!1};a.prototype.save=function(){var a,c,b,d,f,g,k,l;this.model.set({gridLinkId:this.$el.find("#link_select option:selected").val()});b=[];a=[];f=[];l=this.model.questions.models;c=g=0;for(k=l.length;g<k;c=++g)d=l[c],"open"!==d.get("type")&&0===d.get("options").length&&a.push(c+1),d.save()||b.push(c),d.has("linkedGridScore")&&""!==d.get("linkedGridScore")&&0!==d.get("linkedGridScore")&&
""===this.model.has("gridLinkId")&&""===this.model.get("gridLinkId")&&f.push(c);0!==b.length&&Utils.midAlert("Error<br><br>Questions: <br>"+b.join(", ")+"<br>not saved");0!==a.length&&(b=(c=1<a.length)?"have":"has",alert("Warning\n\n"+(c?"Questions":"Question")+" "+a.join(" ,")+" "+b+" no options."));if(0!==f.length)return a=(c=1<a.length)?"require":"requires",alert("Warning\n\n"+(c?"Questions":"Question")+" "+f.join(" ,")+" "+a+" a grid to be linked to this test.")};a.prototype.onClose=function(){var a;
return null!=(a=this.questionsListEdit)?a.close():void 0};a.prototype.renderQuestions=function(){var a,c;this.$el.find("#question_list_wrapper").empty();null!=(a=this.questionsEditView)&&a.render();return this.$el.find("#question_list_wrapper").append(null!=(c=this.questionsEditView)?c.el:void 0)};a.prototype.render=function(){var a,c=this;a=this.model.get("gridLinkId")||"";this.$el.html("      <div id='grid_link'></div>      <div id='questions'>        <h2>Questions</h2>        <div class='menu_box'>          <div id='question_list_wrapper'><img class='loading' src='images/loading.gif'></div>          <button class='add_question command'>Add Question</button>          <div id='add_question_form' class='confirmation'>            <div class='menu_box'>              <h2>New Question</h2>              <label for='question_prompt'>Prompt</label>              <input id='question_prompt'>              <label for='question_name'>Variable name</label>              <input id='question_name' title='Allowed characters: A-Z, a-z, 0-9, and underscores.'><br>              <button class='add_question_add command'>Add</button><button class='add_question_cancel command'>Cancel</button>            </div>          </div>         </div>      </div>");
this.renderQuestions();return(new Subtests).fetch({key:this.model.get("assessmentId"),success:function(b){var d,f,g,k;b=b.where({prototype:"grid"});d="          <div class='label_value'>            <label for='link_select'>Linked to grid</label><br>            <div class='menu_box'>              <select id='link_select'>              <option value=''>None</option>";g=0;for(k=b.length;g<k;g++)f=b[g],d+="<option value='"+f.id+"' "+(a===f.id?"selected":"")+">"+f.get("name")+"</option>";d+="</select></div></div>";
return c.$el.find("#grid_link").html(d)}})};return a}(Backbone.View);var IdRunView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
IdRunView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="id";a.prototype.events={"click #generate":"generate","change #participant_id":"setValidator"};a.prototype.initialize=function(a){this.model=this.options.model;this.parent=this.options.parent;return this.validator=new CheckDigit};a.prototype.render=function(){this.$el.html("    <form>      <label for='participant_id'>Random Identifier</label>      <input id='participant_id' name='participant_id'>      <button id='generate' class='command'>Generate</button>      <div class='messages'></div>    </form>");
return this.trigger("rendered")};a.prototype.getResult=function(){return{participant_id:this.$el.find("#participant_id").val()}};a.prototype.getSkipped=function(){return{participant_id:"skipped"}};a.prototype.getSum=function(){return{correct:1,incorrect:0,missing:0,total:1}};a.prototype.setValidator=function(){return this.validator.set(this.$el.find("#participant_id").val())};a.prototype.isValid=function(){this.setValidator();return this.validator.isValid()?this.updateNavigation():!1};a.prototype.showErrors=
function(){return this.$el.find(".messages").html(this.validator.getErrors().join(", "))};a.prototype.generate=function(){this.$el.find(".messages").empty();this.$el.find("#participant_id").val(this.validator.generate());return!1};a.prototype.updateNavigation=function(){return Tangerine.nav.setStudent(this.$el.find("#participant_id").val())};return a}(Backbone.View);var IdEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};IdEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.model=a.model;return this.parent=a.parent};return a}(Backbone.View);var GridRunView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
GridRunView=function(b){function a(){this.updateMode=__bind(this.updateMode,this);this.updateCountdown=__bind(this.updateCountdown,this);this.removeUndo=__bind(this.removeUndo,this);this.lastHandler=__bind(this.lastHandler,this);this.intermediateItemHandler=__bind(this.intermediateItemHandler,this);this.markHandler=__bind(this.markHandler,this);this.gridClick=__bind(this.gridClick,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="grid_prototype";
a.prototype.events=Modernizr.touch?{"touchstart .grid_element":"gridClick","touchstart .end_of_grid_line":"endOfGridLineClick","click .grid_mode":"updateMode","click .start_time":"startTimer","click .stop_time":"stopTimer","click .restart":"restartTimer"}:{"click .end_of_grid_line":"endOfGridLineClick","click .grid_element":"gridClick","click .grid_mode":"updateMode","click .start_time":"startTimer","click .stop_time":"stopTimer","click .restart":"restartTimer"};a.prototype.restartTimer=function(){this.resetVariables();
return this.$el.find(".element_wrong").removeClass("element_wrong")};a.prototype.gridClick=function(a){var c,b;return"function"===typeof(c=this.modeHandlers)[b=this.mode]?c[b](a):void 0};a.prototype.markHandler=function(a){a=$(a.target).attr("data-index");if(!(0!==this.lastAttempted&&a>this.lastAttempted)&&(this.markElement(a),0!==this.autostop))return this.checkAutostop()};a.prototype.intermediateItemHandler=function(a){this.timeIntermediateCaptured=this.getTime()-this.startTime;a=$(a.target);this.itemAtTime=
a.attr("data-index");a.addClass("element_minute");return this.updateMode(null,"mark")};a.prototype.checkAutostop=function(){var a,c,b,d;if(this.timeRunning){c=b=a=0;for(d=this.autostop-1;(0<=d?b<=d:b>=d)&&"correct"!==this.gridOutput[c];c=0<=d?++b:--b)a++;!1===this.autostopped&&a===this.autostop&&this.autostopTest();if(!0===this.autostopped&&a<this.autostop&&!0===this.undoable)return this.unAutostopTest()}};a.prototype.markElement=function(a,c){var b;null==c&&(c=null);if(!(0!==this.lastAttempted&&
a>this.lastAttempted)){b=this.$el.find(".grid_element[data-index="+a+"]");this.markRecord.push(a);if(null===c)return this.gridOutput[a-1]="correct"===this.gridOutput[a-1]||this.autostopped?"incorrect":"correct",b.toggleClass("element_wrong");if(!this.autostopped||"correct"===c){this.gridOutput[a-1]=c;if("incorrect"===c)return b.addClass("element_wrong");if("correct"===c)return b.removeClass("element_wrong")}}};a.prototype.endOfGridLineClick=function(a){var c,b,d,f;if("mark"===this.mode){c=$(a.target);
if(c.hasClass("element_wrong"))for(c.removeClass("element_wrong"),a="correct",c=d=b=c.attr("data-index"),f=b-(this.columns-1);b<=f?d<=f:d>=f;c=b<=f?++d:--d)this.markElement(c,a);else if(!c.hasClass("element_wrong")&&!this.autostopped)for(c.addClass("element_wrong"),a="incorrect",c=d=b=c.attr("data-index"),f=b-(this.columns-1);b<=f?d<=f:d>=f;c=b<=f?++d:--d)this.markElement(c,a);if(0!==this.autostop)return this.checkAutostop()}};a.prototype.lastHandler=function(a){var c;a=$(a.target);c=a.attr("data-index");
if(c-1>=this.gridOutput.lastIndexOf("incorrect"))return this.$el.find("table.grid .element_last").removeClass("element_last"),a.addClass("element_last"),this.lastAttempted=c};a.prototype.startTimer=function(){if(!1===this.timerStopped&&!1===this.timeRunning)return this.interval=setInterval(this.updateCountdown,1E3),this.startTime=this.getTime(),this.timeRunning=!0,this.updateMode(null,"mark"),this.enableGrid(),this.updateCountdown()};a.prototype.enableGrid=function(){return this.$el.find("table.disabled, div.disabled").removeClass("disabled")};
a.prototype.stopTimer=function(a,c){null==c&&(c=!1);if(!0===this.timeRunning){Utils.flash();clearInterval(this.interval);this.stopTime=this.getTime();this.timeRunning=!1;this.timerStopped=!0;this.updateCountdown();this.captureLastAttempted&&this.updateMode(null,"last");if(c)return Utils.topAlert(c);if(this.captureLastAttempted)return Utils.midAlert("Please mark <br>last item attempted")}};a.prototype.autostopTest=function(){Utils.flash();clearInterval(this.interval);this.stopTime=this.getTime();this.timerStopped=
this.autostopped=!0;this.timeRunning=!1;this.$el.find(".grid_element").slice(this.autostop-1,this.autostop).addClass("element_last");this.lastAttempted=this.autostop;this.timeout=setTimeout(this.removeUndo,3E3);return Utils.topAlert("Autostop activated. Discontinue test.")};a.prototype.removeUndo=function(){this.undoable=!1;this.updateMode(null,"disabled");return clearTimeout(this.timeout)};a.prototype.unAutostopTest=function(){this.interval=setInterval(this.updateCountdown,1E3);this.updateCountdown();
this.autostopped=!1;this.lastAttempted=0;this.$el.find(".grid_element").slice(this.autostop-1,this.autostop).removeClass("element_last");this.timeRunning=!0;this.updateMode(null,"mark");return Utils.topAlert("Autostop removed. Continue.")};a.prototype.updateCountdown=function(){this.timeElapsed=Math.min(this.getTime()-this.startTime,this.timer);this.timeRemaining=this.timer-this.timeElapsed;this.$el.find(".timer").html(this.timeRemaining);0>=this.timeRemaining&&!0===this.timeRunning&&this.captureLastAttempted&&
this.stopTimer(null,"Time<br><br>Please mark<br>last item attempted");if(this.captureItemAtTime&&!this.gotIntermediate&&!this.minuteMessage&&this.timeElapsed>=this.captureAfterSeconds)return Utils.flash("yellow"),Utils.midAlert("Please select the item the child is currently attempting."),this.minuteMessage=!0,this.mode="minuteItem"};a.prototype.updateMode=function(a,c){null==c&&(c=null);if(null===c&&0===this.timeElapsed||"disabled"===c)this.$el.find("#grid_mode :radio").removeAttr("checked"),this.$el.find("#grid_mode").buttonset("refresh");
else if(null!=c)this.mode=c,this.$el.find("#grid_mode :radio[value="+c+"]").attr("checked","checked"),this.$el.find("#grid_mode").buttonset("refresh").click(this.updateMode);else if(!this.autostopped)return this.mode=$(a.target).val()};a.prototype.getTime=function(){return Math.round((new Date).getTime()/1E3)};a.prototype.resetVariables=function(){var a,c,b,d,f;this.minuteMessage=this.gotMinuteItem=!1;this.timeIntermediateCaptured=this.itemAtTime=null;this.markRecord=[];this.timerStopped=!1;this.timeElapsed=
this.stopTime=this.startTime=0;this.timeRemaining=this.timer;this.lastAttempted=0;this.interval=null;this.undoable=!0;this.timeRunning=!1;this.timer=parseInt(this.model.get("timer"))||0;this.untimed=0===this.timer;this.items=_.compact(this.model.get("items"));this.itemMap=[];this.mapItem=[];if(this.model.has("randomize")&&this.model.get("randomize")){c=this.items;a=d=0;for(c=c.length;d<c;a=++d)this.itemMap[a]=a;c=this.items;a=d=0;for(f=c.length;d<f;a=++d)c=Math.floor(Math.random()*this.items.length),
b=this.itemMap[c],this.itemMap[c]=this.itemMap[a],this.itemMap[a]=b;c=this.itemMap;a=d=0;for(c=c.length;d<c;a=++d)this.mapItem[this.itemMap[a]]=a}else for(c=this.items,a=d=0,c=c.length;d<c;a=++d)this.itemMap[a]=a,this.mapItem[a]=a;this.mode=this.captureLastAttempted||this.captureItemAtTime?"disabled":"mark";this.gridOutput=[];c=this.items;a=d=0;for(c=c.length;d<c;a=++d)this.gridOutput[a]="correct";this.columns=parseInt(this.model.get("columns"))||3;this.autostop=this.untimed?0:parseInt(this.model.get("autostop"))||
0;this.autostopped=!1;this.$el.find(".grid_element").removeClass("element_wrong").removeClass("element_last").addClass("disabled");this.$el.find("table").addClass("disabled");this.$el.find(".timer").html(this.timer);return this.updateMode(null,this.mode)};a.prototype.initialize=function(a){this.captureAfterSeconds=this.model.has("captureAfterSeconds")?this.model.get("captureAfterSeconds"):0;this.captureItemAtTime=this.model.has("captureItemAtTime")?this.model.get("captureItemAtTime"):!1;this.captureLastAttempted=
this.model.has("captureLastAttempted")?this.model.get("captureLastAttempted"):!0;this.endOfLine=this.model.has("endOfLine")?this.model.get("endOfLine"):!0;this.layoutMode=this.model.has("layoutMode")?this.model.get("layoutMode"):"fixed";this.fontSize=this.model.has("fontSize")?this.model.get("fontSize"):"normal";a="small"===this.fontSize?"font_size_small":"";this.totalTime=this.model.get("timer")||0;this.modeHandlers={mark:this.markHandler,last:this.lastHandler,minuteItem:this.intermediateItemHandler,
disabled:$.noop};this.model=this.options.model;this.parent=this.options.parent;this.resetVariables();this.gridElement=_.template("<td><div data-label='{{label}}' data-index='{{i}}' class='grid_element "+a+"'>{{label}}</div></td>");this.variableGridElement=_.template("<span data-label='{{label}}' data-index='{{i}}' class='grid_element "+a+"'>{{label}}</span>");return"fixed"===this.layoutMode?this.endOfGridLine=_.template("<td><div data-index='{{i}}' class='end_of_grid_line'>*</div></td>"):this.endOfGridLine=
_.template("")};a.prototype.render=function(){var a,c,b,d,f,g;c=0;b="<div class='timer_wrapper'><button class='start_time time'>Start</button><div class='timer'>"+this.timer+"</div></div>";a=this.untimed?"":"disabled";d=this.untimed?"":b;b="";if("fixed"===this.layoutMode){b+="<table class='grid "+a+"'>";for(a=!0;!(c>this.items.length);){b+="<tr>";f=1;for(g=this.columns;1<=g?f<=g:f>=g;1<=g?++f:--f)c<this.items.length&&(b+=this.gridElement({label:_.escape(this.items[this.itemMap[c]]),i:c+1})),c++;a?
(c<this.items.length+1&&this.endOfLine&&(b+="<td></td>"),a=!1):c<this.items.length+1&&this.endOfLine&&(b+=this.endOfGridLine({i:c}));b+="</tr>"}b+="</table>"}else{b+="<div class='grid "+a+"'>";f=this.items;c=a=0;for(f=f.length;a<f;c=++a)b+=this.variableGridElement({label:_.escape(this.items[this.itemMap[c]]),i:c+1});b+="</div>"}c="<div class='timer_wrapper'><button class='stop_time time'>Stop</button><div class='timer'>"+this.timer+"</div></div>";a="";if(this.captureLastAttempted||this.captureItemAtTime)f=
"",this.captureItemAtTime&&(f="          <label for='minute_item'>Item at "+this.captureAfterSeconds+" seconds</label>          <input class='grid_mode' name='grid_mode' id='minute_item' type='radio' value='minuteItem'>        "),a="",this.captureLastAttempted&&(a="          <label for='last_attempted'>Last attempted</label>          <input class='grid_mode' name='grid_mode' id='last_attempted' type='radio' value='last'>        "),a="        <div id='grid_mode' class='question buttonset clearfix'>          <label>Input mode</label><br>          <label for='mark'>Mark</label>          <input class='grid_mode' name='grid_mode' id='mark' type='radio' value='mark'>          "+
f+"          "+a+"        </div>      ";d=d+b+("      "+(this.untimed?"":c)+"      "+(this.untimed?"":"    <div>      <button class='restart command'>Restart</button>      <br>    </div>")+"      "+a+"    ");this.$el.html(d);return this.trigger("rendered")};a.prototype.isValid=function(){return this.captureLastAttempted&&0===this.lastAttempted||!0===this.timeRunning?!1:!0};a.prototype.showErrors=function(){this.captureLastAttempted&&0===this.lastAttempted&&(Utils.midAlert("Please touch<br>last item read."),
this.updateMode(null,"last"));if(!0===this.timeRuning)return Utils.midAlert("Time still running.")};a.prototype.getResult=function(){var a,c,b,d,f,g;b=[];this.captureLastAttempted||(this.lastAttempted=this.items.length);g=this.items;a=d=0;for(f=g.length;d<f;a=++d)c=g[a],b[a]=this.mapItem[a]<this.lastAttempted?{itemResult:this.gridOutput[this.mapItem[a]],itemLabel:c}:{itemResult:"missing",itemLabel:this.items[this.mapItem[a]]};this.captureLastAttempted||(this.lastAttempted=!1);return{capture_last_attempted:this.captureLastAttempted,
item_at_time:this.itemAtTime,time_intermediate_captured:this.timeIntermediateCaptured,capture_item_at_time:this.captureItemAtTime,auto_stop:this.autostopped,attempted:this.lastAttempted,items:b,time_remain:this.timeRemaining,mark_record:this.markRecord,variable_name:this.model.get("variableName")}};a.prototype.getSkipped=function(){var a,c,b,d,f,g;b=[];g=this.items;a=d=0;for(f=g.length;d<f;a=++d)c=g[a],b[a]={itemResult:"skipped",itemLabel:c};return{capture_last_attempted:"skipped",item_at_time:"skipped",
time_intermediate_captured:"skipped",capture_item_at_time:"skipped",auto_stop:"skipped",attempted:"skipped",items:b,time_remain:"skipped",mark_record:"skipped",variable_name:this.model.get("variableName")}};a.prototype.onClose=function(){return clearInterval(this.interval)};a.prototype.getSum=function(){var a,c,b,d,f;a={correct:0,incorrect:0,missing:this.items.length-this.lastAttempted,total:this.items.length};f=this.gridOutput;b=0;for(d=f.length;b<d;b++)c=f[b],"correct"===c&&(a.correct+=1),"incorrect"===
c&&(a.incorrect+=1);return{correct:a.correct,incorrect:a.incorrect,missing:a.missing,total:a.total,correct_per_minute:60/this.timeElapsed*a.correct}};return a}(Backbone.View);var GridEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
GridEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"blur #subtest_items":"cleanWhitespace"};a.prototype.cleanWhitespace=function(){return this.$el.find("#subtest_items").val(this.$el.find("#subtest_items").val().replace(/\s+/g," "))};a.prototype.initialize=function(a){return this.model=a.model};a.prototype.save=function(){/\t|,/.test(this.$el.find("#subtest_items").val())&&alert('Please remember\n\nGrid items are space " " delimited');
return this.model.set({captureLastAttempted:"true"===this.$el.find("#capture_last_attempted input:checked").val(),endOfLine:"true"===this.$el.find("#end_of_line input:checked").val(),captureItemAtTime:"true"===this.$el.find("#capture_item_at_time input:checked").val(),captureAfterSeconds:parseInt(this.$el.find("#capture_after_seconds").val()),fontSize:this.$el.find("#font_size input:checked").val(),layoutMode:this.$el.find("#layout_mode input:checked").val(),randomize:"true"===this.$el.find("#randomize input:checked").val(),
timer:parseInt(this.$el.find("#subtest_timer").val()),items:_.compact(this.$el.find("#subtest_items").val().split(" ")),columns:parseInt(this.$el.find("#subtest_columns").val()),autostop:parseInt(this.$el.find("#subtest_autostop").val()),variableName:this.$el.find("#subtest_variable_name").val().replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,"")})};a.prototype.render=function(){var a,c,b,d,f,g,k,l,m,q,n,p;l=this.model.get("items").join(" ");n=this.model.get("timer")||0;f=this.model.get("columns")||0;
a=this.model.get("autostop")||0;p=this.model.get("variableName")||"";q=this.model.has("randomize")?this.model.get("randomize"):!1;b=this.model.has("captureItemAtTime")?this.model.get("captureItemAtTime"):!1;c=this.model.has("captureAfterSeconds")?this.model.get("captureAfterSeconds"):0;d=this.model.has("captureLastAttempted")?this.model.get("captureLastAttempted"):!0;g=this.model.has("endOfLine")?this.model.get("endOfLine"):!0;k=this.model.has("fontSize")?this.model.get("fontSize"):"medium";m=this.model.has("layoutMode")?
this.model.get("layoutMode"):"fixed";return this.$el.html("      <div class='label_value'>        <label for='subtest_variable_name' title='This will be used for CSV exporting.'>Variable name</label>        <input id='subtest_variable_name' value='"+p+"'>      </div>      <div class='label_value'>        <label for='subtest_items' title='These items are space delimited. Pasting text from other applications may insert tabs and new lines. Whitespace will be automatically corrected.'>Grid Items</label>        <textarea id='subtest_items'>"+
l+"</textarea>      </div>      <div class='label_value'>        <label>Randomize items</label><br>        <div class='menu_box'>          <div id='randomize' class='buttonset'>            <label for='randomize_true'>Yes</label><input name='randomize' type='radio' value='true' id='randomize_true' "+(q?"checked":void 0)+">            <label for='randomize_false'>No</label><input name='randomize' type='radio' value='false' id='randomize_false' "+(q?void 0:"checked")+">          </div>        </div>        <br>        <label>Layout mode</label><br>        <div class='menu_box'>          <div id='layout_mode' class='buttonset'>            <label for='layout_mode_fixed'>Fixed<img></label><input name='layout_mode' type='radio' value='fixed' id='layout_mode_fixed' "+
("fixed"===m?"checked":"")+">            <label for='layout_mode_variable'>Variable<img></label><input name='layout_mode' type='radio' value='variable' id='layout_mode_variable' "+("variable"===m?"checked":"")+">          </div>        </div>        <br>        <label>Grid font size</label><br>        <div class='menu_box'>          <div id='font_size' class='buttonset'>            <label for='font_size_medium'>Medium</label><input name='font_size' type='radio' value='medium' id='font_size_medium' "+
("medium"===k?"checked":"")+">            <label for='font_size_small'>Small</label><input name='font_size' type='radio' value='small' id='font_size_small' "+("small"===k?"checked":"")+">          </div>        </div>        <br>        <label>Capture item at specified number of seconds</label><br>        <div class='menu_box'>          <div id='capture_item_at_time' class='buttonset'>            <label for='capture_item_at_time_true'>Yes</label><input name='capture_item_at_time' type='radio' value='true' id='capture_item_at_time_true' "+
(b?"checked":void 0)+">            <label for='capture_item_at_time_false'>No</label><input name='capture_item_at_time' type='radio' value='false' id='capture_item_at_time_false' "+(b?void 0:"checked")+">          </div>          <div class='label_value'>            <label for='capture_after_seconds' title='After this number of seconds has passed the enumerator will be instructed to mark the item currently being attempted, and then resume.'>Seconds</label>            <input id='capture_after_seconds' value='"+
c+"' type='number'>          </div>        </div>        <br>        <label>Capture last item attempted</label><br>        <div class='menu_box'>          <div id='capture_last_attempted' class='buttonset'>            <label for='capture_last_attempted_true'>Yes</label><input name='capture_last_attempted' type='radio' value='true' id='capture_last_attempted_true' "+(d?"checked":void 0)+">            <label for='capture_last_attempted_false'>No</label><input name='capture_last_attempted' type='radio' value='false' id='capture_last_attempted_false' "+
(d?void 0:"checked")+">          </div>        </div>        <br>        <label>Mark entire line button</label><br>        <div class='menu_box'>          <div id='end_of_line' class='buttonset'>            <label for='end_of_line_true'>Yes</label><input name='end_of_line' type='radio' value='true' id='end_of_line_true' "+(g?"checked":void 0)+">            <label for='end_of_line_false'>No</label><input name='end_of_line' type='radio' value='false' id='end_of_line_false' "+(g?void 0:"checked")+">          </div>        </div>      </div>      <div class='label_value'>        <label for='subtest_columns' title='Number of columns in which to display the grid items.'>Columns</label>        <input id='subtest_columns' value='"+
f+"' type='number'>      </div>      <div class='label_value'>        <label for='subtest_autostop' title='Number of incorrect items in a row from the beginning, after which, the test automatically stops. If the item that triggered the autostop was an enumerator error, the enumerator has 3 seconds to undo any incorrect item and resume the test. Otherwise, the test is stopped but may still be reset completely.'>Autostop</label>        <input id='subtest_autostop' value='"+a+"' type='number'>      </div>      <div class='label_value'>        <label for='subtest_timer' title='Seconds to give the child to complete the test. Setting this value to 0 will make the test untimed.'>Timer</label>        <input id='subtest_timer' value='"+
n+"' type='number'>      </div>")};return a}(Backbone.View);var ObservationRunView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ObservationRunView=function(b){function a(){this.saveCurrentSurvey=__bind(this.saveCurrentSurvey,this);this.updateObservationIndex=__bind(this.updateObservationIndex,this);this.checkSurveyDisplay=__bind(this.checkSurveyDisplay,this);this.checkIfOver=__bind(this.checkIfOver,this);this.checkWarning=__bind(this.checkWarning,this);this.checkObservationPace=__bind(this.checkObservationPace,this);this.tick=__bind(this.tick,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events=
{"click .start_time":"startObservations","click .stop_time":"stopObservations","click .done":"completeObservation"};a.FORCE=1;a.prototype.initialize=function(a){this.model=this.options.model;this.parent=this.options.parent;this.warningSeconds=5;this.initializeFlags();return this.initializeSurvey()};a.prototype.initializeSurvey=function(){var a;if(null!=this.survey)this.onClose();a=$.extend(this.model.get("surveyAttributes"),{_id:this.model.id});var c,b,d;d=[];c=1;for(b=parseInt(this.model.get("totalSeconds")/
this.model.get("intervalLength"));1<=b?c<=b:c>=b;1<=b?++c:--c)d.push(new Backbone.Model(a));d.unshift("");this.skippableView=new SurveyRunView({model:d[1],parent:this,isObservation:!0});return this.survey={models:d,results:[]}};a.prototype.initializeFlags=function(){this.iAm={counting:!1,recording:!1};this.iHavent={warned:!0};this.iHave={runOnce:!1,finished:!1};return this.my={time:{start:0,elapsed:0},observation:{index:0,oldIndex:0,completed:0,total:parseInt(this.model.get("totalSeconds")/this.model.get("intervalLength"))}}};
a.prototype.startObservations=function(){if(!this.iAm.counting&&!this.iHave.runOnce)return this.$el.find(".stop_button_wrapper, .next_display, .completed_display").removeClass("confirmation"),this.$el.find(".start_button_wrapper").addClass("confirmation"),this.timerInterval=setInterval(this.tick,1E3),this.iAm.counting=!0,this.my.time.start=this.getTime(),this.my.time.elapsed=0};a.prototype.stopObservations=function(a){var c;clearInterval(this.timerInterval);c=null==a;null!=a&&this.trigger("showNext");
c&&!this.iHave.finished?(this.iAm.recording&&(this.resetObservationFlags(),this.saveCurrentSurvey()),this.my.observation.index++,this.renderSurvey()):(this.$el.find(".stop_button_wrapper").addClass("confirmation"),Utils.midAlert("Observations finished"));this.$el.find(".next_display").addClass("confirmation");this.iHave.finished=!0;return this.iHave.runOnce=!0};a.prototype.tick=function(){this.my.time.elapsed=this.getTime()-this.my.time.start;this.checkIfOver();this.updateObservationIndex();this.updateProgressDisplay();
this.checkSurveyDisplay();this.checkObservationPace();return this.checkWarning()};a.prototype.checkObservationPace=function(){if(this.iAm.recording&&this.my.observation.completed<this.my.observation.index-1&&0!==this.my.observation.index)return this.iHave.forcedProgression=!0,this.resetObservationFlags(),this.saveCurrentSurvey(),this.renderSurvey()};a.prototype.checkWarning=function(){var a;a=Math.floor((this.my.time.elapsed+this.warningSeconds)/this.model.get("intervalLength"));a=this.my.observation.index<
a&&!this.iHave.finished;if(this.iAm.recording&&this.iHavent.warned&&a&&0!==this.my.observation.index)return Utils.midAlert("Observation ending soon"),this.iHavent.warned=!1};a.prototype.gridWasAutostopped=function(){return!1};a.prototype.checkIfOver=function(){if(this.my.time.elapsed>=this.model.get("totalSeconds"))return this.stopObservations()};a.prototype.checkSurveyDisplay=function(){if(this.my.observation.oldIndex!==this.my.observation.index&&!this.iHave.finished&&!this.iAm.recording)return this.renderSurvey(),
this.my.observation.oldIndex=this.my.observation.index};a.prototype.updateObservationIndex=function(){this.my.observation.index=Math.floor(this.my.time.elapsed/this.model.get("intervalLength"));if(this.my.observation.index>this.survey.models.length-1)return this.my.observation.index=this.survey.models.length-1};a.prototype.updateProgressDisplay=function(){var a;this.$el.find(".current_observation").html(this.my.observation.index);this.$el.find(".completed_count").html(this.my.observation.completed);
a=Math.max((this.my.observation.index+1)*this.model.get("intervalLength")-this.my.time.elapsed,0);this.$el.find(".time_till_next").html(a);if(!this.iAm.recording&&!this.iHave.finished)return this.$el.find(".next_display, .completed_display").removeClass("confirmation")};a.prototype.resetObservationFlags=function(){this.iAm.recording=!1;return this.iHavent.warned=!0};a.prototype.getTime=function(){return parseInt((new Date).getTime()/1E3)};a.prototype.completeObservation=function(a){this.survey.view.isValid()?
(this.saveCurrentSurvey(),this.iHave.finished&&this.trigger("showNext")):this.survey.view.showErrors();return this.tick()};a.prototype.saveCurrentSurvey=function(){this.resetObservationFlags();this.my.observation.completed++;this.survey.results.push({observationNumber:this.survey.view.index,data:this.survey.view.getResult(),saveTime:this.my.time.elapsed});this.survey.view.close();return this.$el.find(".done").remove()};a.prototype.render=function(){this.trigger("hideNext");this.model.get("totalSeconds");
this.$el.html("      <div class='timer_wrapper'>        <div class='progress clearfix'>          <span class='completed_display confirmation'>Completed <div class='info_box completed_count'>"+this.my.observation.completed+"</div></span>          <span class='next_display confirmation'>Next observation <div class='info_box time_till_next'>"+this.model.get("intervalLength")+"</div></span>        </div>        <div>          <div class='start_button_wrapper'><button class='start_time command'>Start</button></div>          <div class='stop_button_wrapper confirmation'><button class='stop_time command'>Abort <i>all</i> observations</button></div>        </div>      </div>      <div id='current_survey'></div>    ");
return this.trigger("rendered")};a.prototype.renderSurvey=function(a){var c=this;if(this.iAm.counting)return this.iAm.recording=!0,this.survey.view=new SurveyRunView({model:this.survey.models[this.my.observation.index],parent:this,isObservation:!0}),this.survey.view.index=c.my.observation.index,this.survey.view.on("rendered subRendered",function(){return c.trigger("subRendered")}),this.survey.view.render(),this.$el.find("#current_survey").html("<span class='observation_display confirmation'>Observation <div class='info_box current_observation'>"+
this.my.observation.index+"</div></span>"),this.$el.find("#current_survey").append(this.survey.view.el),this.$el.find("#current_survey").append("<button class='command done'>Done with <i>this</i> observation</button>"),this.$el.find("#current_survey").scrollTo(250,function(){if(c.iHave.forcedProgression)return Utils.midAlert("Please continue with the next observation."),c.iHave.forcedProgression=!1;if(c.iHave.finished)return Utils.midAlert("Please enter last observation")})};a.prototype.onClose=function(){var a;
null!=(a=this.survey.view)&&a.close();return this.skippableView.close()};a.prototype.getResult=function(){return{surveys:this.survey.results,variableName:this.model.get("variableName"),totalTime:this.model.get("totalTime"),intervalLength:this.model.get("intervalTime"),completedObservations:this.my.observation.completed}};a.prototype.getSum=function(){return{total:this.my.observation.completed}};a.prototype.getSkipped=function(){var a,c,b,d,f;b=this.skippableView.getSkipped();c=[];a=d=1;for(f=this.survey.models.length-
1;1<=f?d<=f:d>=f;a=1<=f?++d:--d)c.push({observationNumber:a,data:b,saveTime:"skipped"});return{surveys:c,variableName:"skipped",totalTime:"skipped",intervalLength:"skipped",completedObservations:"skipped"}};a.prototype.isValid=function(){return this.iHave.finished};a.prototype.showErrors=function(){return this.$el.find("messages").html(this.validator.getErrors().join(", "))};a.prototype.updateNavigation=function(){return Tangerine.nav.setStudent(this.$el.find("#participant_id").val())};return a}(Backbone.View);var ObservationEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ObservationEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.model=a.model;a=$.extend(this.model.get("surveyAttributes"),{_id:this.model.id,assessmentId:this.model.get("assessmentId")});this.surveyModel=new Backbone.Model(a);return this.surveyView=new SurveyEditView({model:this.surveyModel})};a.prototype.save=function(){var a,c,b;a=[];b=parseInt(this.$el.find("#total_seconds").val());c=parseInt(this.$el.find("#interval_length").val());
0===b&&a.push("Total seconds needs to be non-zero value.");0===c&&a.push("Interval length needs to be a non-zero value.");0!==a.length&&alert("Warning\n\n"+a.join("\n"));return this.model.set({totalSeconds:b,intervalLength:c,surveyAttributes:this.surveyModel.attributes})};a.prototype.render=function(){var a,c;c=this.model.get("totalSeconds")||0;a=this.model.get("intervalLength")||0;this.$el.html("      <div class='label_value'>        <label for='total_seconds'>Total seconds</label>        <input id='total_seconds' value='"+
c+"' type='number'><br>        <label for='interval_length' title='In seconds'>Interval length</label>        <input id='interval_length' value='"+a+"' type='number'>      </div>      <div id='survey_editor'></div>    ");this.surveyView.setElement(this.$el.find("#survey_editor"));this.surveyView.render();return this.$el.find("#grid_link").remove()};return a}(Backbone.View);var Result,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Result=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="result";a.prototype.initialize=function(a){if(!0===a.blank)return this.set({subtestData:[],start_time:(new Date).getTime(),enumerator:Tangerine.user.name}),this.unset("blank")};a.prototype.add=function(a){var c;c=this.get("subtestData");c.timestamp=(new Date).getTime();c.push(a);return this.save({subtestData:c})};a.prototype.getGridScore=function(a){var c,b,d,f;f=this.get("subtestData");
b=0;for(d=f.length;b<d;b++)if(c=f[b],c.subtestId===a)return parseInt(c.data.attempted)};a.prototype.gridWasAutostopped=function(a){var c,b,d,f;f=this.get("subtestData");b=0;for(d=f.length;b<d;b++)if(c=f[b],c.subtestId===a)return c.data.auto_stop};return a}(Backbone.Model);var Results,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Results=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="result";a.prototype.model=Result;a.prototype.db={view:"resultsByAssessmentId"};a.prototype.initialize=function(){};a.prototype.comparator=function(a){return a.get("timestamp")||0};return a}(Backbone.Collection);var ResultView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ResultView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="result_view";a.prototype.events={"click .save":"save","click .another":"another"};a.prototype.another=function(){return Tangerine.router.navigate("restart/"+this.assessment.id,!0)};a.prototype.save=function(){this.model.add({name:"Assessment complete",prototype:"complete",data:{comment:this.$el.find("#additional_comments").val()||"",end_time:(new Date).getTime(),gps:this.gpsData},
subtestId:"result",sum:{correct:1,incorrect:0,missing:0,total:1}});this.model.save()?(Tangerine.activity="",Utils.midAlert("Result saved"),this.$el.find(".save_status").html("saved"),this.$el.find(".save_status").removeClass("not_saved"),this.$el.find("button.save, .question").fadeOut(250),this.$el.find(".confirmation").removeClass("confirmation")):(Utils.midAlert("Save error"),this.$el.find(".save_status").html("Results may not have saved"));window.allResult=new Results;return allResult.fetch({success:function(){return window.requestFileSystem(LocalFileSystem.PERSISTENT,
0,gotFS)}})};a.prototype.initialize=function(a){var c,b=this;this.gpsData={};try{navigator.geolocation.getCurrentPosition(function(a){return b.gpsData=a.coords},function(){return b.gpsData[c]=arguments},{enableHighAccuracy:!0})}catch(d){c=d,this.gpsData={error:c}}this.model=a.model;this.assessment=a.assessment;this.saved=!1;return this.resultSumView=new ResultSumView({model:this.model,finishCheck:!1})};a.prototype.render=function(){this.$el.append("<h2>Assessment complete</h2>    <div class='label_value'>      <label>Result</label>      <div class='info_box save_status not_saved'>Not saved yet</div>        <h2>Subtests completed</h2>    ");
this.resultSumView.render();this.$el.append(this.resultSumView.el);this.$el.append("      <div class='question'>      <div class='prompt'>Additional comments (optional)</div>      <textarea id='additional_comments' class='full_width'></textarea>      </div>      <button class='save command'>Save result</button><br>      <div class='confirmation'><button class='another command'>Perform another assessment</button></div>    ");return this.trigger("rendered")};a.prototype.onClose=function(){return this.resultSumView.close()};
return a}(Backbone.View);var ResultsView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ResultsView=function(b){function a(){this.afterRender=__bind(this.afterRender,this);this.updateOptions=__bind(this.updateOptions,this);this.detectTablets=__bind(this.detectTablets,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .cloud":"cloud","click .csv":"csv","click .tablets":"tablets","click .detect":"detectOptions"};a.prototype.cloud=function(){var a=this;this.available.cloud.ok?$.couch.replicate(Tangerine.config.address.local.dbName,
Tangerine.config.address.cloud.host+"/"+Tangerine.config.address.cloud.dbName,{success:function(){return a.$el.find(".status").find(".info_box").html("Results synced to cloud successfully")},error:function(c,b){return a.$el.find(".status").find(".info_box").html("<div>Sync error</div><div>"+c+" "+b+"</div>")}},{doc_ids:this.docList}):Utils.midAlert("Cannot detect cloud");return!1};a.prototype.tablets=function(){var a,c,b,d,f,g=this;if(0<this.available.tablets.okCount)for(f=this.available.tablets.ips,
c=function(a){return $.couch.replicate(Tangerine.config.address.local.dbName,"http://"+a+":5984/"+Tangerine.config.address.local.dbName,{success:function(){return g.$el.find(".status").find(".info_box").html("Results synced to "+g.available.tablets.okCount+" successfully")},error:function(a,c){return g.$el.find(".status").find(".info_box").html("<div>Sync error</div><div>"+a+" "+c+"</div>")}},{doc_ids:g.docList})},b=0,d=f.length;b<d;b++)a=f[b],c(a);else Utils.midAlert("Cannot detect tablets");return!1};
a.prototype.csv=function(){return(new CSVView({assessmentId:this.assessment.id})).render()};a.prototype.initDetectOptions=function(){return this.available={cloud:{ok:!1,checked:!1},tablets:{ips:[],okCount:0,checked:0,total:256}}};a.prototype.detectOptions=function(){this.detectCloud();return this.detectTablets()};a.prototype.detectCloud=function(){var a=this;return $.ajax({dataType:"jsonp",url:Tangerine.config.address.cloud.host+":"+Tangerine.config.address.port+"/",success:function(c,b){return a.available.cloud.ok=
!0},error:function(c,b){return a.available.cloud.ok=!1},complete:function(){a.available.cloud.checked=!0;return a.updateOptions()}})};a.prototype.detectTablets=function(){var a,c,b,d,f=this;c=Tangerine.config.address.port;d=[];for(a=b=0;255>=b;a=++b)d.push(function(a,c){var e;e="192.168.1."+a;return $.ajax({dataType:"jsonp",contentType:"application/json;charset=utf-8",timeout:3E4,url:"http://"+e+":"+c+"/",complete:function(a,c){f.available.tablets.checked++;200===a.status&&(f.available.tablets.okCount++,
f.available.tablets.ips.push(e));return f.updateOptions()}})}(a,c));return d};a.prototype.updateOptions=function(){var a,c;a=Math.decimals(this.available.tablets.checked/this.available.tablets.total*100,2);c="Searching for tablets: "+(100===a?"finished":""+a+"%");0<this.available.tablets.checked&&this.$el.find(".checking_status").html(""+c);this.available.cloud.checked&&this.available.tablets.checked===this.available.tablets.total&&(this.$el.find(".status .info_box").html("Done detecting options"),
this.$el.find(".checking_status").hide());this.available.cloud.ok&&this.$el.find("button.cloud").removeAttr("disabled");if(0<this.available.tablets.okCount&&100===a)return this.$el.find("button.tablets").removeAttr("disabled")};a.prototype.initialize=function(a){var c,b,d;this.subViews=[];this.results=a.results;this.model=a.model;this.assessment=a.assessment;this.docList=[];d=this.results;c=0;for(b=d.length;c<b;c++)a=d[c],this.docList.push(a.id);this.initDetectOptions();return this.detectCloud()};
a.prototype.render=function(){var a,c,b,d;this.clearSubViews();a="      <h1>"+this.assessment.get("name")+"</h1>      <h2>Save options</h2>      <div class='menu_box'>        "+("mobile"===Tangerine.settings.context?"<button class='cloud command' disabled='disabled'>Cloud</button>":"")+"        "+("mobile"===Tangerine.settings.context?"<button class='tablets command' disabled='disabled'>Tablets</button>":"")+"        <button class='csv command'>CSV</button>      </div>";"mobile"===Tangerine.settings.context&&
(a+="        <button class='detect command'>Detect options</button>        <div class='status'>          <h2>Status</h2>          <div class='info_box'></div>          <div class='checking_status'></div>        </div>        ");this.$el.html(a+"      <h2>Results</h2>    ");if(0===(null!=(b=this.results)?b.length:void 0))this.$el.append("No results yet!");else for(d=this.results,a=0,b=d.length;a<b;a++)c=d[a],c=new ResultSumView({model:c,finishCheck:!0}),c.render(),this.subViews.push(c),this.$el.append(c.el);
return this.trigger("rendered")};a.prototype.afterRender=function(){var a,c,b,d,f;d=this.subViews;f=[];c=0;for(b=d.length;c<b;c++)a=d[c],f.push("function"===typeof a.afterRender?a.afterRender():void 0);return f};a.prototype.clearSubViews=function(){var a,c,b,d;d=this.subViews;c=0;for(b=d.length;c<b;c++)a=d[c],a.close();return this.subViews=[]};return a}(Backbone.View);var ResultSumView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ResultSumView=function(b){function a(){this.afterRender=__bind(this.afterRender,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="info_box";a.prototype.events={"click .details":"toggleDetails","click .resume":"resume"};a.prototype.resume=function(){return Tangerine.router.navigate("resume/"+this.result.get("assessmentId")+"/"+this.result.id,!0)};a.prototype.toggleDetails=function(){return this.$el.find(".detail_box").toggle(250)};a.prototype.initialize=
function(a){var c,b,d,f,g;this.result=a.model;this.finishCheck=a.finishCheck;this.finished=null!=(null!=(c=_.last(this.result.attributes.subtestData))?c.data.end_time:void 0)?!0:!1;this.studentId="";f=this.result.attributes.subtestData;g=[];b=0;for(d=f.length;b<d;b++)if(c=f[b],a=c.prototype,"id"===a){this.studentId=c.data.participant_id;break}else g.push(void 0);return g};a.prototype.render=function(){var a,c,b,d,f,g;this.finished||!this.finishCheck?(a=null!=(c=_.last(this.result.attributes.subtestData))?
c.data.end_time:void 0,c=this.result.get("timestamp"),a=null!=c?new Date(c):null!=a?new Date(a):new Date,c="        <div>          "+this.studentId+"          "+moment(a).format("YYYY-MMM-DD HH:mm")+"          ("+moment(a).fromNow()+")          <button class='details command'>details</button>        </div>"):(a=new Date(this.result.has("start_time")?this.result.get("start_time"):this.result.get("starttime")),c="<div>Not finished ( "+moment(a).fromNow()+" ) <button class='command resume'>Resume</button></div>");
c+="<div class='confirmation detail_box'>";g=this.result.get("subtestData");b=d=0;for(f=g.length;d<f;b=++d)a=g[b],c+="<div><span id='"+this.cid+"_"+b+"'></span>"+a.name+" - items "+a.sum.total+"</div>";this.$el.html(c+"      </div>    ");return this.trigger("rendered")};a.prototype.afterRender=function(){var a,c,b,d,f;f=this.result.get("subtestData");c=b=0;for(d=f.length;b<d;c=++b)a=f[c],c="#"+this.cid+"_"+c,this.$el.find(c).sparkline([a.sum.correct,a.sum.incorrect,a.sum.missing],{type:"pie",width:"30",
height:"30",sliceColors:["#6f6","#c66","#ccc"]});return null};return a}(Backbone.View);var CSVView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CSVView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.exportValueMap={correct:1,checked:1,incorrect:0,unchecked:0,missing:".",not_asked:"."};a.prototype.initialize=function(a){var c=this;this.assessmentId=Utils.cleanURL(a.assessmentId);(new Results).fetch({key:this.assessmentId,success:function(a){c.results=a.models;return c.render()}});return this.metaKeys=["enumerator"]};a.prototype.exportValue=function(a){return null!=this.exportValueMap[a]?
this.exportValueMap[a]:a};a.prototype.render=function(){var a,c,b,d,f,g,k,l,m,q,n,p,r,s,v,z,A,u,y,w,x,B,C,D=this;if(null!=this.results&&null!=this.results[0]){s="";d=[];a=[];k=[];w=this.results;v=0;for(A=w.length;v<A;v++)for(p=w[v],a=p.has("order_map")?p.get("order_map"):function(){C=[];for(var a=0,c=p.attributes.subtestData.length-1;0<=c?a<=c:a>=c;0<=c?a++:a--)C.push(a);return C}.apply(this),n=z=0,x=p.attributes.subtestData.length-1;0<=x?z<=x:z>=x;n=0<=x?++z:--z){c=a.indexOf(n);f=p.attributes.subtestData[c];
f.name.toLowerCase().dasherize();c=f.prototype;g=[];if("id"===c)g.push("id");else if("datetime"===c)g.push("year","month","date","assess_time");else if("location"===c)for(m=f.data.labels,c=0,f=m.length;c<f;c++)l=m[c],g.push(l);else if("consent"===c)g.push("consent");else if("grid"===c)for(l=f.data.variable_name,g.push(""+l+"_auto_stop",""+l+"_time_remain",""+l+"_attempted",""+l+"_item_at_time",""+l+"_time_intermediate_captured",""+l+"_correct_per_minute"),y=f.data.items,c=u=0,m=y.length;u<m;c=++u)f=
y[c],g.push(""+l+(c+1));else if("survey"===c)for(r in c=f.data,c)if(l=c[r],_.isObject(l))for(q in l)f=l[q],g.push(""+r+"_"+q);else g.push(r);else if("observation"===c)for(B=f.data.surveys,c=y=0,u=B.length;y<u;c=++y)for(r in f=B[c],m=f.data,m)if(l=m[r],_.isObject(l))for(q in l)f=l[q],g.push(""+r+"_"+q+"_"+(c+1));else g.push(""+r+"_"+(c+1));else"complete"===c&&g.push("additional_comments","end_time","gps_latitude","gps_longitude","gps_accuracy");null==k[n]&&(k[n]=[]);k[n].length<g.length&&(k[n]=g)}this.metaKeys.push("start_time",
"order_map");a=this.metaKeys.concat(_.flatten(k));d.push(a);z=this.results;c=v=0;for(n=z.length;v<n;c=++v){p=z[c];k=[];x=this.metaKeys;w=0;for(A=x.length;w<A;w++)c=x[w],null!=p.attributes[c]&&k.push(p.attributes[c]);k[a.indexOf("start_time")]=p.has("starttime")?p.get("starttime"):p.get("start_time");k[a.indexOf("order_map")]=p.has("order_map")?p.get("order_map"):"no_record";x=p.attributes.subtestData;w=0;for(A=x.length;w<A;w++)if(f=x[w],c=f.prototype,"id"===c)k[a.indexOf("id")]=f.data.participant_id;
else if("location"===c)for(u=f.data.labels,c=m=0,g=u.length;m<g;c=++m)l=u[c],k[a.indexOf(l)]=f.data.location[c];else if("datetime"===c)c="jan feb mar apr may jun jul aug sep oct nov dec".split(" "),c=~c.indexOf(f.data.month.toLowerCase())?c.indexOf(f.data.month.toLowerCase())+1:f.data.month,k[a.indexOf("year")]=f.data.year,k[a.indexOf("month")]=c,k[a.indexOf("date")]=f.data.day,k[a.indexOf("assess_time")]=f.data.time;else if("consent"===c)k[a.indexOf("consent")]=f.data.consent;else if("grid"===c)for(l=
f.data.variable_name,k[a.indexOf(""+l+"_auto_stop")]=f.data.auto_stop,k[a.indexOf(""+l+"_time_remain")]=f.data.time_remain,k[a.indexOf(""+l+"_attempted")]=f.data.attempted,k[a.indexOf(""+l+"_item_at_time")]=f.data.item_at_time,k[a.indexOf(""+l+"_time_intermediate_captured")]=f.data.time_intermediate_captured,k[a.indexOf(""+l+"_correct_per_minute")]=f.sum.correct_per_minute,m=f.data.items,c=u=0,g=m.length;u<g;c=++u)f=m[c],k[a.indexOf(""+l+(c+1))]=this.exportValue(f.itemResult);else if("survey"===c)for(r in c=
f.data,c)if(l=c[r],_.isObject(l))for(q in l)f=l[q],k[a.indexOf(""+r+"_"+q)]=this.exportValue(f);else k[a.indexOf(""+r)]=this.exportValue(l);else if("observation"===c)for(u=f.data.surveys,c=y=0,g=u.length;y<g;c=++y)for(r in f=u[c],m=f.data,m)if(l=m[r],_.isObject(l))for(q in l)f=l[q],k[a.indexOf(""+r+"_"+q+"_"+(c+1))]=this.exportValue(f);else k[a.indexOf(""+r+"_"+(c+1))]=this.exportValue(l);else"complete"===c&&(k[a.indexOf("additional_comments")]=f.data.comment,k[a.indexOf("end_time")]=f.data.end_time,
null!=f.data.gps&&(k[a.indexOf("gps_latitude")]=f.data.gps.latitude,k[a.indexOf("gps_longitude")]=f.data.gps.longitude,k[a.indexOf("gps_accuracy")]=f.data.gps.accuracy));d.push(k)}c=r=0;for(q=d.length;r<q;c=++r){k=d[c];s+="<tr>";a=v=c=0;for(n=k.length-1;0<=n?v<=n:v>=n;a=0<=n?++v:--v)s+="<td>"+k[a]+"</td>",c++;s+="</tr>"}s=s.replace(/undefined/g,"no_record");this.csv=$("<table>"+s+"</table>").table2CSV({delivery:"value"});b=new Backbone.Model({_id:"Tangerine-"+this.assessmentId.substr(-5,5)+".csv"});
b.url="csv";b.fetch({complete:function(){return b.save({csv:D.csv},{complete:function(){return window.open("/tangerine/_design/tangerine/_show/csv/Tangerine-"+D.assessmentId.substr(-5,5)+".csv","_blank")}})}})}return this.trigger("rendered")};return a}(Backbone.View);var Settings,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};Settings=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="settings";a.prototype.save=function(){a.__super__.save.call(this,arguments);return Tangerine.settings=this.attributes};return a}(Backbone.Model);var SettingsView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SettingsView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .save":"save"};a.prototype.initialize=function(a){return this.settings=a.settings};a.prototype.updateModel=function(){return this.settings.set({context:this.$el.find("#context").val(),generalThreshold:parseFloat(this.$el.find("#generalThreshold").val()),language:this.$el.find("#language").val()})};a.prototype.save=function(){this.updateModel();return this.settings.save()?
Utils.midAlert("Settings saved"):Utils.midAlert("Error. Settings weren't saved")};a.prototype.render=function(){var a,c,b;a=this.settings.escape("context");c=this.settings.escape("generalThreshold");b=this.settings.escape("language");this.$el.html("<h1>"+t("settings")+"</h1>    <p>Please be careful with the following settings.</p>    <div class='menu_box'>      <div class='label_value'>        <label for='context'>Context</label><br>        <input id='context' type='text' value='"+a+"'>      </div>      <div class='label_value'>        <label for='context'>General Threshold</label><br>        <input id='generalThreshold' type='number' value='"+
c+"'>      </div>      <div class='label_value'>        <label for='context'>Language</label><br>        <input id='language' type='number' value='"+b+"'>      </div>    </div><br>        <button class='command save'>Save</button>    ");return this.trigger("rendered")};return a}(Backbone.View);var Question,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Question=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="question";a.prototype.config={types:["multiple","single","open"]};a.prototype["default"]={order:0,prompt:"Is this an example question?",hint:"[hint or answer]",type:"single",otherWriteIn:!1,options:[],linkedGridScore:0,skipLink:null,skipRequirement:null};a.prototype.initialize=function(a){};return a}(Backbone.Model);var Questions,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Questions=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.model=Question;a.prototype.url="question";a.prototype.db={view:"questionsByAssessmentId"};a.prototype.comparator=function(a){return a.get("order")};a.prototype.maintainOrder=function(){var a,c,b,d,f,g,k;d=function(){var a,e,b,d;b=this.models;d=[];a=0;for(e=b.length;a<e;a++)c=b[a],d.push(c.get("order"));return d}.call(this).join("");b=function(){var b,d,f,h;f=this.models;h=[];a=b=
0;for(d=f.length;b<d;a=++b)c=f[a],h.push(a);return h}.call(this).join("");if(d!==b){g=this.models;k=[];a=d=0;for(f=g.length;d<f;a=++d)b=g[a],b.set("order",a),k.push(b.save());return k}};return a}(Backbone.Collection);var QuestionRunView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
QuestionRunView=function(b){function a(){this.setMessage=__bind(this.setMessage,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="question buttonset";a.prototype.events={"change input":"update","change textarea":"update","click .autoscroll_icon":"scroll"};a.prototype.scroll=function(a){return this.trigger("scroll",a,this.model.get("order"))};a.prototype.initialize=function(a){this.model=a.model;this.handler=this.model.get("handler");this.answer=
{};this.name=this.model.escape("name").replace(/[^A-Za-z0-9_]/g,"-");this.type=this.model.get("type");this.options=this.model.get("options");this.notAsked=a.notAsked;this.isObservation=a.isObservation;this.defineSpecialCaseResults();"true"===this.model.get("skippable")||!0===this.model.get("skippable")?this.skipped=this.isValid=!0:this.skipped=this.isValid=!1;if(!0===this.notAsked)return this.isValid=!0,this.updateResult()};a.prototype.update=function(a){this.updateResult();this.updateValidity();
return this.trigger("answer",a,this.model.get("order"))};a.prototype.updateResult=function(){var a,c,b;if("open"===this.type)this.answer=!0===this.notAsked?"not_asked":this.$el.find("#"+this.cid+"_"+this.name).val();else if("single"===this.type)this.answer=!0===this.notAsked?"not_asked":this.$el.find("."+this.cid+"_"+this.name+":checked").val();else if("multiple"===this.type)if(!0===this.notAsked)for(b=this.options,a=c=0,b=b.length;c<b;a=++c)this.answer[this.options[a].value]="not_asked";else for(b=
this.options,a=c=0,b=b.length;c<b;a=++c)this.answer[this.options[a].value]=this.$el.find("#"+this.cid+"_"+this.name+"_"+a).is(":checked")?"checked":"unchecked";return this.$el.attr("data-result",_.isString(this.answer)?this.answer:JSON.stringify(this.answer))};a.prototype.updateValidity=function(){return!0===this.model.get("skippable")||$("#question-"+this.name).hasClass("disabled_skipped")?(this.isValid=!0,this.skipped=_.isEmpty(this.answer)?!0:!1):this.isValid=_.isEmpty(this.answer)?!1:!0};a.prototype.setMessage=
function(a){return this.$el.find(".error_message").html(a)};a.prototype.render=function(){var a,c,b,d,f,g,k;this.$el.attr("id","question-"+this.name);if(this.notAsked)this.$el.hide();else{c="<div class='error_message'></div><div class='prompt'>"+this.model.get("prompt")+"</div>      <div class='hint'>"+(this.model.get("hint")||"")+"</div>";if("open"===this.type)c=this.model.get("multiline")?c+("<div><textarea id='"+this.cid+"_"+this.name+"' data-cid='"+this.cid+"'></textarea></div>"):c+("<div><input id='"+
this.cid+"_"+this.name+"' data-cid='"+this.cid+"'></div>");else for(a="multiple"===this.type?"checkbox":"radio",this.handler&&(this.options=_.shuffle(this.options)),k=this.options,b=f=0,g=k.length;f<g;b=++f)d=k[b],c+="            <label for='"+this.cid+"_"+this.name+"_"+b+"'>"+d.label+"</label>            <input id='"+this.cid+"_"+this.name+"_"+b+"' class='"+this.cid+"_"+this.name+"'  data-cid='"+this.cid+"' name='"+this.name+"' value='"+d.value+"' type='"+a+"'>          ";this.isObservation&&(c+=
"<img src='images/icon_scroll.png' class='icon autoscroll_icon' data-cid='"+this.cid+"'>");this.$el.html(c)}console.log("Rendered HUB");setTimeout(function(){return MathJax.Hub.Queue(["Typeset",MathJax.Hub])},500);return this.trigger("rendered")};a.prototype.defineSpecialCaseResults=function(){var a,c,b,d,f,g,k;b=["missing","notAsked","skipped","logicSkipped"];d=0;for(g=b.length;d<g;d++){a=b[d];if("single"===this.type||"open"===this.type)this[a+"Result"]=a;if("multiple"===this.type)for(this[a+"Result"]=
{},k=this.options,c=f=0,k=k.length;f<k;c=++f)this[a+"Result"][this.options[c].value]=a}};return a}(Backbone.View);var QuestionEditView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
QuestionEditView=function(b){function a(){this.updateModel=__bind(this.updateModel,this);this.goBack=__bind(this.goBack,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="question_list_element";a.prototype.events={"click .back":"goBack","click .done":"done","click .add_option":"addOption","click .delete_option":"showDeleteConfirm","click .delete_cancel":"hideDeleteConfirm","click .delete_delete":"deleteOption","click #question_type input:radio":"changeQuestionType",
keypress:"hijackEnter","change .option_select":"templateFill","keypress .option_value":"quickAddWithEnter","keypress .option_label":"quickFocusValue"};a.prototype.quickAddWithEnter=function(a){return null!=a.keyCode&&13!==a.keyCode?!0:this.addOption()};a.prototype.quickFocusValue=function(a){return null!=a.keyCode&&13!==a.keyCode?!0:$(a.target).parent().find(".option_value").focus()};a.prototype.templateFill=function(a){a=$(a.target).find("option:selected").attr("data-index");this.question.set("options",
Tangerine.templates.optionTemplates[a].options);this.$el.find("#option_list_wrapper").html(this.getOptionList());return!1};a.prototype.goBack=function(){Tangerine.router.navigate("subtest/"+this.question.get("subtestId"),!0);return!1};a.prototype.initialize=function(a){this.question=a.question;this.subtest=a.subtest;return this.assessment=a.assessment};a.prototype.getOptionList=function(){var a,c,b,d,f,g;d=this.question.get("options");a="<div id='option_list_wrapper'>      <h2>Options</h2>      <div class='menu_box'>        <ul class='option_list'>";
c=f=0;for(g=d.length;f<g;c=++f)b=d[c],a+="      <li class='question'>        <table><tr><td>          <img src='images/icon_drag.png' class='sortable_handle'>        </td>        <td>          <div style='display: block;'>            <div class='option_label_value'>              <label class='edit' for='options."+c+".label'>Label</label>              <input id='options."+c+".label' value='"+_.escape(b.label)+"' placeholder='Option label' class='option_label'><br>              <label class='edit' for='options."+
c+".value' title='Allowed characters&#58; A-Z, a-z, 0-9, and underscores.'>Value</label>              <input id='options."+c+".value' value='"+_.escape(b.value)+"' placeholder='Option value' class='option_value'><br>            </div>            <img src='images/icon_delete.png' class='delete_option' data-index='"+c+"'>            <div class='confirmation delete_confirm_"+c+"'>              <button class='delete_delete command_red' data-index='"+c+"'>Delete</button>              <button data-index='"+
c+"' class='delete_cancel command'>Cancel</button>            </div>          </div>        </td></tr></table>      </li>      ";return a+"</ul>      <button class='add_option command'>Add option</button>      </div>    </div>"};a.prototype.addOption=function(){var a;this.updateModel();a=this.question.get("options");a.push({label:"",value:""});this.question.set("options",a);this.$el.find("#option_list_wrapper").html(this.getOptionList());a=this.$el.find("#option_list_wrapper li");if(0!==a.length)return $(a.last()).scrollTo().find("input:first").focus()};
a.prototype.render=function(){var a,c,b,d,f,g,k,l,m,q=this;a=this.assessment.escape("name");l=this.subtest.escape("name");d=this.question.escape("name")||"";f=this.question.escape("prompt")||"";c=this.question.escape("hint")||"";g=this.question.escape("skipLogic")||"";m=this.question.get("type");this.question.get("options");b=this.question.get("linkedGridScore")||0;k=!0===this.question.get("skippable")||"true"===this.question.get("skippable");this.$el.html("      <button class='back navigation'>Back</button>      <h1>Question Editor</h1>      <table class='basic_info'>        <tr>          <th>Subtest</th>          <td>"+
l+"</td>        </tr>        <tr>          <th>Assessment</th>          <td>"+a+"</td>        </tr>      </table>      <button class='done command'>Done</button>      <div class='edit_form'>        <div class='label_value'>          <label for='name'>Variable name</label>          <input id='name' type='text' value='"+d+"'>        </div>        <div class='label_value'>          <label for='prompt'>Prompt</label>          <input id='prompt' type='text' value='"+f+"'>        </div>        <div class='label_value'>          <label for='hint'>Hint</label>          <input id='hint' type='text' value='"+
c+"'>        </div>        <div class='label_value'>          <label for='skip-logic'>Skip if <span style='font-size: small;font-weight:normal'>example: ResultOfQuestion(\"maze1\") isnt \"2\"</span></label>          <input id='skip-logic' type='text' value='"+g+"'>        </div>        <div class='label_value'>          <label>Skippable</label>          <div id='skip_radio' class='buttonset'>            <label for='skip_true'>Yes</label><input name='skippable' type='radio' value='true' id='skip_true' "+
(k?"checked":void 0)+">            <label for='skip_false'>No</label><input name='skippable' type='radio' value='false' id='skip_false' "+(k?void 0:"checked")+">          </div>        </div>        <div class='label_value'>          <label for='linked_grid_score'>Items attempted required on linked grid</label>          <input id='linked_grid_score' type='number' value='"+b+"'>        </div>        <div class='label_value' id='question_type' class='question_type'>          <label>Question Type</label>          <div class='buttonset'>            <label for='single'>single</label>            <input id='single' name='type' type='radio' value='single' "+
("single"===m?"checked":void 0)+">            <label for='multiple'>multiple</label>            <input id='multiple' name='type'  type='radio' value='multiple' "+("multiple"===m?"checked":void 0)+">            <label for='open'>open</label>            <input id='open' name='type'  type='radio' value='open' "+("open"===m?"checked":void 0)+">          </div>        </div>        ");if("open"!==m){b="        <div class='label_value'>        <label for='question_template_select'>Fill from template</label><br>        <div class='menu_box'>          <select id='question_template_select' class='option_select'>            <option disabled selected>Select template</option>        ";
g=Tangerine.templates.optionTemplates;a=d=0;for(f=g.length;d<f;a=++d)c=g[a],b+="<option data-index='"+a+"' class='template_option'>"+c.name+"</option>";b+="</select>        </div>        <div id='option_list_wrapper'>"+this.getOptionList()+"</div>        ";this.$el.append(b);this.$el.find(".option_list").sortable({handle:".sortable_handle",start:function(a,c){return c.item.addClass("drag_shadow")},stop:function(a,c){return c.item.removeClass("drag_shadow")},update:function(a,c){return q.updateModel()}})}this.$el.append("<button class='done command'>Done</button>      </div>      ");
return this.trigger("rendered")};a.prototype.hijackEnter=function(a){if(13===a.which)return this.$el.find(a.target).blur(),!1};a.prototype.changeQuestionType=function(a){a=$(a.target);if("open"!==a.val()&&"open"===this.question.get("type")||"open"===a.val()&&"open"!==this.question.get("type"))return this.updateModel(),this.question.set("type",a.val()),this.question.set("options",[]),this.render()};a.prototype.done=function(){this.updateModel();this.question.save()?(Utils.midAlert("Question Saved"),
setTimeout(this.goBack,500)):Utils.midAlert("Save error");return!1};a.prototype.updateModel=function(){var a,c,b,d,f,g,k;this.question.set({prompt:this.$el.find("#prompt").val(),name:this.$el.find("#name").val().safetyDance(),hint:this.$el.find("#hint").val(),skipLogic:this.$el.find("#skip-logic").val(),linkedGridScore:parseInt(this.$el.find("#linked_grid_score").val()),type:this.$el.find("#question_type input:checked").val(),skippable:"true"===this.$el.find("#skip_radio input:radio[name=skippable]:checked").val()});
f=[];a=0;d=this.$el.find(".option_list li");g=0;for(k=d.length;g<k;g++)if(b=d[g],c=$(b).find(".option_label").val(),b=$(b).find(".option_value").val().safetyDance(),null!=c||null!=b)f[a]={label:c,value:b},a++;0!==f.length&&(a=f.pop(),""!==a.label&&""!==a.value&&f.push(a));return this.question.set("options",f)};a.prototype.showDeleteConfirm=function(a){return this.$el.find(".delete_confirm_"+this.$el.find(a.target).attr("data-index")).fadeIn(250)};a.prototype.hideDeleteConfirm=function(a){return this.$el.find(".delete_confirm_"+
this.$el.find(a.target).attr("data-index")).fadeOut(250)};a.prototype.deleteOption=function(a){var c;this.updateModel();c=this.question.get("options");c.splice(this.$el.find(a.target).attr("data-index"),1);this.question.set("options",c);this.question.save();this.render(!1);return!1};return a}(Backbone.View);var QuestionsEditView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
QuestionsEditView=function(b){function a(){this.render=__bind(this.render,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="ul";a.prototype.className="questions_edit_view";a.prototype.initialize=function(a){this.views=[];return this.questions=a.questions};a.prototype.onClose=function(){return this.closeViews()};a.prototype.closeViews=function(){var a,c,b,d,f;d=this.views;f=[];c=0;for(b=d.length;c<b;c++)a=d[c],f.push(a.close());return f};a.prototype.render=
function(){var a,c,b,d,f,g=this;this.closeViews();f=this.questions.models;a=b=0;for(d=f.length;b<d;a=++b)c=f[a],c=new QuestionsEditListElementView({question:c}),this.views.push(c),c.on("deleted",this.render),c.render(),this.$el.append(c.el);return this.$el.sortable({handle:".sortable_handle",start:function(a,c){return c.item.addClass("drag_shadow")},stop:function(a,c){return c.item.removeClass("drag_shadow")},update:function(c,b){var d,f,h,p,r,s;r=function(){var a,c,b,e;b=this.$el.find("li.question_list_element");
e=[];a=0;for(c=b.length;a<c;a++)f=b[a],e.push($(f).attr("data-id"));return e}.call(g);s=[];a=h=0;for(p=r.length;h<p;a=++h)d=r[a],g.questions.get(d),s.push(g.questions.get(d).set({order:a},{silent:!0}).save(null,{silent:!0}));return s}})};return a}(Backbone.View);var QuestionsEditListElementView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
QuestionsEditListElementView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="li";a.prototype.className="question_list_element";a.prototype.events={"click .edit":"edit","click .delete":"toggleDelete","click .delete_cancel":"toggleDelete","click .delete_delete":"delete"};a.prototype.edit=function(a){Tangerine.router.navigate("question/"+this.question.id,!0);return!1};a.prototype.toggleDelete=function(){return this.$el.find(".delete_confirm").fadeToggle(250)};
a.prototype["delete"]=function(a){this.question.collection.remove(this.question.id);this.question.destroy();this.trigger("deleted");return!1};a.prototype.initialize=function(a){this.question=a.question;return this.$el.attr("data-id",this.question.id)};a.prototype.render=function(){this.$el.html("      <table>        <tr>          <td>            <img src='images/icon_drag.png' class='sortable_handle'>          </td>          <td>            <span>"+this.question.get("prompt")+"</span> <span>[<small>"+
this.question.get("name")+", "+this.question.get("type")+"</small>]</span>            <img src='images/icon_edit.png' class='link_icon edit'>            <img src='images/icon_delete.png' class='link_icon delete'><br>            <div class='confirmation delete_confirm'>              <div class='menu_box'>Confirm<br><button class='delete_delete command_red'>Delete</button><button class='delete_cancel command'>Cancel</button>            </div>          </td>        </tr>      </table>      ");return this.trigger("rendered")};
return a}(Backbone.View);var Klass,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Klass=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="klass";a.prototype.initialize=function(){};a.prototype.destroy=function(){var b;b=this.id;(new Students).fetch({success:function(a){var h,d,f,g;h=a.where({klassId:b});g=[];d=0;for(f=h.length;d<f;d++)a=h[d],g.push(a.save({klassId:""}));return g}});(new Results).fetch({success:function(a){var h,d,f,g;h=a.where({klassId:b});g=[];d=0;for(f=h.length;d<f;d++)a=h[d],g.push(a.destroy());
return g}});return a.__super__.destroy.call(this)};return a}(Backbone.Model);var KlassView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){var c=this;this.klass=a.klass;this.assessments=this.klass.assessments;this.results=[];return(new KlassAssessments).fetch({success:function(a){c.assessments=a.where({klassId:c.klass.id});return(new Results).fetch({success:function(a){var b,e,h,l;l=c.assessments;e=0;for(h=l.length;e<h;e++)b=l[e],b.results=a.where({assessmentId:b.id});return c.render()}})}})};
a.prototype.render=function(){var a,c,b,d,f,g;b=this.klass.get("year")||"";a=this.klass.get("grade")||"";c=this.klass.get("stream")||"";c="    <h1>"+t("class")+" "+c+"</h1>    <table>      <tr><td>"+t("year")+"</td><td>"+b+"</td></tr>      <tr><td>"+t("grade")+"</td><tr>"+a+"</td></tr>    </table>    </div>    <ul class='assessment_list'>";f=this.assessments;b=0;for(d=f.length;b<d;b++)a=f[b],c+="<li data-id='"+a.id+"'>"+a.get("name")+" - "+(null!=(g=a.get("results"))?g.length:void 0)+"</li>";this.$el.html(c+
"</ul>");return this.trigger("rendered")};return a}(Backbone.View);var KlassEditView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassEditView=function(b){function a(){this.renderStudents=__bind(this.renderStudents,this);this.onSubviewRendered=__bind(this.onSubviewRendered,this);this.registerStudent=__bind(this.registerStudent,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .back":"back","click .save":"basicInfoSave","click .basic_info_edit":"basicInfoToggle","click .basic_info_cancel":"basicInfoToggle","click .add_student":"addStudentToggle","click .add_student_cancel":"addStudentToggle",
"click .add_student_add":"addStudent","click .register_student":"registerStudentToggle","click .register_student_cancel":"registerStudentToggle","click .register_student_save":"registerStudent"};a.prototype.addStudentToggle=function(){return this.$el.find(".add_student_form, .add_student").toggle()};a.prototype.registerStudentToggle=function(){this.$el.find(".register_student_form, .register_student").toggle();this.$el.find(".register_student_form").is(":visible")&&this.$el.find(".register_student_form").scrollTo();
return this.$el.find("#register_student_name ,#register_student_gender, #register_student_age").val("")};a.prototype.addStudent=function(){var a;if("_none"===this.$el.find("#add_student_select option:selected").val())return alert("Please select a student, or cancel.");a=this.$el.find("#add_student_select option:selected").attr("data-id");a=this.allStudents.get(a);a.set({klassId:this.klass.id});a.save();this.students.add(a);return this.addStudentToggle()};a.prototype.registerStudent=function(){this.students.create({name:this.$el.find("#register_student_name").val(),
gender:this.$el.find("#register_student_gender").val(),age:this.$el.find("#register_student_age").val(),klassId:this.klass.id},{wait:!0});this.registerStudentToggle();return this.$el.find("#register_student_form input").val()};a.prototype.basicInfoToggle=function(){var a;this.$el.find(".basic_info").toggle();a=$(this.$el.find(".basic_info")[1]);a.is(":visible")&&(a.scrollTo(),this.$el.find("#year").focus());this.$el.find("#year").val(this.klass.get("year")||"");this.$el.find("#grade").val(this.klass.get("grade")||
"");return this.$el.find("#stream").val(this.klass.get("stream")||"")};a.prototype.basicInfoSave=function(){var a,c;a=this.$el.find("#start_date").val().split("/");c=new Date;c.setFullYear(parseInt(a[0]));c.setMonth(parseInt(a[1])-1);c.setDate(parseInt(a[2]));this.klass.set({year:this.$el.find("#year").val(),grade:this.$el.find("#grade").val(),stream:this.$el.find("#stream").val(),startDate:c.getTime()});this.klass.save();return this.render()};a.prototype.back=function(){return window.history.back()};
a.prototype.initialize=function(a){this.klass=a.klass;this.students=a.students;this.allStudents=a.allStudents;this.students.on("add remove change",this.renderStudents);return this.views=[]};a.prototype.closeViews=function(){var a,c,b,d;d=this.views;c=0;for(b=d.length;c<b;c++)a=d[c],a.close();return this.views=[]};a.prototype.onSubviewRendered=function(){return this.trigger("subRendered")};a.prototype.renderStudents=function(){var a,c,b,d,f,g,k,l,m,q;a=$("<ul>").addClass("student_list");this.closeViews();
f=this.students.models;c=0;for(d=f.length;c<d;c++)b=f[c],b=new StudentListElementView({student:b,students:this.students}),this.views.push(b),b.on("rendered",this.onSubviewRendered),b.render(),b.on("change",this.renderStudents),a.append(b.el);this.$el.find("#student_list_wrapper").html(a);d="<option value='_none' disabled='disabled' selected='selected'>("+$.t("name")+") - ("+$.t("age")+")</option>";m=this.allStudents.models;f=0;for(k=m.length;f<k;f++){b=m[f];a=!1;q=this.students.models;g=0;for(l=q.length;g<
l;g++)c=q[g],c.id===b.id&&(a=!0);a||(d+="<option data-id='"+b.id+"'>"+b.get("name")+" - "+b.get("age")+"</option>")}return this.$el.find("#add_student_select").html(d)};a.prototype.render=function(){var a,c,b,d;d=this.klass.get("year")||"";a=this.klass.get("grade")||"";b=this.klass.get("stream")||"";c=new Date(parseInt(this.klass.get("startDate")));this.$el.html("    <button class='back navigation'>"+t("back")+"</button>    <h1>"+t("class editor")+"</h1>    <h2>"+t("basic info")+"</h2>    <table class='info_box basic_info'>      <tr><td><label>"+
t("year")+"</label></td><td>"+d+"</td></tr>      <tr><td><label>"+t("grade")+"</label></td><td>"+a+"</td></tr>      <tr><td><label>"+t("stream")+"</label></td><td>"+b+"</td></tr>      <tr><td><label>"+t("starting date")+"</label></td><td>"+(c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate())+"</td></tr>      <tr><td colspan='2'><button class='basic_info_edit command'>"+t("edit")+"</button></td></tr>    </table>    <div class='basic_info confirmation'>      <div class='menu_box'>        <div class='label_value'>          <label for='year'>"+
t("year")+"</label>          <input id='year' value='"+d+"'>        </div>        <div class='label_value'>          <label for='grade'>"+t("grade")+"</label>          <input id='grade' value='"+a+"'>        </div>        <div class='label_value'>          <label for='stream'>"+t("stream")+"</label>          <input id='stream' value='"+b+"'>        </div>        <div class='label_value'>          <label for='start_date'>"+t("starting date")+"</label>          <input id='start_date' value='"+(c.getFullYear()+
"/"+(c.getMonth()+1)+"/"+c.getDate())+"'>        </div>              <button class='save command'>"+t("save")+"</button> <button class='basic_info_cancel command'>"+t("cancel")+"</button>      </div>    </div>        <h2>"+t("students").capitalize()+"</h2>    <div id='student_list_wrapper'></div>    <button class='add_student command'>"+t("add student")+"</button>    <div class='add_student_form menu_box confirmation'>      <div class='label_value'>        <label for='add_student_select'>"+t("add student")+
"</label><br>        <select id='add_student_select'>        </select>      </div>            <button class='add_student_add command'>"+t("add")+"</button><button class='add_student_cancel command'>"+t("cancel")+"</button>    </div>    <button class='register_student command'>"+$.t("register student")+"</button>    <div class='register_student_form menu_box confirmation'>      <h2>"+t("register student")+"</h2>      <div class='label_value'>        <label for='register_student_name'>"+t("name")+"</label>        <input id='register_student_name' value=''>      </div>      <div class='label_value'>        <label for='register_student_gender'>"+
t("gender")+"</label>        <input id='register_student_gender' value=''>      </div>      <div class='label_value'>        <label for='register_student_age'>"+t("age")+"</label>        <input id='register_student_age' value=''>      </div>      <button class='register_student_save command'>"+t("save")+"</button>      <button class='register_student_cancel command'>"+t("cancel")+"</button>    </div>    ");this.trigger("rendered");return this.renderStudents()};return a}(Backbone.View);var Klasses,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};Klasses=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.model=Klass;a.prototype.url="klass";return a}(Backbone.Collection);var KlassesView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassesView=function(b){function a(){this.render=__bind(this.render,this);this.onSubviewRendered=__bind(this.onSubviewRendered,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .add":"toggleAddForm","click .cancel":"toggleAddForm","click .save":"saveNewKlass","click .goto_class":"gotoKlass","click .curricula":"gotoCurricula"};a.prototype.initialize=function(a){this.views=[];this.klasses=a.klasses;this.curricula=a.curricula;return this.klasses.on("add remove change",
this.render)};a.prototype.gotoCurricula=function(){return Tangerine.router.navigate("curricula",!0)};a.prototype.saveNewKlass=function(){var a;a=[];""===$.trim(this.$el.find("#year").val())&&a.push(" - No year.");""===$.trim(this.$el.find("#grade").val())&&a.push(" - No grade.");""===$.trim(this.$el.find("#stream").val())&&a.push(" - No stream.");"_none"===this.$el.find("#curriculum option:selected").val()&&a.push(" - No curriculum selected.");return 0===a.length?this.klasses.create({year:this.$el.find("#year").val(),
grade:this.$el.find("#grade").val(),stream:this.$el.find("#stream").val(),curriculumId:this.$el.find("#curriculum option:selected").attr("data-id"),startDate:(new Date).getTime()}):alert("Please correct the following errors:\n\n"+a.join("\n"))};a.prototype.gotoKlass=function(a){return Tangerine.router.navigate("class/edit/"+$(a.target).attr("data-id"))};a.prototype.toggleAddForm=function(){this.$el.find("#add_form, .add").toggle();this.$el.find("#year").focus();if(this.$el.find("#add_form").is(":visible"))return this.$el.find("#add_form").scrollTo()};
a.prototype.renderKlasses=function(){var a,c,b,d,f;this.closeViews();a=$("<ul>").addClass("klass_list");f=this.klasses.models;b=0;for(d=f.length;b<d;b++)c=f[b],c=new KlassListElementView({klass:c,curricula:this.curricula}),c.on("rendered",this.onSubviewRendered),c.render(),this.views.push(c),a.append(c.el);return this.$el.find("#klass_list_wrapper").append(a)};a.prototype.onSubviewRendered=function(){return this.trigger("subRendered")};a.prototype.render=function(){var a,c,b,d,f;c="<option value='_none' disabled='disabled' selected='selected'>"+
t("select a curriculum")+"</option>";f=this.curricula.models;b=0;for(d=f.length;b<d;b++)a=f[b],c+="<option data-id='"+a.id+"'>"+a.get("name")+"</option>";this.$el.html("      <h1>"+t("classes")+"</h1>      <div id='klass_list_wrapper'></div>      <button class='add command'>"+t("add")+"</button>      <div id='add_form' class='confirmation'>        <div class='menu_box'>           <div class='label_value'>            <label for='year'>"+t("year")+"</label>            <input id='year'>          </div>          <div class='label_value'>            <label for='grade'>"+
t("grade")+"</label>            <input id='grade'>          </div>          <div class='label_value'>            <label for='stream'>"+t("stream")+"</label>            <input id='stream'>          </div>          <div class='label_value'>            <label for='curriculum'>"+t("curriculum")+"</label><br>            <select id='curriculum'>"+c+"</select>          </div>          <button class='command save'>"+t("save")+"</button><button class='command cancel'>"+t("cancel")+"</button>        </div>      </div>      <button class='command curricula'>"+
t("all curricula")+"</button>    ");this.renderKlasses();return this.trigger("rendered")};a.prototype.closeViews=function(){var a,c,b,d;d=null!=this.views;c=0;for(b=d.length;c<b;c++)a=d[c],a.close();return this.views=[]};a.prototype.onClose=function(){return this.closeViews()};return a}(Backbone.View);var KlassListElementView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassListElementView=function(b){function a(){this.render=__bind(this.render,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="li";a.prototype.events={"click .run":"run","click .results":"showReportSelect","change #report":"getReportMenu","click .cancel_report":"cancelReport","click .edit":"edit","click .delete":"toggleDelete","click .delete_cancel":"toggleDelete","click .delete_delete":"delete"};a.prototype.initialize=function(a){this.availableReports=
Tangerine.config.reports;return a.klass.has("curriculumId")?(this.curriculum=new Curriculum({_id:a.klass.get("curriculumId")}),this.curriculum.fetch({success:this.render})):this.curriculum=new Curriculum};a.prototype.edit=function(){return Tangerine.router.navigate("class/edit/"+this.options.klass.id,!0)};a.prototype.getReportMenu=function(a){var c;null!=(c=this.subMenuView)&&c.close();this.subMenuView=new (window[$(a.target).find(":selected").attr("data-menu_view")])({parent:this});this.$el.find("#report_menu_container").append("<div class='report_menu'></div>");
this.subMenuView.setElement(this.$el.find("#report_menu_container .report_menu"));return this.subMenuView.render()};a.prototype.showReportSelect=function(){return this.$el.find(".report_select_container").removeClass("confirmation")};a.prototype.cancelReport=function(){var a;this.$el.find("div#report_menu").empty();this.$el.find("#report :nth-child(1)").attr("selected","selected");this.$el.find(".report_select_container").addClass("confirmation");return null!=(a=this.subMenuView)?a.close():void 0};
a.prototype.onClose=function(){var a;return null!=(a=this.subMenuView)?a.close():void 0};a.prototype.run=function(){return Tangerine.router.navigate("class/"+this.options.klass.id,!0)};a.prototype.toggleDelete=function(){return this.$el.find(".delete_confirm").toggle()};a.prototype["delete"]=function(){return this.options.klass.collection.get(this.options.klass).destroy()};a.prototype.render=function(){var a,c;a=this.options.klass;this.$el.html("      <table>        <tr><td><small>"+t("year")+"</small></td><td>"+
a.get("year")+"</td></tr>        <tr><td><small>"+t("grade")+"</small></td><td>"+a.get("grade")+"</td></tr>        <tr><td><small>"+t("stream")+"</small></td><td>"+a.get("stream")+"</td></tr>        <tr><td><small>"+t("curriculum")+"</small></td><td>"+this.curriculum.escape("name")+"</td></tr>      </table>      <img src='images/icon_run.png'     class='run'>      <img src='images/icon_results.png' class='results'>      <img src='images/icon_edit.png'    class='edit'>      <img src='images/icon_delete.png'  class='delete'>      <div class='report_select_container confirmation'>        <div class='menu_box'>          <select id='report'>            <option selected='selected' disabled='disabled'>"+
t("select report type")+"</option>            "+function(){var a,b,e,g;e=this.availableReports;g=[];a=0;for(b=e.length;a<b;a++)c=e[a],g.push("<option data-menu_view='"+c.menuView+"'>"+t(c.name)+"</option>");return g}.call(this).join("")+"          </select>        </div>        <div id='report_menu_container'></div>        <button class='command cancel_report'>"+t("cancel")+"</button>      </div>      <div class='delete_confirm confirmation'>        <div class='menu_box'>          "+t("confirm")+
"<br>          <button class='delete_delete command_red'>"+t("delete")+"</button>          <button class='delete_cancel command'>"+t("cancel")+"</button>        </div>      </div>    ");return this.trigger("rendered")};return a}(Backbone.View);var KlassSubtestRunView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassSubtestRunView=function(b){function a(){this.onPrototypeRendered=__bind(this.onPrototypeRendered,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .done":"done","click .cancel":"cancel","click .subtest_help":"toggleHelp"};a.prototype.toggleHelp=function(){return this.$el.find(".enumerator_help").fadeToggle(250)};a.prototype.initialize=function(a){this.protoViews=Tangerine.config.prototypeViews;this.prototypeRendered=!1;return this.result=
new KlassResult({resultBucket:a.subtest.get("resultBucket"),reportType:a.subtest.get("reportType"),studentId:a.student.id,subtestId:a.subtest.id,part:a.subtest.get("part"),klassId:a.student.get("klassId")})};a.prototype.render=function(){var a,c;a=""!==(this.options.subtest.get("enumeratorHelp")||"")?"<button class='subtest_help command'>help</button><div class='enumerator_help'>"+this.options.subtest.get("enumeratorHelp")+"</div>":"";c=""!==(this.options.subtest.get("studentDialog")||"")?"<div class='student_dialog'>"+
this.options.subtest.get("studentDialog")+"</div>":"";this.$el.html("      <h2>"+this.options.subtest.get("name")+"</h2>      "+a+"      "+c+"    ");this.prototypeView=new (window[this.protoViews[this.options.subtest.get("prototype")].run])({model:this.options.subtest,parent:this});this.prototypeView.on("rendered",this.onPrototypeRendered);this.prototypeView.render();this.$el.append(this.prototypeView.el);this.prototypeRendered=!0;this.$el.append("<button class='done navigation'>Done</button> <button class='cancel navigation'>Cancel</button>");
return this.trigger("rendered")};a.prototype.onPrototypeRendered=function(){return this.trigger("rendered")};a.prototype.onClose=function(){var a;return null!=(a=this.prototypeView)?"function"===typeof a.close?a.close():void 0:void 0};a.prototype.isValid=function(){return this.prototypeRendered?null!=this.prototypeView.isValid?this.prototypeView.isValid():!1:!1};a.prototype.getResult=function(){return this.prototypeView.getResult()};a.prototype.getSkipped=function(){if(null!=this.prototypeView.getSkipped)return this.prototypeView.getSkipped();
throw"Prototype skipping not implemented";};a.prototype.cancel=function(){return Tangerine.router.navigate("class/"+this.options.student.get("klassId")+"/"+this.options.subtest.get("part"),!0)};a.prototype.done=function(){return this.isValid()?(this.result.add(this.getResult()),Tangerine.router.navigate("class/"+this.options.student.get("klassId")+"/"+this.options.subtest.get("part"),!0)):this.prototypeView.showErrors()};return a}(Backbone.View);var KlassSubtestResultView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassSubtestResultView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .run":"gotoRun","click .back":"back","click .show_itemized":"showItemized"};a.prototype.initialize=function(a){};a.prototype.showItemized=function(){return this.$el.find(".itemized").fadeToggle()};a.prototype.gotoRun=function(){return Tangerine.router.navigate("class/run/"+this.options.student.id+"/"+this.options.subtest.id,!0)};a.prototype.back=function(){return Tangerine.router.navigate("class/"+
this.options.student.get("klassId")+"/"+this.options.subtest.get("part"),!0)};a.prototype.render=function(){var a,c,b,d,f,g,k,l;this.options.subtest.get("items");d="<br>";f="";if(0!==this.options.result.length){a=g=0;l=this.options.result[0].get("subtestData").items;c=0;for(k=l.length;c<k;c++)b=l[c],"correct"===b.itemResult&&a++,g++;a=a/g*100;a<100*parseFloat(Tangerine.settings.generalThreshold)&&(d+="<div class='info_box'><b>Warning</b><br>Student's "+Math.decimals(a,2)+"% score is less than threshold of "+
Math.decimals(100*Tangerine.settings.generalThreshold,2)+"%</div><br>");d+="<button class='command show_itemized'>"+t("itemized results")+"</button><table class='itemized confirmation'><tbody><tr><th>Item</th><th>Result</th></tr>";g=this.options.result[0].get("subtestData").items;c=a=0;for(b=g.length;a<b;c=++a)c=g[c],d+="<tr><td>"+c.itemLabel+"</td><td>"+t(c.itemResult)+"</td></tr>";d+="</tbody></table><br>";a=new Date(this.options.result[0].get("timestamp"));f+="        <tr>          <td><label>"+
t("taken")+"</label></td><td>"+a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+"</td>        </tr>      "}this.$el.html("      <h1>Result</h1>      <table class='info_box'><tbody>        <tr>          <td><label>Assessment</label></td>          <td>"+this.options.subtest.get("part")+"</td>        </tr>        <tr>          <td><label>Student</label></td>          <td>"+this.options.student.escape("name")+"</td>        </tr>        <tr>          <td><label>Subtest</label></td>          <td>"+
this.options.subtest.escape("name")+"</td>        </tr>        "+f+"      </tbody></table>      "+d+"      <div class='menu_box'>        <img src='images/icon_run.png' class='run'>      </div><br>      <button class='navigation back'>Back</button>    ");return this.trigger("rendered")};return a}(Backbone.View);var KlassMenuView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassMenuView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .registration":"gotoKlasses"};a.prototype.gotoKlasses=function(){return Tangerine.router.navigate("class",!0)};a.prototype.initialize=function(a){};a.prototype.render=function(){this.$el.html("    <h1>Tangerine Class</h1>    <button class='collect command'>Collect</button>    <button class='manage command'>Manage</button>    <button class='reports command'>Reports</button>    <button class='advice command'>Advice</button>    <button class='registration command'>Class Registration</button>        ");
return this.trigger("rendered")};return a}(Backbone.View);var KlassPartlyView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassPartlyView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .next_part":"nextPart","click .prev_part":"prevPart","click .back":"back","click .student_subtest":"gotoStudentSubtest","keyup #current_part":"gotoAssessment","keyup #search_student_name":"filterStudents"};a.prototype.filterStudents=function(){this.search=this.$el.find("#search_student_name").val();return this.updateGridPage()};a.prototype.gotoAssessment=function(){var a;
a=this.$el.find("#current_part").val();if(""!==a)return this.currentPart=parseInt(a),this.updateGridPage()};a.prototype.update=function(){this.render();return Tangerine.router.navigate("class/"+this.options.klass.id+"/"+this.currentPart)};a.prototype.back=function(){return Tangerine.router.navigate("class",!0)};a.prototype.gotoStudentSubtest=function(a){var c;c=$(a.target).attr("data-studentId");a=$(a.target).attr("data-subtestId");return Tangerine.router.navigate("class/result/student/subtest/"+
c+"/"+a,!0)};a.prototype.nextPart=function(){if(this.currentPart<this.subtestsByPart.length-1)return this.currentPart++,this.update()};a.prototype.prevPart=function(){if(1<this.currentPart)return this.currentPart--,this.update()};a.prototype.initialize=function(a){var c,b;this.search="";this.currentPart=a.part||1;this.subtestsByPart=[];for(b=1;0!==(c=a.subtests.where({part:b})).length;)0!==c&&(this.subtestsByPart[b]=c),this.subtestsByPart[b].sort(function(a,c){return a.get("name").toLowerCase()>c.get("name").toLowerCase()}),
b++;return this.totalParts=b-1};a.prototype.updateGridPage=function(){return this.$el.find("#grid_container").html(this.getGridPage())};a.prototype.getGridPage=function(){var a,c,b,d,f,g,k,l,m,q,n,p;l=[];f=this.subtestsByPart[this.currentPart];p=this.options.students.models;c=q=0;for(m=p.length;q<m;c=++q)for(g=p[c],l[c]=[],d=new KlassResults(this.options.results.where({studentId:g.id})),b=a=0,n=f.length;a<n;b=++a)b=f[b],k=d.where({subtestId:b.id}),k=0!==k.length,(~g.get("name").toLowerCase().indexOf(this.search.toLowerCase())||
""===this.search)&&l[c].push({content:k?"&#x2714;":"?",taken:k,studentId:g.id,studentName:g.get("name"),subtestId:b.id});c="<table class='info_box_wide'><tbody><tr><th></th>";d=0;for(g=f.length;d<g;d++)b=f[d],c+="<th><div class='part_subtest_report' data-id='"+b.id+"'>"+b.get("name")+"</div></th>";c+="</tr>";b=0;for(d=l.length;b<d;b++)if(f=l[b],null!=f&&f.length){c+="<tr><td><div class='student' data-studentId='"+f[0].studentId+"'>"+f[0].studentName+"</div></td>";a=q=0;for(g=f.length;q<g;a=++q)a=
f[a],m=a.taken?" subtest_taken":"",c+="<td><div class='student_subtest command "+m+"' data-taken='"+a.taken+"' data-studentId='"+a.studentId+"' data-subtestId='"+a.subtestId+"'>"+a.content+"</div></td>";c+="</tr>"}return c+"</tbody></table>"};a.prototype.render=function(){var a;a=this.getGridPage();this.$el.html("      <h1>"+t("assessment status")+"</h1>      <input id='search_student_name' placeholder='"+t("search student name")+"' type='text'>      <div id='grid_container'>"+a+"</div><br>      <h2>"+
t("current assessment")+" </h2>            <button class='prev_part command'>&lt;</button> <input type='number' value='"+this.currentPart+"' id='current_part'> <button class='next_part command'>&gt;</button><br><br>      <button class='back navigation'>"+t("back")+"</button>       ");return this.trigger("rendered")};return a}(Backbone.View);var KlassResult,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassResult=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="result";a.prototype.initialize=function(a){return this.set({timestamp:(new Date).getTime()})};a.prototype.add=function(a){return this.save({subtestData:a})};return a}(Backbone.Model);var KlassResults,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};KlassResults=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="result";a.prototype.model=Result;return a}(Backbone.Collection);var RegisterTeacherView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
RegisterTeacherView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .register":"register"};a.prototype.initialize=function(a){return this.model=a.model};a.prototype.register=function(){this.model.set({name:this.$el.find("#name").val(),school:this.$el.find("#school").val(),village:this.$el.find("#village").val(),district:this.$el.find("#district").val(),region:this.$el.find("#region").val()});return this.model.save()};a.prototype.render=
function(){this.$el.html("    <h1>Register</h1>    <div class='label_value'>      <label for='role'>Role</label>      <input id='role'>    </div>    <div class='label_value'>      <label for='name'>Name</label>      <input id='name'>    </div>    <div class='label_value'>      <label for='school'>School</label>      <input id='school'>    </div>    <div class='label_value'>      <label for='school'>Village</label>      <input id='school'>    </div>    <div class='label_value'>      <label for='district'>District</label>      <input id='district'>    </div>    <div class='label_value'>      <label for='region'>Region</label>      <input id='region'>    </div>    <button class='register'>Register</button>    ");
return this.trigger("rendered")};return a}(Backbone.View);var KlassToDateView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
KlassToDateView=function(b){function a(){this.afterRender=__bind(this.afterRender,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .xtick":"changeCurrentIndex"};a.prototype.changeCurrentIndex=function(a){a=$(a.target);this.currentIndex=parseInt(a.attr("data-index"));this.processResults();this.readyFlot();return this.afterRender()};a.prototype.bucketize=function(a){var c,b,d,f;b=[];d=0;for(f=a.length;d<f;d++)c=a[d],b[c]=[];return b};a.prototype.initialize=
function(a){var c,b,d,f,g,k,l,m;this.currentPart=Math.round(((new Date).getTime()-a.klass.get("startDate"))/6048E5);null==this.currentIndex&&(this.currentIndex=this.currentPart);d=[];c=f=1;for(b=this.currentPart;1<=b?f<=b:f>=b;c=1<=b?++f:--f)d.push(c);this.range=d;f=[];k=a.subtests;d=0;for(g=k.length;d<g;d++)b=k[d],c=b.get("part"),null!=f[c]?f[c].push(b):f[c]=[b];this.subtestsByResultsBucket=[];this.resultsByBucketByPart={};c=g=0;for(l=f.length;g<l;c=++g)if(d=f[c],void 0!==d)for(k=0,m=d.length;k<
m;k++)b=d[k],void 0===this.resultsByBucketByPart[b.get("resultBucket")]&&(this.resultsByBucketByPart[b.get("resultBucket")]=[],this.subtestsByResultsBucket[b.get("resultBucket")]=[]),this.resultsByBucketByPart[b.get("resultBucket")][c]=a.results.where({subtestId:b.id,klassId:a.klass.id}),this.subtestsByResultsBucket[b.get("resultBucket")].push(b);this.bucketList=_.keys(this.resultsByBucketByPart);this.resultsByPart=[];c=g=0;for(k=f.length;g<k;c=++g)if(d=f[c],null!=d)for(b=m=0,l=d.length;m<l;b=++m)b=
d[b],this.resultsByPart[c]=null!=this.resultsByPart[c]?this.resultsByPart[c].concat(a.results.where({subtestId:b.id})):a.results.where({subtestId:b.id});this.processResults();return this.readyFlot()};a.prototype.processResults=function(){var a,c,b,d,f,g,k,l,m;this.percentagesByStudent=[];this.flotArrays=this.bucketize(this.bucketList);m=this.resultsByBucketByPart;for(b in m)for(d in c=m[b],c){g=c[d];f=[];k=0;for(l=g.length;k<l;k++)a=g[k],a=this.getBasicStats(a),f.push(a.percentCorrect);0<g.length&&
(this.flotArrays[b].push([parseInt(d),Math.ave.apply(this,f)]),parseInt(d)===this.currentIndex&&(this.percentagesByStudent[b]=f))}return this.warnings=Tangerine.ReportWarnings.KlassToDateView({percentages:this.percentagesByStudent,studentCount:this.options.studentCount})};a.prototype.readyFlot=function(){var a,c,b,d,f,g,k,l=this;b=this.bucketize(this.bucketList);g=this.subtestsByResultsBucket;for(c in g)d=g[c],0<(null!=(k=d[0])?"function"===typeof k.get?k.get("timer"):void 0:void 0)&&1<_.flatten(this.resultsByBucketByPart[d[0].get("resultBucket")]).length?
b[c]="lines":b[c]="points";this.flotData=[];c=this.flotArrays;for(a in c)d=c[a],d=_.reject(d,function(a){return a[0]>l.currentPart}),"lines"===b[a]&&d.push([this.currentPart+1,_.last(d)[1]]),d={label:a,data:d},d[b[a]]={show:!0,radius:4,width:4},this.flotData.push(d);return this.flotOptions={yaxis:{min:0,max:100,ticks:10},xaxis:{min:0.5,max:this.currentPart+0.5,ticks:function(){var a,c,b;b=[];f=a=1;for(c=this.currentPart;1<=c?a<=c:a>=c;f=1<=c?++a:--a)b.push(String(f));return b}.call(this),tickDecimals:0,
tickFormatter:function(a){return"<button class='command xtick' data-index='"+a+"'>"+a+"</button>"}},grid:{markings:[{color:"#ffc",xaxis:{to:this.currentIndex+0.5,from:this.currentIndex-0.5}}]}}};a.prototype.getBasicStats=function(a){var c,b,d,f,g,k;d=c=0;k=a.get("subtestData").items;f=0;for(g=k.length;f<g;f++)b=k[f],"correct"===b.itemResult&&c++,d++;return{percentCorrect:c/d*100,correctItems:c,totalItems:d,studentId:a.get("studentId")}};a.prototype.render=function(){this.$el.html("      <h1>"+t("class progress report")+
"</h1>      <p>This class has "+this.options.studentCount+" students.</p>      <div id='chart' style='width:450px; height:300px;'></div>      <div id='warnings'></div>    ");this.trigger("rendered");return"#BDDC93"};a.prototype.afterRender=function(){var a,c,b,d,f;if(0<this.warnings.length){c="<div class='warnings'>        <b>Warning</b><br>";f=this.warnings;b=0;for(d=f.length;b<d;b++)a=f[b],c+=a.html;c+="</div>";this.$el.find("#warnings").html(c)}else this.$el.find("#warnings").html("");this.flotOptions.legend=
{show:!0};return this.plot=$.plot(this.$el.find("#chart"),this.flotData,this.flotOptions)};return a}(Backbone.View);var KlassToDateMenuView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};KlassToDateMenuView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){return Tangerine.router.navigate("report/classToDate/"+a.parent.options.klass.id,!0)};return a}(Backbone.View);var StudentToDateView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
StudentToDateView=function(b){function a(){this.afterRender=__bind(this.afterRender,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .xtick":"changeCurrentIndex"};a.prototype.changeCurrentIndex=function(a){a=$(a.target);this.currentIndex=parseInt(a.attr("data-index"));this.processResults();this.readyFlot();return this.afterRender()};a.prototype.bucketize=function(a){var c,b,d,f;b=[];d=0;for(f=a.length;d<f;d++)c=a[d],b[c]=[];return b};a.prototype.initialize=
function(a){var c,b,d,f,g,k,l,m;this.currentPart=Math.round(((new Date).getTime()-a.klass.get("startDate"))/6048E5);null==this.currentIndex&&(this.currentIndex=this.currentPart);d=[];c=f=1;for(b=this.currentPart;1<=b?f<=b:f>=b;c=1<=b?++f:--f)d.push(c);this.range=d;f=[];k=a.subtests;d=0;for(g=k.length;d<g;d++)b=k[d],c=b.get("part"),null!=f[c]?f[c].push(b):f[c]=[b];this.subtestsByResultsBucket=[];this.resultsByBucketByPart={};c=g=0;for(l=f.length;g<l;c=++g)if(d=f[c],void 0!==d)for(k=0,m=d.length;k<
m;k++)b=d[k],void 0===this.resultsByBucketByPart[b.get("resultBucket")]&&(this.resultsByBucketByPart[b.get("resultBucket")]=[],this.subtestsByResultsBucket[b.get("resultBucket")]=[]),this.resultsByBucketByPart[b.get("resultBucket")][c]=a.results.where({subtestId:b.id,klassId:a.klass.id,studentId:a.studentId}),this.subtestsByResultsBucket[b.get("resultBucket")].push(b);this.bucketList=_.keys(this.resultsByBucketByPart);this.resultsByPart=[];c=g=0;for(k=f.length;g<k;c=++g)if(d=f[c],null!=d)for(b=m=
0,l=d.length;m<l;b=++m)b=d[b],this.resultsByPart[c]=null!=this.resultsByPart[c]?this.resultsByPart[c].concat(a.results.where({subtestId:b.id})):a.results.where({subtestId:b.id});this.processResults();return this.readyFlot()};a.prototype.processResults=function(){var a,c,b,d,f,g,k,l,m;this.percentagesByStudent=[];this.flotArrays=this.bucketize(this.bucketList);m=this.resultsByBucketByPart;for(b in m)for(d in c=m[b],c){g=c[d];f=[];k=0;for(l=g.length;k<l;k++)a=g[k],a=this.getBasicStats(a),f.push(a.percentCorrect);
0<g.length&&(this.flotArrays[b].push([parseInt(d),Math.ave.apply(this,f)]),parseInt(d)===this.currentIndex&&(this.percentagesByStudent[b]=f))}return this.warnings=Tangerine.ReportWarnings.StudentToDateView({percentages:this.percentagesByStudent,studentName:this.options.student.get("name")})};a.prototype.readyFlot=function(){var a,c,b,d,f,g,k,l=this;b=this.bucketize(this.bucketList);g=this.subtestsByResultsBucket;for(c in g)d=g[c],0<(null!=(k=d[0])?"function"===typeof k.get?k.get("timer"):void 0:void 0)&&
1<_.flatten(this.resultsByBucketByPart[d[0].get("resultBucket")]).length?b[c]="lines":b[c]="points";this.flotData=[];c=this.flotArrays;for(a in c)d=c[a],d=_.reject(d,function(a){return a[0]>l.currentPart}),"lines"===b[a]&&d.push([this.currentPart+1,_.last(d)[1]]),d={label:a,data:d},d[b[a]]={show:!0,radius:4,width:4},this.flotData.push(d);return this.flotOptions={yaxis:{min:0,max:100,ticks:10},xaxis:{min:0.5,max:this.currentPart+0.5,ticks:function(){var a,c,b;b=[];f=a=1;for(c=this.currentPart;1<=c?
a<=c:a>=c;f=1<=c?++a:--a)b.push(String(f));return b}.call(this),tickDecimals:0,tickFormatter:function(a){return"<button class='command xtick' data-index='"+a+"'>"+a+"</button>"}},grid:{markings:[{color:"#ffc",xaxis:{to:this.currentIndex+0.5,from:this.currentIndex-0.5}}]}}};a.prototype.getBasicStats=function(a){var c,b,d,f,g,k;d=c=0;k=a.get("subtestData").items;f=0;for(g=k.length;f<g;f++)b=k[f],"correct"===b.itemResult&&c++,d++;return{percentCorrect:c/d*100,correctItems:c,totalItems:d,studentId:a.get("studentId")}};
a.prototype.render=function(){this.$el.html("      <h1>"+t("student progress report")+"</h1>      <h2>"+this.options.student.get("name")+"</h2>      <div id='chart' style='width:450px; height:300px;'></div>      <div id='warnings'></div>    ");this.trigger("rendered");return"#BDDC93"};a.prototype.afterRender=function(){var a,c,b,d,f;if(0<this.warnings.length){c="<div class='warnings'>        <b>Warning</b><br>";f=this.warnings;b=0;for(d=f.length;b<d;b++)a=f[b],c+=a.html;c+="</div>";this.$el.find("#warnings").html(c)}else this.$el.find("#warnings").html("");
this.flotOptions.legend={show:!0};return this.plot=$.plot(this.$el.find("#chart"),this.flotData,this.flotOptions)};return a}(Backbone.View);var StudentToDateMenuView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
StudentToDateMenuView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"change .student_selector":"gotoStudentToDateReport"};a.prototype.gotoStudentToDateReport=function(a){return Tangerine.router.navigate("report/studentToDate/"+this.$el.find(a.target).find(":selected").attr("data-studentId"),!0)};a.prototype.initialize=function(a){var c=this;this.parent=a.parent;this.klass=this.parent.options.klass;this.curricula=this.parent.options.curricula;
return(new Students).fetch({success:function(a){c.students=a.where({klassId:c.klass.id});c.ready=!0;return c.render()}})};a.prototype.render=function(){var a,c,b,d,f;if(this.ready){a="        <select class='student_selector'>          <option disabled='disabled' selected='selected'>"+t("select a student")+"</option>          ";f=this.students;b=0;for(d=f.length;b<d;b++)c=f[b],a+="<option data-studentId='"+c.id+"'>"+c.get("name")+"</option>";return this.$el.html(a+"</select>")}return this.$el.html("<img src='images/loading.gif' class='loading'>")};
return a}(Backbone.View);var PartByStudentView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
PartByStudentView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.normalCurve=[0,0.00399,0.00798,0.01197,0.01595,0.01994,0.02392,0.0279,0.03188,0.03586,0.03983,0.0438,0.04776,0.05172,0.05567,0.05962,0.06356,0.06749,0.07142,0.07535,0.07926,0.08317,0.08706,0.09095,0.09483,0.09871,0.10257,0.10642,0.11026,0.11409,0.11791,0.12172,0.12552,0.1293,0.13307,0.13683,0.14058,0.14431,0.14803,0.15173,0.15542,0.1591,0.16276,0.1664,0.17003,0.17364,0.17724,
0.18082,0.18439,0.18793,0.19146,0.19497,0.19847,0.20194,0.2054,0.20884,0.21226,0.21566,0.21904,0.2224,0.22575,0.22907,0.23237,0.23565,0.23891,0.24215,0.24537,0.24857,0.25175,0.2549,0.25804,0.26115,0.26424,0.2673,0.27035,0.27337,0.27637,0.27935,0.2823,0.28524,0.28814,0.29103,0.29389,0.29673,0.29955,0.30234,0.30511,0.30785,0.31057,0.31327,0.31594,0.31859,0.32121,0.32381,0.32639,0.32894,0.33147,0.33398,0.33646,0.33891,0.34134,0.34375,0.34614,0.34849,0.35083,0.35314,0.35543,0.35769,0.35993,0.36214,0.36433,
0.3665,0.36864,0.37076,0.37286,0.37493,0.37698,0.379,0.381,0.38298,0.38493,0.38686,0.38877,0.39065,0.39251,0.39435,0.39617,0.39796,0.39973,0.40147,0.4032,0.4049,0.40658,0.40824,0.40988,0.41149,0.41308,0.41466,0.41621,0.41774,0.41924,0.42073,0.4222,0.42364,0.42507,0.42647,0.42785,0.42922,0.43056,0.43189,0.43319,0.43448,0.43574,0.43699,0.43822,0.43943,0.44062,0.44179,0.44295,0.44408,0.4452,0.4463,0.44738,0.44845,0.4495,0.45053,0.45154,0.45254,0.45352,0.45449,0.45543,0.45637,0.45728,0.45818,0.45907,
0.45994,0.4608,0.46164,0.46246,0.46327,0.46407,0.46485,0.46562,0.46638,0.46712,0.46784,0.46856,0.46926,0.46995,0.47062,0.47128,0.47193,0.47257,0.4732,0.47381,0.47441,0.475,0.47558,0.47615,0.4767,0.47725,0.47778,0.47831,0.47882,0.47932,0.47982,0.4803,0.48077,0.48124,0.48169,0.48214,0.48257,0.483,0.48341,0.48382,0.48422,0.48461,0.485,0.48537,0.48574,0.4861,0.48645,0.48679,0.48713,0.48745,0.48778,0.48809,0.4884,0.4887,0.48899,0.48928,0.48956,0.48983,0.4901,0.49036,0.49061,0.49086,0.49111,0.49134,0.49158,
0.4918,0.49202,0.49224,0.49245,0.49266,0.49286,0.49305,0.49324,0.49343,0.49361,0.49379,0.49396,0.49413,0.4943,0.49446,0.49461,0.49477,0.49492,0.49506,0.4952,0.49534,0.49547,0.4956,0.49573,0.49585,0.49598,0.49609,0.49621,0.49632,0.49643,0.49653,0.49664,0.49674,0.49683,0.49693,0.49702,0.49711,0.4972,0.49728,0.49736,0.49744,0.49752,0.4976,0.49767,0.49774,0.49781,0.49788,0.49795,0.49801,0.49807,0.49813,0.49819,0.49825,0.49831,0.49836,0.49841,0.49846,0.49851,0.49856,0.49861,0.49865,0.49869,0.49874,0.49878,
0.49882,0.49886,0.49889,0.49893,0.49896,0.499,0.49903,0.49906,0.4991,0.49913,0.49916,0.49918,0.49921,0.49924,0.49926,0.49929,0.49931,0.49934,0.49936,0.49938,0.4994,0.49942,0.49944,0.49946,0.49948,0.4995,0.49952,0.49953,0.49955,0.49957,0.49958,0.4996,0.49961,0.49962,0.49964,0.49965,0.49966,0.49968,0.49969,0.4997,0.49971,0.49972,0.49973,0.49974,0.49975,0.49976,0.49977,0.49978,0.49978,0.49979,0.4998,0.49981,0.49981,0.49982,0.49983,0.49983,0.49984,0.49985,0.49985,0.49986,0.49986,0.49987,0.49987,0.49988,
0.49988,0.49989,0.49989,0.4999,0.4999,0.4999,0.49991,0.49991,0.49992,0.49992,0.49992,0.49992,0.49993,0.49993,0.49993,0.49994,0.49994,0.49994,0.49994,0.49995,0.49995,0.49995,0.49995,0.49995,0.49996,0.49996,0.49996,0.49996,0.49996,0.49996,0.49997,0.49997,0.49997,0.49997,0.49997,0.49997,0.49997,0.49997,0.49998,0.49998,0.49998,0.49998];a.prototype.colors=["2E8B57","90EE90","00FF00"];a.prototype.status=["Concerning","Average","Great"];a.prototype.events={"click .back":"goBack"};a.prototype.goBack=function(){return history.back()};
a.prototype.initialize=function(a){var c,b,d,f,g,k,l,m,q,n,p;this.table=[];this.summary={name:a.subtest.get("name"),aCorrect:0,stdDev:0,classSize:a.students.length,totalItems:a.subtest.get("items").length,watchList:[]};n=a.results;b=0;for(m=n.length;b<m;b++){f=n[b];k=c=d=a=0;p=f.attributes.subtestData.items;l=0;for(q=p.length;l<q;l++)g=p[l],"correct"===g.itemResult&&a++,"incorrect"===g.itemResult&&d++,"missing"===g.itemResult&&c++,k++;a={name:this.options.students.get(f.get("studentId")).get("name"),
pCorrect:0,nCorrect:a,attempted:k-c,total:k,deviation:0,percentile:0,status:""};a.pCorrect=Math.round(a.nCorrect/a.attempted*100);this.summary.aCorrect+=a.pCorrect;this.table.push(a)}this.summary.aCorrect=Math.decimals(this.summary.aCorrect/this.table.length,2);n=this.table;b=0;for(m=n.length;b<m;b++)a=n[b],this.summary.stdDev+=Math.pow(a.pCorrect-this.summary.aCorrect,2);this.summary.stdDev=Math.decimals(Math.pow(this.summary.stdDev/this.table.length,0.5),2);d=this.table;g=[];b=m=0;for(n=d.length;m<
n;b=++m)a=d[b],c=(a.pCorrect-this.summary.aCorrect)/this.summary.stdDev,c=Math.round(100*c),k=409<c||-409>c?0:0<c?100*Math.round(50+100*this.normalCurve[c])/100:0>c?100*Math.round(50-100*this.normalCurve[-1*c])/100:50,f=this.getIndexFromPercentile(k),this.table[b].deviation=c/100,this.table[b].percentile=k,this.table[b].index=f,this.table[b].status=this.status[f],0!==f||~this.summary.watchList.indexOf(a.name)||this.summary.watchList.push(a.name),g.push(this.table.sort(function(a,c){return c.pCorrect-
a.pCorrect}));return g};a.prototype.render=function(){var a,c,b,d,f;if(0===this.table.length)this.$el.html("<h1>"+t("student grouping report")+"</h1>      <p>No students assessed yet. Return to the <a href='#class'>class menu</a> and click the <img src='images/icon_run.png'> icon to collect data.</p>"),this.trigger("rendered");else{a="      <h1>"+t("student grouping report")+"</h1>      <table border='3'>      <tr>        <td>Name</td>        <td>% Correct</td>        <td># Correct</td>        <td># Attempted</td>        <td>Total</td>        <td>%ile</td>        <td>Status</td>      </tr>    ";
f=this.table;b=0;for(d=f.length;b<d;b++)c=f[b],a+="        <tr bgcolor='"+this.colors[c.index]+"'>          <td>"+c.name+"</td>          <td>"+c.pCorrect+"</td>          <td>"+c.nCorrect+"</td>          <td>"+c.attempted+"</td>          <td>"+c.total+"</td>          <td>"+c.percentile+"</td>          <td>"+c.status+"</td>        </tr>        ";a+="</table>";c="<h1>"+t("student grouping report")+"</h1>    <table border='3'>      <tr><td>Subtest Name</td>          <td>"+this.summary.name+"</td></tr>      <tr><td>Average (%)</td>           <td>"+
this.summary.aCorrect+"</td></tr>      <tr><td>Standard Deviation (%)</td><td>"+this.summary.stdDev+"</td></tr>      <tr><td>Class Size</td>            <td>"+this.summary.classSize+"</td></tr>      <tr><td>Number of Questions</td>   <td>"+this.summary.totalItems+"</td></tr>      <tr><td>Students to watch</td>     <td>"+this.summary.watchList.join(", ")+"</td></tr>    </table>";this.$el.html("      "+c+"      "+a+"          <button class='navigation back'>Back</button>    ");return this.trigger("rendered")}};
a.prototype.getIndexFromPercentile=function(a){a=Math.round((a-17)/33);0>a?a=0:2<a&&(a=2);return a};return a}(Backbone.View);var PartByStudentMenuView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
PartByStudentMenuView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"change .part_selector":"gotoPartByStudentReport"};a.prototype.gotoPartByStudentReport=function(a){return Tangerine.router.navigate("report/partByStudent/"+this.$el.find(a.target).find(":selected").attr("data-subtestId"),!0)};a.prototype.initialize=function(a){var c=this;this.parent=a.parent;this.klass=this.parent.options.klass;this.curricula=this.parent.options.curricula;
this.currentPart=Math.round(((new Date).getTime()-this.klass.get("startDate"))/6048E5);return(new Subtests).fetch({success:function(a){var b,e,g;b=a.where({curriculaId:c.curricula.id});c.parts=[];e=0;for(g=b.length;e<g;e++)a=b[e],c.parts[a.get("part")]=a.id;c.ready=!0;return c.render()}})};a.prototype.render=function(){var a,c,b,d,f,g,k;if(this.ready){c="        <select class='part_selector'>          <option disabled='disabled' selected='selected'>Select an assessment</option>          ";k=this.parts;
b=f=0;for(g=k.length;f<g;b=++f)d=k[b],null!=d&&(a=this.currentPart===b?"**":"",c+="<option data-subtestId='"+d+"'>"+b+a+"</option>");return this.$el.html(c+"</select>")}return this.$el.html("<img src='images/loading.gif' class='loading'>")};return a}(Backbone.View);var MasteryCheckView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
MasteryCheckView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){var c,b,d,f,g;this.results=a.results;this.student=a.student;this.klass=a.klass;this.resultsByPart=[];a={};g=this.results.models;d=0;for(f=g.length;d<f;d++)b=g[d],a[b.get("resultBucket")]=!0,c=b.get("part"),null==this.resultsByPart[c]&&(this.resultsByPart[c]=[]),this.resultsByPart[c].push(b),this.resultsByPart[c].sort(function(a,c){return a.attributes.reportType<
c.attributes.reportType});a=_.keys(a);return this.currentPart=Math.round(((new Date).getTime()-this.klass.get("startDate"))/6048E5)};a.prototype.render=function(){var a,c,b,d,f,g,k,l,m,q,n,p,r;d="      <h1>Mastery check report</h1>      <h2>"+this.student.get("name")+"</h2>      <table class='mastery_check'>    ";a=g=1;for(n=this.currentPart;1<=n?g<=n:g>=n;a=1<=n?++g:--g)if(void 0!==this.resultsByPart[a])for(d+="<tr>",d+="<td>Week</td><td>"+a+"</td>",p=this.resultsByPart[a],k=0,m=p.length;k<m;k++){c=
p[k];a=c.attributes.resultBucket.titleize();b=0;r=c.attributes.subtestData.items;l=0;for(q=r.length;l<q;l++)f=r[l],"correct"===f.itemResult&&b++;c=c.attributes.subtestData.items.length;d+="<td>"+a+" correct</td><td>"+b+"/"+c+"</td>"}this.$el.html(d+"</table>");return this.trigger("rendered")};return a}(Backbone.View);var MasteryCheckMenuView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
MasteryCheckMenuView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"change .student_selector":"gotoMasteryCheckReport"};a.prototype.gotoMasteryCheckReport=function(a){return Tangerine.router.navigate("report/masteryCheck/"+this.$el.find(a.target).find(":selected").attr("data-studentId"),!0)};a.prototype.initialize=function(a){var c=this;this.parent=a.parent;this.klass=this.parent.options.klass;this.curricula=this.parent.options.curricula;
return(new Students).fetch({success:function(a){c.students=a.where({klassId:c.klass.id});c.ready=!0;return c.render()}})};a.prototype.render=function(){var a,c,b,d,f;if(this.ready){a="        <select class='student_selector'>          <option disabled='disabled' selected='selected'>"+t("select a student")+"</option>          ";f=this.students;b=0;for(d=f.length;b<d;b++)c=f[b],a+="<option data-studentId='"+c.id+"'>"+c.get("name")+"</option>";return this.$el.html(a+"</select>")}return this.$el.html("<img src='images/loading.gif' class='loading'>")};
return a}(Backbone.View);var Resultd;
Resultd=Backbone.View.extend({id:"graph",events:{"click .back":"back"},initialize:function(b){return this.data=b},render:function(){this.$el.append("<button class='back navigation'>Back</button><div id='cg' style='width: 100%;min-height:650px'></div>");return this.trigger("rendered")},close:function(){this.remove();return this.unbind()},afterRender:function(){var b;b=this.data;return $("#cg").dxChart({dataSource:b,commonSeriesSettings:{argumentField:"state",type:"bar",hoverMode:"allArgumentPoints",selectionMode:"allArgumentPoints",
label:{connector:{visible:!0},showForZeroValues:!0,visible:!0}},valueAxis:{title:"Percentages Result"},series:[{valueField:"correct",name:"correct"}],title:"Percentage Result Report",legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},pointClick:function(a){return this.select()},commonAxisSettings:{label:{font:{color:"black",size:15},overlappingBehavior:{mode:"rotate",rotationAngle:80}}}})},back:function(){Tangerine.router.navigate("",!0);return!1}});var ProgressView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ProgressView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){var c,b,d,f,g;this.results=a.results;this.student=a.student;this.klass=a.klass;this.resultsByPart=[];a={};g=this.results.models;d=0;for(f=g.length;d<f;d++)b=g[d],a[b.get("resultBucket")]=!0,c=b.get("part"),null==this.resultsByPart[c]&&(this.resultsByPart[c]=[]),this.resultsByPart[c].push(b),this.resultsByPart[c].sort(function(a,c){return a.attributes.reportType<
c.attributes.reportType});a=_.keys(a);return this.currentPart=Math.round(((new Date).getTime()-this.klass.get("startDate"))/6048E5)};a.prototype.render=function(){var a,c,b,d,f,g,k,l,m,q,n,p,r;f="      <h1>Progress table</h1>      <h2>"+this.student.get("name")+"</h2>      <table class='mastery_check'>    ";c=g=1;for(n=this.currentPart;1<=n?g<=n:g>=n;c=1<=n?++g:--g)if(void 0!==this.resultsByPart[c])for(f+="<tr>",f+="<td>Week</td><td>"+c+"</td>",p=this.resultsByPart[c],k=0,m=p.length;k<m;k++){b=p[k];
c=b.attributes.resultBucket.titleize();d=0;r=b.attributes.subtestData.items;l=0;for(q=r.length;l<q;l++)a=r[l],"correct"===a.itemResult&&d++;a=b.attributes.subtestData.attempted;b=b.attributes.subtestData.time_remain;b=Math.round(d/(60-b)*60);f+="<td>"+c+" correct</td><td>"+d+"/"+a+"</td>";f+="<td>"+c+" per minute</td><td>"+b+"</td>"}this.$el.html(f+"</table>");return this.trigger("rendered")};return a}(Backbone.View);var ProgressMenuView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ProgressMenuView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"change .student_selector":"gotoProgressTable"};a.prototype.gotoProgressTable=function(a){return Tangerine.router.navigate("report/progress/"+this.$el.find(a.target).find(":selected").attr("data-studentId"),!0)};a.prototype.initialize=function(a){var c=this;this.parent=a.parent;this.klass=this.parent.options.klass;this.curricula=this.parent.options.curricula;return(new Students).fetch({success:function(a){c.students=
a.where({klassId:c.klass.id});c.ready=!0;return c.render()}})};a.prototype.render=function(){var a,c,b,d,f;if(this.ready){a="        <select class='student_selector'>          <option disabled='disabled' selected='selected'>"+t("select a student")+"</option>          ";f=this.students;b=0;for(d=f.length;b<d;b++)c=f[b],a+="<option data-studentId='"+c.id+"'>"+c.get("name")+"</option>";return this.$el.html(a+"</select>")}return this.$el.html("<img src='images/loading.gif' class='loading'>")};return a}(Backbone.View);var Collections,collections,results;Collections=Backbone.Collection.extend();collections=new Collections;results=new Results;results.fetch({success:function(b){var a;a={};b.each(function(b,c){return a[c]=b.get("subtestData")});return _.each(a,function(a,c){var b,d,f;f="";d=b=0;_.each(a,function(a){"location"===a.prototype&&(f=a.data.location.join());if("survey"===a.prototype)return a=a.data,"1"===a[Object.keys(a)[0]]?b++:d++});return collections.add({state:f,correct:b,incorrect:d})})}});Tangerine.ReportWarnings={KlassToDateView:function(b){var a,e,c,h;c=[];h=b.percentages;for(a in h)e=h[a],b="",this.nUnderX(0.2,0.75,e)&&(b+="<p>More than 20% of students got less than 75% on the "+a+" assessment. Re-teach the "+a+" component of the lesson during the next lesson.</p>"),c.push({html:b});return c},StudentToDateView:function(b){var a,e,c,h,d;h=[];d=b.percentages;for(a in d)c=d[a],e="",0.75>_.flatten(c)/100&&(e+="<p>"+b.studentName+" got less than 75% on the "+a+" assessment. Re-teach the "+
a+" component from applicable lessons during the next lesson.</p>"),h.push({html:e});return h},nUnderX:function(b,a,e){var c,h,d,f,g;f=h=d=0;for(g=e.length;f<g;f++)c=e[f],h++,c/100<a&&d++;return d/h>b}};var Curriculum,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};Curriculum=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="curriculum";return a}(Backbone.Model);var CurriculumView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CurriculumView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .back":"goBack"};a.prototype.goBack=function(){return history.back()};a.prototype.initialize=function(a){};a.prototype.render=function(){this.$el.html("    <button class='navigation back'>"+t("back")+"</button>    <h1>"+this.options.curriculum.get("name")+"</h1>        <div class='label_value'>      <label>"+t("total subtests")+"</label><br>      <div class='info_box'>"+
this.options.subtests.length+"</div>    </div>        <div class='label_value'>      <label>"+t("total assessments")+"</label><br>      <div class='info_box'>"+this.options.parts+"</div>    </div>    <div class='label_value'>      <label>"+t("download key")+"</label><br>      <div class='info_box'>"+this.options.curriculum.id.substr(-5,5)+"</div>    </div>    </table>");return this.trigger("rendered")};return a}(Backbone.View);var Curricula,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};Curricula=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="curriculum";a.prototype.model=Curriculum;return a}(Backbone.Collection);var CurriculaView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CurriculaView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .import":"gotoImport","click .back":"goBack"};a.prototype.goBack=function(){return history.back()};a.prototype.gotoImport=function(){return Tangerine.router.navigate("curriculum/import",!0)};a.prototype.initialize=function(a){this.subView=new CurriculaListView({curricula:a.curricula});this.subView.on("render",this.render);return this.subView.render()};a.prototype.render=
function(){this.$el.html("    <button class='back navigation'>"+t("back")+"</button>    <h2>"+t("loaded curricula")+"</h2>    <button class='command import'>"+t("import")+"</button>    <br>    <div id='klass_list'></div>    ");this.$el.find("#klass_list").append(this.subView.el);return this.trigger("rendered")};return a}(Backbone.View);var CurriculaListView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CurriculaListView=function(b){function a(){this.render=__bind(this.render,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="ul";a.prototype.initialize=function(a){var c;this.views=[];this.curricula=a.curricula;return"function"===typeof(c=this.curricula).on?c.on("all",this.render):void 0};a.prototype.render=function(){var a=this;this.closeViews;this.curricula.each(function(c){c=new CurriculumListElementView({curriculum:c});c.render();a.$el.append(c.el);
return a.views.push(c)});return this.trigger("rendered")};a.prototype.onClose=function(){return this.closeViews()};a.prototype.closeViews=function(){var a,c,b,d,f;d=this.views;f=[];c=0;for(b=d.length;c<b;c++)a=d[c],f.push("function"===typeof a.close?a.close():void 0);return f};return a}(Backbone.View);var CurriculumListElementView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CurriculumListElementView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="li";a.prototype.events={"click div":"gotoDetails"};a.prototype.gotoDetails=function(){return Tangerine.router.navigate("curriculum/"+this.curriculum.id,!0)};a.prototype.initialize=function(a){this.curriculum=a.curriculum;this.subtests=a.subtests;return window.te=this.$el};a.prototype.render=function(){var a;a=this.curriculum.escape("name");this.$el.html("<div><span class='icon_ryte'> </span> "+
a+"</div>");return this.trigger("rendered")};return a}(Backbone.View);__hasProp={}.hasOwnProperty;__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CurriculaView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .import":"gotoImport","click .back":"goBack"};a.prototype.goBack=function(){return history.back()};a.prototype.gotoImport=function(){return Tangerine.router.navigate("curriculum/import",!0)};a.prototype.initialize=function(a){this.subView=new CurriculaListView({curricula:a.curricula});this.subView.on("render",this.render);return this.subView.render()};a.prototype.render=
function(){this.$el.html("    <button class='back navigation'>"+t("back")+"</button>    <h2>"+t("loaded curricula")+"</h2>    <button class='command import'>"+t("import")+"</button>    <br>    <div id='klass_list'></div>    ");this.$el.find("#klass_list").append(this.subView.el);return this.trigger("rendered")};return a}(Backbone.View);var CurriculumImportView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
CurriculumImportView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .import":"import","click .back":"back"};a.prototype.back=function(){Tangerine.router.navigate("",!0);return!1};a.prototype["import"]=function(){var a,c=this;a=this.$el.find("#d_key").val();this.$el.find(".status").fadeIn(250);this.$el.find("#progress").html("Looking for "+a);$.couch.replicate(Tangerine.config.address.cloud.host+":"+Tangerine.config.address.port+
"/"+Tangerine.config.address.cloud.dbName,Tangerine.config.address.local.dbName,{success:function(b,d){c.$el.find("#progress").html("Import successful <h3>Imported</h3>");return $.couch.db("tangerine").view(Tangerine.config.address.designDoc+"/byDKey",{keys:[a],success:function(a){var b,e,d,h;e=0;h=a.rows;a=0;for(d=h.length;a<d;a++)b=h[a],b=b.value,"subtest"===b.collection&&e++;return c.$el.find("#progress").append("              <div>"+assessmentName+"</div>              <div>Subtests - "+e+"</div>            ")},
error:function(a,c,b){return this.$el.find("#progress").html("<div>Error after data imported</div><div>"+a+"</div><div>"+c)}})},error:function(a,b){return c.$el.find("#progress").html("<div>Import error</div><div>"+a+"</div><div>"+b)}},{filter:Tangerine.config.address.designDoc+"/importFilter",create_target:!0,query_params:{downloadKey:a}});return!1};a.prototype.render=function(){this.$el.html("    <button class='back navigation'>Back</button>    <h1>Import Curriculum</h1>    <div class='question'>      <label for='d_key'>Download key</label>      <input id='d_key' value=''>      <button class='import command'>Import</button>    </div>    <div class='confirmation status'>      <h2>Status<h2>      <div class='info_box' id='progress'></div>    </div>    ");
return this.trigger("rendered")};return a}(Backbone.View);var Student,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};Student=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="student";a.prototype.defaults={gender:"Not entered",age:"Not entered",name:"Not entered",klassId:null};a.prototype.initialize=function(){};return a}(Backbone.Model);var Students,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};Students=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.model=Student;a.prototype.url="student";return a}(Backbone.Collection);var StudentListElementView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
StudentListElementView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.tagName="li";a.prototype.className="student_list_element";a.prototype.events={"click .results":"results","click .edit":"edit","click .remove":"toggleRemove","click .remove_cancel":"toggleRemove","click .remove_delete":"removeStudent"};a.prototype.initialize=function(a){this.student=a.student;return this.students=a.students};a.prototype.results=function(){return Tangerine.router.navigate("report/studentToDate/"+
this.student.id,!0)};a.prototype.edit=function(){return Tangerine.router.navigate("class/student/"+this.student.id,!0)};a.prototype.toggleRemove=function(){return this.$el.find(".remove_confirm, .remove").toggle()};a.prototype.removeStudent=function(){this.student.set({klassId:null}).save();return this.students.remove(this.student)};a.prototype.render=function(){this.$el.html("      "+this.student.get("name")+"      "+this.student.get("gender")+"      "+this.student.get("age")+"      <img src='images/icon_results.png' class='results' title='Results'>      <img src='images/icon_edit.png' class='edit' title='Edit'>      <img src='images/icon_delete.png' class='remove' title='Remove'>      <div class='remove_confirm confirmation'>        <div class='menu_box'>          "+
t("remove student")+"<br>          <button class='remove_delete command_red'>"+t("remove")+"</button>          <button class='remove_cancel command'>"+t("cancel")+"</button>        </div>      </div>    ");return this.trigger("rendered")};return a}(Backbone.View);var StudentEditView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
StudentEditView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .done":"done","click .back":"back"};a.prototype.initialize=function(a){this.student=a.student;return this.klasses=a.klasses};a.prototype.done=function(){var a;a=this.$el.find("#klass_select option:selected").attr("data-id");"null"===a&&(a=null);this.student.set({name:this.$el.find("#name").val(),gender:this.$el.find("#gender").val(),age:this.$el.find("#age").val(),
klassId:a});this.student.save();return this.back()};a.prototype.back=function(){return window.history.back()};a.prototype.render=function(){var a,c,b,d,f,g;d=this.student.get("name")||"";c=this.student.get("gender")||"";a=this.student.get("age")||"";b=this.student.get("klassId");a="    <h1>"+t("edit student")+"</h1>    <button class='back navigation'>"+t("back")+"</button><br>    <div class='info_box'>      <div class='label_value'>        <label for='name'>"+t("name")+"</label>        <input id='name' value='"+
d+"'>      </div>      <div class='label_value'>        <label for='gender'>"+t("gender")+"</label>        <input id='gender' value='"+c+"'>      </div>      <div class='label_value'>        <label for='age'>"+t("age")+"</label>        <input id='age' value='"+a+"'>      </div>      <div class='label_value'>        <label for='klass_select'>"+t("class")+"</label>        <select id='klass_select'>";a+="<option data-id='null' "+(null===b?"selected='selected'":void 0)+">"+t("none")+"</option>";g=this.klasses.models;
d=0;for(f=g.length;d<f;d++)c=g[d],a+="<option data-id='"+c.id+"' "+(c.id===b?"selected='selected'":void 0)+">"+c.get("year")+" - "+c.get("grade")+" - "+c.get("stream")+"</option>";a+="        </select>      </div>      <button class='done command'>"+t("done")+"</button>    </div>    ";this.$el.html(a);return this.trigger("rendered")};return a}(Backbone.View);var User,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b},__indexOf=[].indexOf||function(b){for(var a=0,e=this.length;a<e;a++)if(a in this&&this[a]===b)return a;return-1};
User=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="user";a.prototype["default"]={name:null,roles:[],groups:["default"]};a.prototype.initialize=function(a){this.name=this["default"].name;this.roles=this["default"].roles;this.messages=[];return this.temp={}};a.prototype.signup=function(a,c){var b=this;return $.couch.signup({name:a},c,{success:function(a,c,e){"login"===b.temp.intent?(b.temp.intent="retry_login",b.login(b.temp.name,
b.temp.pass)):b.addMessage("New user "+temp.name+" created. Welcome to Tangerine.");b.unset("messages");return b.save()},error:function(a,c,e){return null!=b.temp.intent&&"login"===b.temp.intent?b.showMessage("Password incorrect, please try again."):b.showMessage("Error username "+b.temp.name+" already taken. Please try another name.")}})};a.prototype.login=function(a,c){var b=this;this.temp={name:a,pass:c};return $.couch.login({name:this.temp.name,password:this.temp.pass,success:function(a){b.name=
b.temp.name;b.roles=a.roles;return b.fetch({success:function(a){b.clearAttempt();return b.trigger("change:authentication")}})},error:function(a,c,e){b.name=b["default"].name;b.roles=b["default"].roles;if(null!=b.temp.intent&&"retry_login"===b.temp.intent)return b.addMessage(e);b.temp.intent="login";return b.signup(b.temp.name,b.temp.pass)}})};a.prototype.verify=function(a){if(null===this.name)return null!=(null!=a?a.isUnregistered:void 0)?a.isUnregistered():Tangerine.router.navigate("login",!0);null!=
a&&"function"===typeof a.isRegistered&&a.isRegistered();return this.isAdmin()?null!=a?"function"===typeof a.isAdmin?a.isAdmin():void 0:void 0:null!=a?"function"===typeof a.isUser?a.isUser():void 0:void 0};a.prototype.fetch=function(b){var c=this;null==b&&(b={});return $.couch.session({success:function(h){var d,f,g;if(null!==h.userCtx.name){c.id="tangerine.user:"+h.userCtx.name;c.name=h.userCtx.name;c.roles=[];g=h.userCtx.roles;d=0;for(f=g.length;d<f;d++)h=g[d],~h.indexOf("group.")||c.roles.push(h);
return a.__super__.fetch.call(c,{success:function(a,c,d){return"function"===typeof b.success?b.success():void 0},error:function(d,f,g){c.unset("messages");c.save({_id:c.id,groups:[]},{wait:!0});return a.__super__.fetch.call(c,{success:function(){return"function"===typeof b.success?b.success():void 0},error:function(){return location.reload()}})}})}"function"===typeof b.success&&b.success();return c.logout()},error:function(a,b,c){this.trigger("change:authentication");throw""+a+" Session Error\n"+
b+"\n"+c;}})};a.prototype.isAdmin=function(){return 0<=__indexOf.call(this.roles,"_admin")};a.prototype.logout=function(){var a=this;return $.couch.logout({success:function(){$.cookie("AuthSession",null);a.name=a["default"].name;a.roles=a["default"].roles;a.clear();a.trigger("change:authentication");return Tangerine.router.navigate("login",!0)}})};a.prototype.clearAttempt=function(){return this.temp=this["default"].temp};a.prototype.joinGroup=function(a){var b;b=this.get("groups");if(!~b.indexOf(a))return b.push(a),
this.unset("messages"),this.save({groups:b})};a.prototype.leaveGroup=function(a){var b;b=this.get("groups");if(~b.indexOf(a))return b=_.without(b,a),this.save({groups:b})};a.prototype.addMessage=function(a){return this.set("messages",this.get("messages").push(a))};a.prototype.showMessage=function(a){return this.set("messages",[a])};a.prototype.clearMessages=function(a){return this.set("messages",[])};return a}(Backbone.Model);var LoginView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
LoginView=function(b){function a(){this.renderMessages=__bind(this.renderMessages,this);this.render=__bind(this.render,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="login_view";a.prototype.events={"click button.login":"login","keypress input":"keyHandler"};a.prototype.initialize=function(a){this.model=Tangerine.user;this.model.on("change:messages",this.renderMessages);return this.model.on("change:authentication",this.goOn)};a.prototype.goOn=
function(){return Tangerine.router.navigate("",!0)};a.prototype.render=function(){var a,b;b=$("#content").width();a=$("#content").offsetParent().width();this.oldWidth=100*b/a;$("#content").css("width","100%");this.$el.html("      <img src='images/tangerine_logo.png' id='login_logo'>      <div class='messages'></div>      <label for='login_username'>"+t("enumerator name")+"</label>      <input id='login_username' name='login_username'>      <label for='login_password'>"+t("password")+"</label>      <input id='login_password' name='login_username' type='password'>      <button class='login'>"+
t("login")+"</button>    ");return this.trigger("rendered")};a.prototype.onClose=function(){return $("#content").css("width",this.oldWidth+"%")};a.prototype.keyHandler=function(a){if(a.which)return 13!==a.which?!0:this.login()};a.prototype.login=function(a){a=Utils.getValues(this.el);return""===a.login_password?(this.model.showMessage("Please enter a password"),this.$el.find("#login_password").focus(),!1):this.model.login(a.login_username,a.login_password)};a.prototype.renderMessages=function(){var a,
b,h,d,f;h=this.model.get("messages")||[];a="<ul>";d=0;for(f=h.length;d<f;d++)b=h[d],a+="<li>"+b+"</li>";a+="</ul>";return this.$el.find(".messages").html(a)};return a}(Backbone.View);var AccountView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
AccountView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .leave":"leaveGroup","click .join_cancel":"joinToggle","click .join":"joinToggle","click .join_group":"join","click .config":"config","click .back":"goBack","click #mode_buttons input":"changeMode"};a.prototype.changeMode=function(a){return(new Settings({_id:"TangerineSettings"})).fetch({success:function(b){b.set({context:$(a.target).val()});return b.save()}})};
a.prototype.goBack=function(){return window.history.back()};a.prototype.joinToggle=function(){this.$el.find(".join, .join_confirmation").fadeToggle(0);return this.$el.find("#group_name").val("")};a.prototype.join=function(){var a;a=this.$el.find("#group_name").val().replace(/\s|-/g,"_").replace(/[^a-zA-Z0-9_'"]/g,"");if(0!==a.length)return this.user.joinGroup(a),this.joinToggle(),this.render()};a.prototype.leaveGroup=function(a){a=$(a.target).parent().attr("data-group");this.user.leaveGroup(a);return this.render()};
a.prototype.initialize=function(a){this.user=a.user;this.role=this.user.roles.join();return"_admin"===this.role?this.visible="block":this.visible="none"};a.prototype.render=function(){var a,b,h,d,f;this.config="";b="      <button class='back navigation'>Back</button>      <div style='display:"+this.visible+"'>        <h1>Server Configuration</h1>        <p><strong>Current Server is : "+Tangerine.config.address.cloud.host+"</strong> </p>        <select class='serverurl space15'>          <option value='http://tangerine.iriscouch.com'>Tangerine Server</option>          <option value='http://m.teletaaleem.com'>Teletaleem Server</option>        </select><button class='config navigation' >Update Server</button>      </div>      <div class='groupdiv'>      <h1>Account</h1>      <div class='label_value'>        <label>Name</label>        <p>"+
this.user.name+"</p>      </div>      <div class='label_value menu_box'>        <label>Groups</label>        <ul>    ";f=this.user.get("groups")||[];h=0;for(d=f.length;h<d;h++)a=f[h],b+="<li data-group='"+_.escape(a)+"'>"+a+" <button class='command leave'>Leave</button></li>";this.$el.html(b+"        </ul>        <button class='command join'>Join or create a group</button>        <div class='confirmation join_confirmation'>          <input id='group_name' placeholder='Group name'>          <small>Please be specific.<br>          Good examples: MalawiJun2012, MikeTestGroup2012, EGRAGroup2012<br>          Bad examples: group, test, mine</small><br>          <button class='command join_group'>Join Group</button>          <button class='command join_cancel'>Cancel</button>        </div>      </div><br>      \x3c!--button class='command confirmation'>Report a bug</button>      <div class='confirmation' id='bug'>        <label for='where'>What broke?        <input id='where' placeholder='where'>        <label for='where'>What happened?        <input id='where' placeholder='what'>        <label for='where'>What should have happened?        <input id='should' placeholder='should'>        <button>Send</button>      </div--\x3e      </div>      ");
return this.trigger("rendered")};a.prototype.config=function(){var a=this;if(null!=$(".serverurl").val()&&""!==$(".serverurl").val())return Tangerine.config.address.cloud.host=$(".serverurl").val(),Tangerine.$db.saveDoc(Tangerine.config,{success:function(b){return a.render()}})};return a}(Backbone.View);var GroupsView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
GroupsView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.events={"click .account":"gotoAccount","click .goto":"gotoGroup"};a.prototype.gotoAccount=function(){return Tangerine.router.navigate("account",!0)};a.prototype.gotoGroup=function(a){a=$(a.target).attr("data-group");return Tangerine.router.navigate("assessments/"+a,!0)};a.prototype.render=function(){var a,b,h,d,f;b=Tangerine.user.get("groups");h="      <button class='account navigation'>Account</button>      <h1>Groups</h1>    ";
if(0===b.length)h+="You are not yet a member of a group. Go to Account to join a group.";else for(a=d=0,f=b.length;d<f;a=++d)a=b[a],h+="<button class='command goto' data-group='"+_.escape(a)+"'>"+a+"</button>";this.$el.html(h);return this.trigger("rendered")};return a}(Backbone.View);var ErrorView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ErrorView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.message=a.message;return this.details=a.details};a.prototype.render=function(){this.$el.html("    <h2>Oops</h2>    <p>"+this.message+"</p>    <p>Sorry about that.</p>    <p>"+this.details+"</p>    ");return this.trigger("rendered")};return a}(Backbone.View);var AssessmentPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
AssessmentPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){var b=this;this.abortAssessment=!1;this.index=0;this.model=a.model;Tangerine.activity="assessment print";this.subtestViews=[];this.model.subtests.sort();return this.model.subtests.each(function(a){return b.subtestViews.push(new SubtestPrintView({model:a,parent:b}))})};a.prototype.render=function(){var a=this;0===this.model.subtests.length?this.$el.append("<h1>Oops...</h1><p>This assessment is blank. Perhaps you meant to add some subtests.</p>"):
_.each(this.subtestViews,function(b){b.render();return a.$el.append(b.el)});return this.trigger("rendered")};return a}(Backbone.View);var QuestionPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
QuestionPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="question buttonset";a.prototype.initialize=function(a){this.model=a.model;this.answer={};this.name=this.model.escape("name").replace(/[^A-Za-z0-9_]/g,"-");this.type=this.model.get("type");this.options=this.model.get("options");this.notAsked=a.notAsked;this.isObservation=a.isObservation;"true"===this.model.get("skippable")||!0===this.model.get("skippable")?this.skipped=
this.isValid=!0:this.skipped=this.isValid=!1;if(!0===this.notAsked)return this.isValid=!0,this.updateResult()};a.prototype.update=function(a){this.updateResult();this.updateValidity();return this.trigger("answer",a,this.model.get("order"))};a.prototype.render=function(){this.$el.attr("id","question-"+this.name);this.notAsked?this.$el.hide():this.$el.html("        Prompt: "+this.model.get("prompt")+"<br/>        Variable Name: "+this.model.get("name")+"<br/>        Hint: "+this.model.get("hint")+"<br/>        Type: "+
this.model.get("type")+"<br/>        Options:<br/>        "+_.map(this.model.get("options"),function(a){return"Label: "+a.label+", Value: "+a.value}).join("<br/>")+"<br/>      ");return this.trigger("rendered")};return a}(Backbone.View);var GridPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
GridPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.model=this.options.model;return this.parent=this.options.parent};a.prototype.className="grid_prototype";a.prototype.render=function(){var a,b=this;a="autostop    captureAfterSeconds    captureItemAtTime    columns    endOfLine    fontSize    layoutMode    order    randomize    timer    variableName".split(/\ +/);this.$el.html("      Properties:<br/>      <table>      "+
_.map(a,function(a){return"<tr><td>"+a+"</td><td>"+b.model.get(a)+"</td></tr>"}).join("")+"      </table>      Items:<br/>      "+_.map(this.model.get("items"),function(a){return a}).join(", ")+"    ");return this.trigger("rendered")};return a}(Backbone.View);var ConsentPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ConsentPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.confirmedNonConsent=!1;this.model=this.options.model;return this.parent=this.options.parent};a.prototype.render=function(){this.$el.html("    <form>      <div class='question'>        <label>"+(this.model.get("prompt")||"Does the child consent?")+"</label>        <div class='messages'></div>        <div class='non_consent_form confirmation'>          <div>Click to confirm consent not obtained.</div>          <button id='non_consent_confirm'>Confirm</button>        </div>        <div id='consent_options' class='buttonset'>          <label for='consent_yes'>Yes, continue</label>          <input id='consent_yes' type='radio' name='participant_consents' value='yes'>          <label for='consent_no'>No, stop</label>          <input id='consent_no' type='radio' name='participant_consents' value='no'>        </div>      </div>    </form>    ");
return this.trigger("rendered")};return a}(Backbone.View);var DatetimePrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
DatetimePrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="datetime";a.prototype.initialize=function(a){this.model=this.options.model;return this.parent=this.options.parent};a.prototype.render=function(){this.$el.html("        DateTime      ");return this.trigger("rendered")};return a}(Backbone.View);var IdPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};IdPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.className="id";a.prototype.initialize=function(a){};a.prototype.render=function(){this.$el.html("      ID    ");return this.trigger("rendered")};return a}(Backbone.View);var LocationPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
LocationPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.model=this.options.model;this.parent=this.options.parent;this.levels=this.model.get("levels")||[];this.locations=this.model.get("locations")||[];1===this.levels.length&&""===this.levels[0]&&(this.levels=[]);if(1===this.locations.length&&""===this.locations[0])return this.locations=[]};a.prototype.render=function(){this.$el.html("      School Locations<br/>      Levels: "+
this.levels+"<br/>      Available Locations:<br/>      "+this.locations.join("<br/>")+"<br/>    ");return this.trigger("rendered")};return a}(Backbone.View);var SurveyPrintView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SurveyPrintView=function(b){function a(){this.onQuestionRendered=__bind(this.onQuestionRendered,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){var b=this;this.model=this.options.model;this.parent=this.options.parent;this.isObservation=this.options.isObservation;this.questionViews=[];this.answered=[];this.questions=new Questions;return this.questions.fetch({key:this.model.get("assessmentId"),success:function(a){b.questions=new Questions(b.questions.where({subtestId:b.model.id}));
b.questions.sort();return b.render()}})};a.prototype.render=function(){var a,b,h,d,f,g;this.questions.sort();if(null!=this.questions.models)for(g=this.questions.models,a=d=0,f=g.length;d<f;a=++d)b=g[a],b=new QuestionPrintView({model:b,parent:this,isObservation:this.isObservation}),b.on("rendered",this.onQuestionRendered),b.render(),this.questionViews[a]=b,this.$el.append(b.el);0===this.questions.length&&"function"===typeof(h=this.parent).next&&h.next();return this.trigger("rendered")};a.prototype.onQuestionRendered=
function(){return this.trigger("subRendered")};return a}(Backbone.View);var ObservationPrintView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ObservationPrintView=function(b){function a(){this.saveCurrentSurvey=__bind(this.saveCurrentSurvey,this);this.updateObservationIndex=__bind(this.updateObservationIndex,this);this.checkSurveyDisplay=__bind(this.checkSurveyDisplay,this);this.checkIfOver=__bind(this.checkIfOver,this);this.checkWarning=__bind(this.checkWarning,this);this.checkObservationPace=__bind(this.checkObservationPace,this);this.tick=__bind(this.tick,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);
a.prototype.events={"click .start_time":"startObservations","click .stop_time":"stopObservations","click .done":"completeObservation"};a.prototype.initialize=function(a){this.model=this.options.model;return this.parent=this.options.parent};a.prototype.initializeSurvey=function(){var a;if(null!=this.survey)this.onClose();a=$.extend(this.model.get("surveyAttributes"),{_id:this.model.id});var b,h,d;d=[];b=1;for(h=parseInt(this.model.get("totalSeconds")/this.model.get("intervalLength"));1<=h?b<=h:b>=
h;1<=h?++b:--b)d.push(new Backbone.Model(a));d.unshift("");this.skippableView=new SurveyRunView({model:d[1],parent:this,isObservation:!0});return this.survey={models:d,results:[]}};a.prototype.initializeFlags=function(){this.iAm={counting:!1,recording:!1};this.iHavent={warned:!0};this.iHave={runOnce:!1,finished:!1};return this.my={time:{start:0,elapsed:0},observation:{index:0,oldIndex:0,completed:0,total:parseInt(this.model.get("totalSeconds")/this.model.get("intervalLength"))}}};a.prototype.startObservations=
function(){if(!this.iAm.counting&&!this.iHave.runOnce)return this.$el.find(".stop_button_wrapper, .next_display, .completed_display").removeClass("confirmation"),this.$el.find(".start_button_wrapper").addClass("confirmation"),this.timerInterval=setInterval(this.tick,1E3),this.iAm.counting=!0,this.my.time.start=this.getTime(),this.my.time.elapsed=0};a.prototype.stopObservations=function(a){var b;clearInterval(this.timerInterval);b=null==a;null!=a&&this.trigger("showNext");b&&!this.iHave.finished?(this.iAm.recording&&
(this.resetObservationFlags(),this.saveCurrentSurvey()),this.my.observation.index++,this.renderSurvey()):(this.$el.find(".stop_button_wrapper").addClass("confirmation"),Utils.midAlert("Observations finished"));this.$el.find(".next_display").addClass("confirmation");this.iHave.finished=!0;return this.iHave.runOnce=!0};a.prototype.tick=function(){this.my.time.elapsed=this.getTime()-this.my.time.start;this.checkIfOver();this.updateObservationIndex();this.updateProgressDisplay();this.checkSurveyDisplay();
this.checkObservationPace();return this.checkWarning()};a.prototype.checkObservationPace=function(){if(this.iAm.recording&&this.my.observation.completed<this.my.observation.index-1&&0!==this.my.observation.index)return this.iHave.forcedProgression=!0,this.resetObservationFlags(),this.saveCurrentSurvey(),this.renderSurvey()};a.prototype.checkWarning=function(){var a;a=Math.floor((this.my.time.elapsed+this.warningSeconds)/this.model.get("intervalLength"));a=this.my.observation.index<a&&!this.iHave.finished;
if(this.iAm.recording&&this.iHavent.warned&&a&&0!==this.my.observation.index)return Utils.midAlert("Observation ending soon"),this.iHavent.warned=!1};a.prototype.gridWasAutostopped=function(){return!1};a.prototype.checkIfOver=function(){if(this.my.time.elapsed>=this.model.get("totalSeconds"))return this.stopObservations()};a.prototype.checkSurveyDisplay=function(){if(this.my.observation.oldIndex!==this.my.observation.index&&!this.iHave.finished&&!this.iAm.recording)return this.renderSurvey(),this.my.observation.oldIndex=
this.my.observation.index};a.prototype.updateObservationIndex=function(){this.my.observation.index=Math.floor(this.my.time.elapsed/this.model.get("intervalLength"));if(this.my.observation.index>this.survey.models.length-1)return this.my.observation.index=this.survey.models.length-1};a.prototype.updateProgressDisplay=function(){var a;this.$el.find(".current_observation").html(this.my.observation.index);this.$el.find(".completed_count").html(this.my.observation.completed);a=Math.max((this.my.observation.index+
1)*this.model.get("intervalLength")-this.my.time.elapsed,0);this.$el.find(".time_till_next").html(a);if(!this.iAm.recording&&!this.iHave.finished)return this.$el.find(".next_display, .completed_display").removeClass("confirmation")};a.prototype.resetObservationFlags=function(){this.iAm.recording=!1;return this.iHavent.warned=!0};a.prototype.getTime=function(){return parseInt((new Date).getTime()/1E3)};a.prototype.completeObservation=function(a){this.survey.view.isValid()?(this.saveCurrentSurvey(),
this.iHave.finished&&this.trigger("showNext")):this.survey.view.showErrors();return this.tick()};a.prototype.saveCurrentSurvey=function(){this.resetObservationFlags();this.my.observation.completed++;this.survey.results.push({observationNumber:this.survey.view.index,data:this.survey.view.getResult(),saveTime:this.my.time.elapsed});this.survey.view.close();return this.$el.find(".done").remove()};a.prototype.render=function(){this.trigger("hideNext");this.model.get("totalSeconds");this.$el.html("      <div class='timer_wrapper'>        <div class='progress clearfix'>          <span class='completed_display confirmation'>Completed <div class='info_box completed_count'>"+
this.my.observation.completed+"</div></span>          <span class='next_display confirmation'>Next observation <div class='info_box time_till_next'>"+this.model.get("intervalLength")+"</div></span>        </div>        <div>          <div class='start_button_wrapper'><button class='start_time command'>Start</button></div>          <div class='stop_button_wrapper confirmation'><button class='stop_time command'>Abort <i>all</i> observations</button></div>        </div>      </div>      <div id='current_survey'></div>    ");
return this.trigger("rendered")};a.prototype.renderSurvey=function(a){var b=this;if(this.iAm.counting)return this.iAm.recording=!0,this.survey.view=new SurveyRunView({model:this.survey.models[this.my.observation.index],parent:this,isObservation:!0}),this.survey.view.index=b.my.observation.index,this.survey.view.on("rendered subRendered",function(){return b.trigger("subRendered")}),this.survey.view.render(),this.$el.find("#current_survey").html("<span class='observation_display confirmation'>Observation <div class='info_box current_observation'>"+
this.my.observation.index+"</div></span>"),this.$el.find("#current_survey").append(this.survey.view.el),this.$el.find("#current_survey").append("<button class='command done'>Done with <i>this</i> observation</button>"),this.$el.find("#current_survey").scrollTo(250,function(){if(b.iHave.forcedProgression)return Utils.midAlert("Please continue with the next observation."),b.iHave.forcedProgression=!1;if(b.iHave.finished)return Utils.midAlert("Please enter last observation")})};a.prototype.onClose=function(){var a;
null!=(a=this.survey.view)&&a.close();return this.skippableView.close()};a.prototype.getResult=function(){return{surveys:this.survey.results,variableName:this.model.get("variableName"),totalTime:this.model.get("totalTime"),intervalLength:this.model.get("intervalTime"),completedObservations:this.my.observation.completed}};a.prototype.getSum=function(){return{total:this.my.observation.completed}};a.prototype.getSkipped=function(){var a,b,h,d,f;h=this.skippableView.getSkipped();b=[];a=d=1;for(f=this.survey.models.length-
1;1<=f?d<=f:d>=f;a=1<=f?++d:--d)b.push({observationNumber:a,data:h,saveTime:"skipped"});return{surveys:b,variableName:"skipped",totalTime:"skipped",intervalLength:"skipped",completedObservations:"skipped"}};a.prototype.isValid=function(){return this.iHave.finished};a.prototype.showErrors=function(){return this.$el.find("messages").html(this.validator.getErrors().join(", "))};a.prototype.updateNavigation=function(){return Tangerine.nav.setStudent(this.$el.find("#participant_id").val())};return a}(Backbone.View);var SubtestPrintView,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
SubtestPrintView=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(a){this.protoViews=Tangerine.config.prototypeViews;this.model=a.model;this.parent=a.parent;return this.prototypeRendered=!1};a.prototype.render=function(){var a,b,h=this;a=""!==(this.model.get("enumeratorHelp")||"")?"<div class='enumerator_help_print'>"+this.model.get("enumeratorHelp")+"</div>":"";b=""!==(this.model.get("studentDialog")||"")?"<div class='student_dialog_print'>"+
this.model.get("studentDialog")+"</div>":"";!0===this.model.get("skippable")||this.model.get("skippable");this.$el.html("      <h2>"+this.model.get("name")+"</h2>      Enumerator Help:<br/>      "+a+"      Student Dialog:<br/>      "+b+"      <div id='prototype_wrapper'></div>      <hr/>    ");this.prototypeView=new (window[this.model.get("prototype").humanize()+"PrintView"])({model:this.model,parent:this});this.prototypeView.on("rendered",function(){return h.trigger("rendered")});this.prototypeView.on("subRendered",
function(){return h.trigger("subRendered")});this.prototypeView.on("showNext",function(){return h.showNext()});this.prototypeView.on("hideNext",function(){return h.hideNext()});this.prototypeView.setElement(this.$el.find("#prototype_wrapper"));this.prototypeView.render();this.prototypeRendered=!0;return this.trigger("rendered")};return a}(Backbone.View);var Log,LogView,Logs,_ref1,_ref2,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Log=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="log";a.prototype.defaults={type:"none",details:"none",timestamp:0,user:"no one"};a.prototype.initialize=function(a){this.set({type:a.type,details:a.details,timestamp:(new Date).getTime(),user:Tangerine.user.name});return this.save()};return a}(Backbone.Model);
Logs=function(b){function a(){return _ref1=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.url="log";a.prototype.model=Log;a.prototype.comparator=function(a){return a.get("timestamp")};return a}(Backbone.Collection);
LogView=function(b){function a(){return _ref2=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.initialize=function(){this.allLogs=new Logs;return this.allLogs.fetch({success:function(a){return this.logs=a.where({user:Tangerine.user.name})}})};a.prototype.render=function(){var a,b,h,d,f;a="<table><th><td>time</td><td>type</td><td>details</td></th>";f=this.logs;h=0;for(d=f.length;h<d;h++)b=f[h],a+="<tr><td>"+b.get("timestamp")+"</td><td>"+b.get("type")+"</td><td>"+b.get("details")+
"</td></tr>";this.$el.html(a+"</table>");return this.trigger("rendered")};return a}(Backbone.View);var ViewManager,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
ViewManager=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.show=function(a){var b,h=this;window.scrollTo(0,0);null!=(b=this.currentView)&&b.close();this.currentView=a;this.currentView.on("rendered",function(){var a;$("#content").append(h.currentView.el);h.currentView.$el.find(".buttonset").buttonset();return"function"===typeof(a=h.currentView).afterRender?a.afterRender():void 0});this.currentView.on("subRendered",function(){return h.currentView.$el.find(".buttonset").buttonset()});
this.currentView.on("start_work",function(){return $("#content").prepend("<div id='loading_bar'><img class='loading' src='images/loading.gif'></div>")});this.currentView.on("end_work",function(){return $("#loading_bar").remove()});return this.currentView.render()};return a}(Backbone.View);var NavigationView,__bind=function(b,a){return function(){return b.apply(a,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
NavigationView=function(b){function a(){this.handleMenu=__bind(this.handleMenu,this);this.initialize=__bind(this.initialize,this);return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.el="#navigation";a.prototype.events=Modernizr.touch?{"touchstart div#logout_link":"logout","touchstart button":"submenuHandler","touchstart #corner_logo":"logoClick","touchstart #enumerator":"enumeratorClick"}:{"click div#logout_link":"logout","click button":"submenuHandler","click #corner_logo":"logoClick",
"click #enumerator":"enumeratorClick"};a.prototype.enumeratorClick=function(){return Tangerine.router.navigate("account",!0)};a.prototype.logoClick=function(){if(this.user.isAdmin())return Tangerine.activity="",this.router.navigate("",!0);if("assessment run"===Tangerine.activity){if(confirm("Assessment not finished. Continue to main?"))return Tangerine.activity="",this.router.navigate("",!0)}else return this.router.navigate("",!0)};a.prototype.logout=function(){if(this.user.isAdmin())return Tangerine.activity=
"",this.router.navigate("logout",!0);if("assessment run"===Tangerine.activity){if(confirm("Assessment not finished. Continue to logout?"))return Tangerine.activity="",this.router.navigate("logout",!0)}else if(confirm("Are you sure you want to logout?"))return Tangerine.activity="",this.router.navigate("logout",!0)};a.prototype.onClose=function(){};a.prototype.initialize=function(a){this.render();this.user=a.user;this.router=a.router;this.router.on("all",this.handleMenu);return this.user.on("change:authentication",
this.handleMenu)};a.prototype.submenuHandler=function(a){var b;return"function"===typeof(b=vm.currentView).submenuHandler?b.submenuHandler(a):void 0};a.prototype.closeSubmenu=function(){return this.$el.find("main_nav").empty()};a.prototype.render=function(){var a;a=Tangerine.user.isAdmin()&&"server"!==Tangerine.settings.context?"<a href='#update'>"+t("update")+"</a>":"";this.$el.html("    <img id='corner_logo' src='images/corner_logo.png'>    <div id='logout_link'>"+t("logout")+"</div>    <div id='enumerator_box'>      "+
t("enumerator")+"      <div id='enumerator'>"+(Tangerine.user.name||"")+"</div>    </div>    <div id='current_student'>      Student ID      <div id='current_student_id'></div>    </div>    <div id='version'>    version <br/>    <span id='version-uuid'>"+Tangerine.version+"</span><br/>    "+a+"    </div>    ");$("body").ajaxStart(function(){return $("#corner_logo").attr("src","images/spin_orange.gif")});return $("body").ajaxStop(function(){return $("#corner_logo").attr("src","images/corner_logo.png")})};
a.prototype.setStudent=function(a){return""===a?(this.$el.find("#current_student_id").fadeOut(250,function(a){return $(a).html("")}),this.$el.find("#current_student").fadeOut(250)):this.$el.find("#current_student_id").html(a).parent().fadeIn(250)};a.prototype.handleMenu=function(a){var b=this;$("#enumerator").html(this.user.name);~window.location.toString().indexOf("name=")?this.$el.find("#logout_link").hide():this.$el.find("#logout_link").show();return this.user.verify({isRegistered:function(){b.render();
return $("#navigation").fadeIn(250)},isUnregistered:function(){b.render();return $("#navigation").fadeOut(250)}})};return a}(Backbone.View);var Router,__hasProp={}.hasOwnProperty,__extends=function(b,a){function e(){this.constructor=b}for(var c in a)__hasProp.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.__super__=a.prototype;return b};
Router=function(b){function a(){return _ref=a.__super__.constructor.apply(this,arguments)}__extends(a,b);a.prototype.routes={login:"login",register:"register",logout:"logout",account:"account",transfer:"transfer","class":"klass","class/edit/:id":"klassEdit","class/student/:studentId":"studentEdit","class/student/report/:studentId":"studentReport","class/:id/:part":"klassPartly","class/:id":"klassPartly","class/run/:studentId/:subtestId":"runSubtest","class/result/student/subtest/:studentId/:subtestId":"studentSubtest",
curricula:"curricula","curriculum/:id":"curriculum","curriculum/import":"curriculumImport",settings:"settings",update:"update","":"landing",groups:"groups",assessments:"assessments","assessments/:group":"assessments","run/:id":"run","chart/:id":"chart","print/:id":"print","resume/:assessmentId/:resultId":"resume","restart/:id":"restart","edit/:id":"edit","csv/:id":"csv","results/:name":"results","import":"import","subtest/:id":"editSubtest","question/:id":"editQuestion","report/partByStudent/:subtestId":"partByStudent",
"report/studentToDate/:studentId":"studentToDate","report/masteryCheck/:studentId":"masteryCheck","report/progress/:studentId":"progressReport","report/classToDate/:klassId":"klassToDate"};a.prototype.landing=function(){if("server"===Tangerine.settings.context)return Tangerine.router.navigate("groups",!0);if("mobile"===Tangerine.settings.context)return Tangerine.router.navigate("assessments",!0);if("class"===Tangerine.settings.context)return Tangerine.router.navigate("class",!0)};a.prototype.groups=
function(){return Tangerine.user.verify({isAdmin:function(){var a;a=Tangerine.user.get("groups");if(1===a.length&&""===window.location.hash)return Tangerine.router.navigate("assessments/"+a[0],!0);a=new GroupsView;return vm.show(a)},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.curricula=function(){return Tangerine.user.verify({isRegistered:function(){return(new Curricula).fetch({success:function(a){a=new CurriculaView({curricula:a});return vm.show(a)}})},
isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.curriculum=function(a){return Tangerine.user.verify({isRegistered:function(){var b;b=new Curriculum({_id:a});return b.fetch({success:function(){var h;h=new Subtests;return h.fetch({success:function(){var d,f;f=h.where({curriculumId:a});var g,k,l;l=[];g=0;for(k=f.length;g<k;g++)d=f[g],l.push(d.get("part"));d=Math.max.apply(Math,l);f=new CurriculumView({curriculum:b,subtests:f,parts:d});return vm.show(f)}})}})},isUnregistered:function(){return Tangerine.router.navigate("login",
!0)}})};a.prototype.curriculumImport=function(){return Tangerine.user.verify({isRegistered:function(){var a;a=new CurriculumImportView;return vm.show(a)},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.klass=function(){return Tangerine.user.verify({isRegistered:function(){return(new Klasses).fetch({success:function(a){return(new Curricula).fetch({success:function(b){b=new KlassesView({klasses:a,curricula:b});return vm.show(b)}})}})}})};a.prototype.klassEdit=
function(a){return Tangerine.user.verify({isRegistered:function(){return(new Klass({_id:a})).fetch({success:function(b){return(new Students).fetch({success:function(h){var d;d=new Students(h.where({klassId:a}));h=new KlassEditView({klass:b,students:d,allStudents:h});return vm.show(h)}})}})},isUnregistered:function(){return Tangerine.router.navigate("",!0)}})};a.prototype.klassPartly=function(a,b){null==b&&(b=null);return Tangerine.user.verify({isRegistered:function(){var h;h=new Klass({_id:a});return h.fetch({success:function(){var d;
d=new Curriculum({_id:h.get("curriculumId")});return d.fetch({success:function(){return(new Students).fetch({success:function(f){var g;g=new Students(f.where({klassId:a}));return(new KlassResults).fetch({success:function(f){var l;l=new KlassResults(f.where({klassId:a}));return(new Subtests).fetch({success:function(a){a=new Subtests(a.where({curriculumId:h.get("curriculumId")}));a=new KlassPartlyView({part:b,subtests:a,results:l,students:g,curriculum:d,klass:h});return vm.show(a)}})}})}})}})}})},isUnregistered:function(a){return Tangerine.router.navigate("login",
!0)}})};a.prototype.studentSubtest=function(a,b){return Tangerine.user.verify({isRegistered:function(){var h;h=new Student({_id:a});return h.fetch({success:function(){var d;d=new Subtest({_id:b});return d.fetch({success:function(){return(new Results).fetch({success:function(f){f=f.where({subtestId:b,studentId:a,klassId:h.get("klassId")});f=new KlassSubtestResultView({result:f,subtest:d,student:h});return vm.show(f)}})}})}})}})};a.prototype.runSubtest=function(a,b){return Tangerine.user.verify({isRegistered:function(){var h;
h=new Subtest({_id:b});return h.fetch({success:function(){var b;b=new Student({_id:a});return b.fetch({success:function(){var a;a=new KlassSubtestRunView({student:b,subtest:h});return vm.show(a)}})}})}})};a.prototype.register=function(){return Tangerine.user.verify({isUnregistered:function(){var a;a=new RegisterTeacherView({user:new User});return vm.show(a)},isRegistered:function(){return Tangerine.router.navigate("",!0)}})};a.prototype.studentEdit=function(a){return Tangerine.user.verify({isRegistered:function(){return(new Student({_id:a})).fetch({success:function(a){return(new Klasses).fetch({success:function(b){b=
new StudentEditView({student:a,klasses:b});return vm.show(b)}})}})},isUnregistered:function(){return Tangerine.router.navigate("",!0)}})};a.prototype["import"]=function(){return Tangerine.user.verify({isRegistered:function(){var a;a=new AssessmentImportView;return vm.show(a)},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.assessments=function(a){null==a&&(a=null);if(null===a&&"server"===Tangerine.settings.context)return Tangerine.router.navigate("groups",!0);
a=decodeURIComponent(a);return Tangerine.user.verify({isRegistered:function(){var b;b=new Curricula;return b.fetch({success:function(h){b=new Curricula(h.where({group:a}));h=new AssessmentListView({curricula:b,group:a});vm.show(h);if(navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/))return document.addEventListener("backbutton",exchk,!1)}})},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.editId=function(a){a=Utils.cleanURL(a);return Tangerine.user.verify({isAdmin:function(){return(new Assessment({_id:a})).superFetch({success:function(a){a=
new AssessmentEditView({model:a});return vm.show(a)}})},isUser:function(){return Tangerine.router.navigate("",!0)},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.edit=function(a){return Tangerine.user.verify({isAdmin:function(){return(new Assessment({_id:a})).fetch({success:function(a){a=new AssessmentEditView({model:a});return vm.show(a)}})},isUser:function(){return Tangerine.router.navigate("",!0)},isUnregistered:function(a){return Tangerine.router.navigate("login",
!0)}})};a.prototype.restart=function(a){return Tangerine.router.navigate("run/"+a,!0)};a.prototype.run=function(a){return Tangerine.user.verify({isRegistered:function(){return(new Assessment({_id:a})).fetch({success:function(a){a=new AssessmentRunView({model:a});return vm.show(a)}})},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.chart=function(a){return Tangerine.user.verify({isRegistered:function(){var b,h,d;b=new (Backbone.Collection.extend());h=new Results;
d=0;return Tangerine.$db.view('tangerine/questionsCountByAssessmentId?key="'+a+'"',{success:function(f){d=f.rows[0].value;return h.fetch({key:a,success:function(a){var e;e={};a.each(function(a,b){return e[b]=a.get("subtestData")});_.each(e,function(a,e){var f,g,h;h="";f=0;if("complete"===_.last(a).prototype&&(_.each(a,function(a){"location"===a.prototype&&(h=a.data.location.join());if("survey"===a.prototype)return a=a.data,f+=Number(a[Object.keys(a)[0]])}),g=!0,b.each(function(a){if(a.get("state")===
h)return g=!1}),g))return b.add({state:h,correct:Number((f/d*100).toFixed(2))})});a=b.toJSON();a=new Resultd(a);return vm.show(a)}})}})},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.print=function(a){return Tangerine.user.verify({isRegistered:function(){return(new Assessment({_id:a})).fetch({success:function(a){a=new AssessmentPrintView({model:a});return vm.show(a)}})},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.resume=
function(a,b){return Tangerine.user.verify({isRegistered:function(){return(new Assessment({_id:a})).fetch({success:function(a){return(new Result({_id:b})).fetch({success:function(b){var c;c=new AssessmentRunView({model:a});c.result=b;a.get("handler")&&(c.orderMap=b.get("ref"));c.subtestViews.pop();c.subtestViews.push(new ResultView({model:b,assessment:a,assessmentView:c}));c.index=b.get("subtestData").length;return vm.show(c)}})}})},isUnregistered:function(a){return Tangerine.router.navigate("login",
!0)}})};a.prototype.results=function(a){return Tangerine.user.verify({isRegistered:function(){var b;b=new Assessment({_id:a});return b.fetch({success:function(){var h;h=new Results;return h.fetch({key:a,success:function(){var a;a=new ResultsView({assessment:b,results:h.models});return vm.show(a)}})}})},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.csv=function(a){return Tangerine.user.verify({isAdmin:function(){var b;b=new CSVView({assessmentId:a});return vm.show(b)},
isUser:function(){var a;a=new ErrorView({message:"You're not an admin user",details:"How did you get here?"});return vm.show(a)}})};a.prototype.partByStudent=function(a){return Tangerine.user.verify({isRegistered:function(){var b;b=new Subtest({_id:a});return b.fetch({success:function(){return(new Results).fetch({success:function(a){var d,e;d=a.where({subtestId:b.id});e=new Students;return e.fetch({success:function(){var a;a=new PartByStudentView({students:e,subtest:b,results:d});return vm.show(a)}})}})}})},
isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.klassToDate=function(a){return Tangerine.user.verify({isRegistered:function(){var b;b=new Klass({_id:a});return b.fetch({success:function(){return(new Students).fetch({success:function(h){var d;d=h.where({klassId:a}).length;return(new Subtests).fetch({success:function(a){var e;e=a.where({curriculumId:b.get("curriculumId")});return(new Results).fetch({success:function(a){a=new KlassToDateView({studentCount:d,results:a,
subtests:e,klass:b});return vm.show(a)}})}})}})}})},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.masteryCheck=function(a){return Tangerine.user.verify({isRegistered:function(){return(new Student({_id:a})).fetch({success:function(b){return(new Klass({_id:b.get("klassId")})).fetch({success:function(h){return(new Results).fetch({success:function(d){d=new Results(d.where({studentId:a,reportType:"mastery"}));d=new MasteryCheckView({student:b,results:d,klass:h});
return vm.show(d)}})}})}})}})};a.prototype.progressReport=function(a){return Tangerine.user.verify({isRegistered:function(){return(new Student({_id:a})).fetch({success:function(b){return(new Klass({_id:b.get("klassId")})).fetch({success:function(h){return(new Results).fetch({success:function(d){d=new Results(d.where({studentId:a,reportType:"progress"}));d=new ProgressView({student:b,results:d,klass:h});return vm.show(d)}})}})}})}})};a.prototype.studentToDate=function(a){return Tangerine.user.verify({isRegistered:function(){return(new Student({_id:a})).fetch({success:function(b){var h;
h=new Klass({_id:b.get("klassId")});return h.fetch({success:function(){return(new Subtests).fetch({success:function(d){var f;f=d.where({curriculumId:h.get("curriculumId")});return(new Results).fetch({success:function(d){d=new StudentToDateView({results:d,subtests:f,klass:h,studentId:a,student:b});return vm.show(d)}})}})}})}})},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.editSubtest=function(a){return Tangerine.user.verify({isAdmin:function(){var b;a=Utils.cleanURL(a);
b=new Subtest({_id:a});return b.fetch({success:function(a,d){var e;e=new Assessment({_id:b.get("assessmentId")});return e.fetch({success:function(){var b;b=new SubtestEditView({model:a,assessment:e});return vm.show(b)}})}})},isUser:function(){return Tangerine.router.navigate("",!0)},isUnregistereded:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.editQuestion=function(a){return Tangerine.user.verify({isAdmin:function(){var b;a=Utils.cleanURL(a);b=new Question({_id:a});return b.fetch({success:function(a,
d){var e;e=new Assessment({_id:b.get("assessmentId")});return e.fetch({success:function(){var a;a=new Subtest({_id:b.get("subtestId")});return a.fetch({success:function(){var d;d=new QuestionEditView({question:b,subtest:a,assessment:e});return vm.show(d)}})}})}})},isUser:function(){return Tangerine.router.navigate("",!0)},isUnregistered:function(){return Tangerine.router.navigate("login",!0)}})};a.prototype.login=function(){return Tangerine.user.verify({isRegistered:function(){return Tangerine.router.navigate("",
!0)},isUnregistered:function(){var a;a=new LoginView;vm.show(a);if(navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/))return document.addEventListener("backbutton",exchk,!1)}})};a.prototype.logout=function(){return Tangerine.user.logout()};a.prototype.account=function(){return Tangerine.user.verify({isRegistered:function(){var a;a=new AccountView({user:Tangerine.user});return vm.show(a)},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.settings=
function(){return Tangerine.user.verify({isRegistered:function(){return(new Settings({_id:"TangerineSettings"})).fetch({success:function(a){a=new SettingsView({settings:a});return vm.show(a)}})},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.update=function(){return Tangerine.user.verify({isAdmin:function(){$("#version-uuid").html("Updating...");return $.couch.replicate(Tangerine.config.address.cloud.host+"/"+Tangerine.config.address.cloud.dbName,Tangerine.config.address.local.dbName,
{success:function(){$("#version-uuid").html("Successful update, now refreshing app...");return _.delay(function(){Tangerine.router.navigate("",!1);return document.location.reload()},2E3)},error:function(a){return $("#version-uuid").html("Error updating: "+a)}},{doc_ids:["_design/tangerine"]})},isUnregistered:function(a){return Tangerine.router.navigate("login",!0)}})};a.prototype.logs=function(){var a;a=new LogView;return vm.show(a)};a.prototype.transfer=function(){var a;a=Utils.$_GET().name;return $.couch.logout({success:function(){$.cookie("AuthSession",
null);return $.couch.login({name:a,password:a,success:function(){Tangerine.router.navigate("");return window.location.reload()},error:function(){return $.couch.signup({name:a,roles:["_admin"]},a,{success:function(){return(new User).save({name:a,id:"tangerine.user:"+a,roles:[],from:"tc"},{wait:!0,success:function(){return $.couch.login({name:a,password:a,success:function(){Tangerine.router.navigate("");return window.location.reload()},error:function(){var a;a=new ErrorView({message:"There was a username collision",
details:""});return vm.show(a)}})}})}})}})}})};return a}(Backbone.Router);$(function(){window.vm=new ViewManager;Tangerine.router=new Router;Tangerine.user=new User;Tangerine.nav=new NavigationView({user:Tangerine.user,router:Tangerine.router});return Tangerine.user.fetch({success:function(){return Backbone.history.start()},error:function(){return Backbone.history.start()}})});